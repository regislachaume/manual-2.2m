\documentclass[11pt,fleqn,a4paper]{book} 

% paper size and margins

\usepackage[top=3cm,bottom=3cm,inner=3cm,outer=2cm,headsep=10pt,a4paper]{geometry} 

% symbols 
\usepackage{amsmath,amssymb}

% hyphenations
\usepackage[english]{babel}

% some shortcuts

\makeatletter
\def\menu#1#2{\texttt{#1}\ifx{}#2\else\@for\@x:=#2\do{$\rightarrow$\texttt{\@x}}\fi}
\makeatother
\def\wmenu#1#2{window menu \menu{#1}{#2}}
\def\mmenu#1#2{left-click mouse menu \menu{#1}{#2}} 
\def\fetchob{\wmenu{File}{Load OBs,From file...}} 
\def\home{\textasciitilde{}}

% document layout
\input{structure}

% hyperlinks
\usepackage[pdftex,colorlinks=true,linkcolor=ocre]{hyperref}
\usepackage[all]{hypcap}

% glossary
\usepackage{glossaries}
\renewcommand*{\glspostdescription}{}
\makeglossaries
\input{glossary.tex}

% Identation
\parindent=0pt
\parskip=1ex

\begin{document}

%
% Title page
% 

\title{Operations at the La Silla 2.2\,metres telescope}%
\author{
    Rodolfo~Angeloni\\[5pt]
    Paul~Eigenthaler\\
    \texttt{paul.eigenthaler@icloud.com}\\[5pt]
    Angela~Hempel\\
    \texttt{ang.hmpl@gmail.com}\\[5pt]
    Sam~Kim\\
    \texttt{skim@astro.puc.cl}\\[5pt]
    Iv\'an~Lacerna\\[5pt]
    R\'egis~Lachaume\\
    \texttt{lachaume@astro.puc.cl}\\[5pt]
    Markus~Rabus}%
\abstract{Since 2013, the operations at the La Silla 2.2~metres telescope involve minimal support by ESO.  This guide intends to familiarise observers with
the operations.}%
\version{\today}
\maketitle

%
% Table of contents and lists of figures, tables, and procedures
% 

\tableofcontents 
\cleardoublepage 

\addcontentsline{toc}{chapter}{\listfigurename}
\listoffigures 
\cleardoublepage 

\addcontentsline{toc}{chapter}{\listtablename}
\listoftables
\cleardoublepage 

\addcontentsline{toc}{chapter}{\listprocedurename}
\listofprocedures
\cleardoublepage

%
% The document itself
%

\chapter{Introduction}
The operational scheme at the La Silla 2.2~metres telescope involves minimal support by ESO.  This guide intends to familiarise observers with the operations. 

\section{Control room}

First of all, the \gls{control room}, is located below the main ESO building, the one with the dining room.  It is still shared with the two ESO telescopes, the NTT and the 3.6\,m. If everything works without technical issue, you can do everything from there without any need to access the telescope building.

\figureref{saladecontrol}  below shows the location of the different components of the controls.  Screens, keyboards, and mice are labeled to avoid confusion.

\begin{figure}[!ht] \includegraphics[width=\linewidth]{saladecontrol.pdf}
\caption[Layout of the telescope controls]{Layout of the telescope controls.  From right to left: \gls{windows} 
controlling and monitoring the \gls{dome}, \acrlong{tcs}, \acrshort{wfi} controls,
\acrshort{feros} controls (bottom) and skype laptop connected to the \acrshort{grond} remote observers (top), GROND controls, \acrshort{p2}/\acrshort{vot} machine where
\acrshort{ob}s are crafted and loaded by the visiting astronomer, and,
finally, the FEROS \acrlong{drs}.}
\label{fig:saladecontrol} 
\end{figure}

\section{Overview of operations}

In most nights, a support astronomer is present in the afternoon and the first part of the night, freeing the \gls{visitor} of the afternoon and evening twilight calibration duties.  Sometimes visitors are ask to perform all duties alone.  In that case, an experienced observer can start operations 2.5 hours before sunset to minimise working time, while giving a small time buffer to solve the commonest technical issues.  Inexperienced ones should plan to start earlier or accept possible downtime in the very beginning of the night. \figureref{timeflow} shows a time-optimised chart of operations in the afternoon and both twilights.

\begin{figure}[!ht]
\includegraphics[width=\linewidth]{operations-time-flow.pdf}
\caption[Time flow of afternoon and twilight observations]{Time flow of operations in the afternoon and twilights. Afternoon setup and calibrations should be started at least 2.5 hours before sunset to leave a small buffer for technical issues. This example is giving for a late fall night (May 15th), with presence required for about 15~hours.}
\label{fig:timeflow}
\end{figure}

Support astronomers perform or help to perform observations in \gls{service} mode for the follow-up of gamma-ray bursts and transients (15\% of time as of 2019) and time-domain programmes (15\% of time as of 2019). They ensure that \glspl{visitor} correctly share their time with these other programmes.  In addition, during \gls{mpia} time, they also have they monitor the different MPIA programmes and ensure they are observed according to their priority and weather conditions. It includes real-time assessment and decisions, guided by the instructions of the different PIs, in particular during service mode.  During \gls{mpe} and Chilean time, they are mostly supporting observations and are not expecting to take real-time decisions concerning these programmes.  If service mode for MPE or Chile is offered, it is more similar to a ``delegated visitor'' mode where instructions by the PI are expected.

When no \gls{service} astronomer is present (e.g. last part of the night), visiting astronomers will be asked to perform service observations for other groups, both for the follow-up of gamma-ray bursts and time-domain programmes.  The number of allocated nights for \glspl{visitor} takes the average time loss into account, in case more down time, compensation will be considered in service mode.  Since 2017, a long-term monitoring of quasi-stellar objects takes 1.5 to 2 hours daily, and targets of opportunity about 1 hour (15\% long-term average).  \gls{mpia} observers may be ask for additional \gls{service} observations for the MPIA.

Chapters~\ref{chap:startup}--\ref{chap:nightops} can be seen as a step-by-step
guide of the operations from the daily startup to the night time. Many of the
steps need some knowledge of the \gls{ob} management and of the \gls{bob}
interface, which are presented in Chapter~\ref{chap:ob}.
Chapter~\ref{chap:reboots} details monthly preventive software maintenance.
Chapter~\ref{chap:trouble} lists fixes to common issues at the telescope.  We
present the software components more in detail in Chapter~\ref{chap:compo}.

\section{Security}

The main guidelines to avoid bodily harm are:
\begin{itemize}
\item Don't move the telescope or \gls{dome} before checking no one is in the way.  During the day, ESO technicians may address some issues or refill the instrument with nitrogen.  If you operate from the remote \gls{control room}, check the dome \gls{webcam}.
\item If you need to go to the \gls{dome}, leave a conspicuous message in the \gls{control room} and put the telescope in local control from the \gls{computer room} of the telescope building.
\item If you drive by night, go very slowly and defensively as you may not see a pedestrian or a dark donkey.  
\item If you walk, take the incoming traffic side and be very careful at night. Drivers don't use lights.
\end{itemize}

ESO has the duty to ensure telescope safety but you have to be proactive, too.  In particular:
\begin{itemize}
\item If you are not able to close when you must (sunrise and inclement weather), you need to ask to the operators present at the NTT or the 3.6m. They have the duty to assist.  
\item The weather officer or the NTT operator will tell you when you need to close and when you may reopen, stick to it.
\item If you have any doubts whether you may open in the afternoon, wait for the NTT to open or ask the ESO day-time operator.
\item If the meteo monitor shows that the closing limits are reached (wind, humidity, clouds), close.
\item If a sea of clouds below the observatory was present at sunset, be attentive as it is common for them to raise and increase humidity to 100\% within minutes.
\end{itemize}

\section{Telescope building}

It is sometimes necessary to physically access the telescope building where there is an old control room (\figref{old-control-room}), a \gls{computer room} to physically access some relevant workstations (\figref{computer-room}), the FEROS room, and, obviously, the \gls{dome} (\figref{dome}).  

Some subsystems are controlled by machines gathered in big rack towers, these machines are called \gls{lcu} or sometimes \gls{vme}.  There are also workstations controlling coordinating with one or more LCUs, they look like a normal desktop computer tower usually with no screen or keyboard.

In the \gls{dome} itself, many electronic boxes attached at the telescope (see \figref{dome}) may need a \gls{power cycle}, that is being switched off and on.  It is also possible to locally take control of telescope, dome, and mirror motion.

\begin{figure}[!ht]
\centering
\includegraphics[width=0.7\linewidth]{dome/dome-old-control-room.jpg}
\caption{Entering the old control room in the telescope building}
\label{fig:old-control-room}
\end{figure}

\begin{figure}[!ht]
\centering
\includegraphics[width=0.7\linewidth]{dome/dome-computer-room.jpg}
\caption[Entering the computer room in the telescope building]{Entering the \gls{computer room} in the telescope building. In front slightly to the left is the \gls{vme} rack.} 
\label{fig:computer-room}
\end{figure}

\begin{figure}[!ht]
\centering
\includegraphics[width=0.7\linewidth]{dome/dome.jpg}
\caption[Entering the dome]{Entering the \gls{dome}, from left to right: the \gls{adam} controls,
a computer to use the \gls{tcs}, the dome controls, the bottom of the telescope.}
\label{fig:dome}
\end{figure}

\cleardoublepage



%------------------------------------------------------------------------------
%                                       
%                                  
%  DAILY STARTUP
%
%
%------------------------------------------------------------------------------


\chapter{Early afternoon: daily start-up}
\label{chap:startup}

Start-up should take about one hour, but small technical issues can lengthen it significantly.  Ideally, it should be done early enough in the afternoon (2--3 pm in Winter, 3--4 pm in Summer), so that \gls{dome flats} can be done before the nitrogen of \gls{wfi} is refilled.  Also, complicated issues should be diagnosed early, so that you benefit from the day-time support from ESO engineers.  Night time support is not provided except for emergencies.

For an experienced observer alone in Winter, a later start-up can be done by optimising and hoping for the best (see \figref{timeflow-eve}), but the risk is to lack time to perform \gls{dome flats} and/or losing the very beginning of the night to technical issues.

The \gls{tcs} and the \gls{wfi} are entangled.  In particular, the \gls{wfi} \gls{ics} controls the \gls{focus} and \gls{pointing}, and the \gls{tcs} controls the \gls{wfi} \gls{ag}.  For this reason, the \gls{wfi} should be rebooted before the \gls{tcs}.  The other instruments, \gls{grond} and \gls{feros}, are more independent and need a later restart. Also, the \gls{feros} and \gls{grond} \gls{ag} should be checked and the \gls{feros} \gls{drs} set to the right date.

\section{Outline}
\label{sec:startupoutline}

To be on the safe side, the start-up sequence shall be performed in this order below. To gain a bit more time one can do \ref{list:hydr}--\ref{list:tcs1} during \ref{list:wfi1}--\ref{list:wfibooted} and
\ref{list:tcsboot}--\ref{list:tcsbooted} during
\ref{list:wfiwin}--\ref{list:wfitest}.  \gls{feros}, \gls{grond}, the \acrlong{ag} and the \acrlong{drs} (\ref{list:feros}, \ref{list:grond}, \ref{list:ag}, \ref{list:drs}) can be handled in parallel as soon as the \gls{tcs} is booted
(\ref{list:tcsbooted}).  

If under time pressure, you can also do some day-time calibrations in parallel. \figureref{timeflow-eve} gives a time-optimised flow of the day-time start-up and calibrations, showing what can be done in parallel.  It should be started latest 2.5 hours before sunset.
\begin{figure}
\includegraphics[width=\linewidth]{operations-time-flow-evening.pdf}
\caption[Time-flow of afternoon operations]{Operations time flow in the evening, doing start-up, calibrations, and tests in parallel.  It should start latest 2.5 hours before sunset (see horizontal axis at the top).  The time of the day, given in universal time on the bottom horizontal axis, corresponds to a date close to fall equinox (September 15th).}
\label{fig:timeflow-eve}
\end{figure}

\procedure{Telescope and instrument startup} 
\label{proc:startup}
\begin{enumerate}
%%%%
%%%% WFI
%%%%
  \item \label{list:wfistartup}\textbf{\gls{wfi} restart (8 min, in case of problems, see \figref{wfi-restart})}
        \begin{enumerate}
          \item On the screen \texttt{BOB Wide Field Imager}, go to the \texttt{StartUp} \gls{desktop}.\label{list:wfi1}
          \item In a terminal, \texttt{\gls{osf2p2StartUp} ini WFI F8}, where ini is your initials (\figref{wfisu-launch}).
          \item On the dialog, choose \texttt{DAILY} startup (\figref{wfisu-full}).
          \item Click \texttt{START} on the appearing window (\texttt{ESO220 WEEKLY FULL STARTUP}, see \figref{wfisu-start}). 
          \item Wait until the start-up window says \texttt{SCRIPT finished} (about 11 minutes).\\
          A black text window gives indication on the process (\figref{wfisu-log})
                \label{list:wfibooted}
          \item Close the startup window (\figref{wfisu-start})
          \item Close the emerging PDF (\figref{wfisu-pdf}).
          \item Rearrange windows to the corresponding \gls{desktop}s (1 min, see \figref{wfisu-windows})
             \label{list:wfiwin}
             \begin{itemize}
                \item \gls{rtd} goes to all \gls{desktop}s, on the left screen.
                \item other windows go to the \gls{desktop} bearing their name, on the right screen. 
            \end{itemize}
          \item Wait for the filtre wheel to be set to a specific filtre (1--2 min)\label{list:wfisu-filtre}
                \begin{enumerate}
                    \item Locate the \texttt{Filter} field on the \texttt{WFI \gls{General State}} panel
                    \item If it stays in \texttt{MOVING} for more than 2 minutes or you skipped full restart, reset filtre wheel (\procref{filtrereset}). 
                \end{enumerate}
          \item In \gls{bob}, execute \texttt{testOB.obd} (1 min)
             \label{list:wfitest}
             \begin{enumerate}
               \item Import it with \fetchob.
               \item Click the \texttt{Start} button. 
             \end{enumerate}
        \end{enumerate}
%%%%
%%%% TCS
%%%%
  \item \textbf{\gls{tcs} restart (18 min, daily, see \figref{tcs-restart})}
        \begin{enumerate}
        \item\label{lab:hydron} Switch hydraulics and drives on
             \begin{enumerate}
               \item Go to web browser on screen \texttt{Dome webcam \& hydraulics} (\figref{tcssu-hydr}). 
               \item Find the \gls{domefunc} (tab called \texttt{ADAM 6000…})\\
                     If it is not there, open it with the bookmark \texttt{Dome controls}.\\
                     Use the good seeing password if necessary.
               \item Click \texttt{HydOn}, then button \texttt{Hydr} goes green.
               \item Click \texttt{DrivesOn}, then button \texttt{Drives} goes green.
             \end{enumerate}
             It may be needed to click two or three times to get green buttons.
             \label{list:hydr}
          \item On the screen \texttt{Telescope Control Software}, go the the \texttt{StartUp} \gls{desktop}.\label{list:tcs1}
          \item If \texttt{Cannot read "@w2p2wfi…"} pop-up can be seen on the \gls{tcs} screen (\figref{tcssu-error}), click \texttt{OK}.
          \item In a terminal type \texttt{\gls{lccBoot} \gls{lte2p2}} and wait for command to end (2 min, \figref{tcssu-boot})\\
                If none is there, you can open one with \mmenu{TCS User}{tcs xterm}.\\
                If an error message appears on the \gls{wfi} screen, click \texttt{OK}. 
          \item Launch the start-up script
          \begin{enumerate}
             \item In the terminal type \texttt{\gls{osf2p2StartUp} ini ALL F8}, with \texttt{ini} = your initials.\label{list:tcsboot} (\figref{tcssu-launch})\\
                   Make sure \gls{wfi} is fully booted (\ref{list:wfibooted}) before going on with the \gls{tcs} start-up.
              \item Click \texttt{START} on the appearing startup window titled \texttt{ESO220 DAILY STARTUP} (\figref{tcssu-start})
          \end{enumerate}
          \item Be proactive to handle some appearing pop-ups (14 min) 
          \begin{enumerate}
             \item One asking to check hydraulics and telescope is parked among other things (\figref{tcssu-check}).\\
                   Take your time to check each point and then click \texttt{OK}          
             \item One asking to switch on flat-field lamp\label{list:tcsonline} (\figref{tcssu-lampon})\\
                   Lamp should be on, check no one is in the \gls{dome}, then click \texttt{OK}.\\
                   If it's off, on \texttt{FAUX functions} panel select \texttt{200V} under \texttt{FLAT FIELD LAMP}\\
                   Then, telescope will do movement checks you can monitor on the webcam.
             \item One asks to check for CCD alarms to be enabled (\figref{tcssu-alarm})\\
                   Go to the large, black text window where all numbers below the two \texttt{Al Enab} should be ones.
             \item One asks to check that the flat-field lamp is off and \gls{telemetry} active.
                \begin{enumerate}
                 \item If flat-field lamp is on, turn it off unless you will do \gls{dome flats}.\\
                   On \texttt{FAUX functions} panel select \texttt{OFF} under \texttt{FLAT FIELD LAMP}          
                 \item On the \texttt{Telemetry} panel, ensure that the FEROS \gls{telemetry} module is \texttt{active}\\
                       If not, activate it on the FEROS screen using \gls{fcdTelemetry} (see \procref{telemetry})
                 \item On the \texttt{Telemetry} panel, ensure that the WFI \gls{telemetry} module is \texttt{active}\\
                       If not, activate it on the WFI screen using \gls{fcdTelemetry} (see \procref{telemetry})
                 \item If a \gls{telemetry} was restarted, panel must be closed and reopened (see \procref{telemetry})
                 \end{enumerate}
          \end{enumerate}
          \item Perform some post-start-up tidying
                \begin{enumerate}
                   \item Make sure the start-up window indicates \texttt{SCRIPT finished}.\label{list:tcsbooted}
                   \item Close startup window.
                   \item Close emerging PDF.
                   \item Rearrange windows to the corresponding \gls{desktop}s (1 min)
             \begin{itemize}
                \item \gls{skycat} go to all \gls{desktop}s, on the right screen.
                \item Other windows go to the \gls{desktop} bearing their name, on the left screen. 
                \item Ignore window \texttt{CSS ALARM DISPLAY} (\figref{wfialarm}) if it pops up on the \gls{wfi} screen.
             \end{itemize}     
                \end{enumerate}
          \item Check and set up the \gls{wfi} \gls{ag} (1 min)
          \begin{enumerate}
                \item Go to the \gls{TCS control panel}
                \item Under \texttt{AG Field Acquisition}, click \texttt{Retrieve Field}
                \item\label{list:ccdstat} Under \texttt{Autoguider} look that \texttt{CCD Stat} goes to \texttt{Pending} and \texttt{integrating} (10--15 s)
                \item\label{list:skycatro} Check that an image is read out on the \gls{skycat} window (30 s)
                \item Select \wmenu{View}{Autoscale}
                \item If steps \ref{list:ccdstat}--\ref{list:skycatro} do not work, see \procref{fixwfiag}.
                \item On the \gls{skycat} window, use \wmenu{TCS}{\gls{pickrefstar}...}
                \item On emerging window (title \texttt{\gls{pickrefstar}}), click \texttt{Cancel Operation}
          \end{enumerate}
          \item Ensure that the \gls{pointing model} is correct (1 min).
          \begin{enumerate}
            \item Check that the sidereal time is correct.\\
                  Compare the \gls{TCS control panel} and the wall clock
            \item\label{list:pmcheck:wfi} Select \gls{wfi} \gls{pointing model}.
               \begin{enumerate}
                  \item On the \gls{TCS status panel}, use \wmenu{Instrument selection}{WFI}
                  \item On the emerging popup select \texttt{Continue}
               \end{enumerate}
            \item\label{list:pmcheck:setup} Check the \gls{pointing model} parameters are non zero
               \begin{enumerate}
                  \item Locate the \gls{TCS setup panel}
                  \item Look values of ID, IH, and CH under \texttt{Pointing Model Data}
               \end{enumerate} 
            \item If they are zero, fix the \gls{pointing model}.
                \begin{enumerate}
                  \item Locate or open a tcs terminal 
                  \item Type \texttt{\home/bin/fixPointing.sh} and wait for command to return (15 s)
                  \item Redo steps \ref{list:pmcheck:wfi}--\ref{list:pmcheck:setup}
                \end{enumerate}
          \end{enumerate}
        \end{enumerate}
%%%%
%%%%  FEROS
%%%%
  \item \textbf{\gls{feros} restart (daily, 8--9 min, see \figref{feros-restart}).}\\
        Only start after \gls{tcs} is back online and doing telescope movements (\ref{list:tcsonline}).\\
        Under time pressure, you can skip points \ref{lab:ferosstartup}--\ref{lab:ferosbooted}, accepting an increased risk of night-time issues.
        \label{list:feros}
        \begin{enumerate}
         \item \label{lab:ferosstartup} On the screen \texttt{FEROS BOB},  go the the \texttt{StartUp} \gls{desktop}.
         \item Launch the weekly full start-up script (2 min)
         \begin{enumerate}
            \item In a terminal type \texttt{\gls{osf2p2StartUp} ini FEROS F8}, where ini is your initials. (\figref{feosu-launch})\\
               If none is available, use \mmenu{FEROS User}{feros xterm}.
            \item Click \texttt{FULL} on popup \texttt{Select StartUp Type} (\figref{feosu-full})
            \item Click \texttt{START} on the start-up window \texttt{ESO220 WEEKLY FULL STARTUP} (\figref{feosu-start}).\\
               A black text window should appear and give indications on the progress. (\figref{feosu-log})
             \item Wait for the weekly full start-up to indicate finished and close it (2 min)
                \begin{enumerate}
                   \item Close \texttt{ESO220 WEEKLY FULL STARTUP} when it says \texttt{SCRIPT finished} 
                   \item Close the emerging PDF
                \end{enumerate}
            \end{enumerate}
         \item Perform the instrument start-up (4 min) 
            \begin{enumerate}
                \item Locate the \texttt{Instrument Startup} window and click \texttt{START} (\figref{feosu-start2}).
                \item A large, grey window giving details on the process should open.\\If a timeout error occurs, see \secref{ferosstartuptimeout}.    
                \item Wait for the large, grey window to close itself (3 min)
                \item\label{lab:ferosonline} Put the instrument online (1 min)
                \begin{enumerate}
                   \item On \texttt{FEROS \gls{General State}} panel, use \wmenu{Instrument}{ONLINE}
                   \item Wait for \texttt{State} to indicate \texttt{ONLINE}
                \end{enumerate}
            \end{enumerate}
         \item \label{lab:ferosbooted} Rearrange windows to the corresponding \gls{desktop}s (1 min, see \figref{feosu-windows})
            \begin{itemize}
              \item \gls{rtd} goes to all \gls{desktop}s, on the left screen.
              \item Other windows go to the \gls{desktop} bearing their names, on the right screen.
              \item There are two \texttt{rtd}s and two \texttt{logMonitor}s, you can close one of each.
           \end{itemize}
         \item Perform a test \gls{ob} with telescope communication (1--2 min)
           \begin{enumerate}
             \item On \texttt{FEROS \gls{General State}} panel, select \wmenu{Telescope}{ENABLE} 
             \item In \gls{bob}, run \texttt{testOB.obd} (1--2 min)
             \begin{enumerate}
               \item Fetch it with \fetchob (\texttt{/OBD/Templates/}).
               \item \label{list:ferostestob} Click \texttt{Start} 
               \item Wait for the exposure to finish (takes about 1 min).
               \item If points \ref{lab:ferosstartup}--\ref{lab:ferosbooted} were skipped, it will fail on the first attempt and proceed.
              \item Click \texttt{OK} on the error popups, one should say \texttt{error closing \gls{w2p2cam}}
              \item In \gls{bob}, click on \texttt{Reset status}
              \item Re-run it (point \ref{list:ferostestob}).
            \end{enumerate}
            \item \texttt{FEROS \gls{General State}} panel, select \wmenu{Telescope}{IGNORE}
           \end{enumerate}
        \end{enumerate}
%%%%
%%%% GROND
%%%%
  \item \textbf{\gls{grond} restart (daily, 5--11 min)}
        \label{list:grond}
        \begin{enumerate}
         \item Go to screen \texttt{GROND BOB}.
         \item Locate or open a terminal with user \texttt{grondmgr}.\\
               You can use \mmenu{GROND user}{grondmgr on \gls{wgrond}}
         \item In the case of a power cut or issues with GROND, restart the instrument (5 min)
         \begin{enumerate}
           \item Type \gls{grinsStop}, wait for shutdown window to finish and disappear.\label{list:grinsstop}
            \item Type \gls{grinsStart} and click \texttt{Continue} on the pop-up.
            \item Wait for startup window to finish and disappear (a few minutes).\\If an error about ``reply timed out'' appears, then close the startup window and repeat from \ref{list:grinsstop}.\label{list:grinsstart}
            \item Rearrange windows.
            \item Use \wmenu{Instrument}{ONLINE} in the GROND control panel (\figref{grondcon}).\label{list:grondonline}
         \end{enumerate}
         \item Do some preventive reinitialisations (1.5 min)\label{list:grond-prophylaxis}
           \begin{enumerate}
             \item Close \gls{bob}.
             \item Launch \gls{bob} from the terminal as user \texttt{grondmgr} (type \texttt{bob \&}).
             \item In the same terminal, execute \gls{grondGRI}.
             \item In the same terminal, execute \texttt{\gls{grondSHUTTER} \&\& \gls{grondFM}} (might take 1 min).
           \end{enumerate}
         \item From \gls{bob}, execute the test \gls{ob} \texttt{testOB.obd}, see \figref{grondbob} (1 min)
           \begin{enumerate}
             \item Ensure \gls{tcs} is \texttt{OFF} (red button) by clicking \texttt{TCS OFF}.
             \item Fetch \gls{ob} with \wmenu{File}{Load OBs,From file…} 
             \item Click \texttt{Start}.
           \end{enumerate}
         \item Repeat the last step using communication with the TCS (2 min)\label{list:grond-testtcs}
           \begin{enumerate}
             \item Ensure \gls{tcs} is \texttt{ON} (green button) by clicking \texttt{TCS ON}.
             \item Fetch \gls{ob} with \wmenu{File}{Load OBs,From file…}.
             \item Click \texttt{Start}.
             \item If you haven't done the full start-up, the first attempt should fail, you need to
             \begin{enumerate}
                \item Click \texttt{OK} on the error popups, one should say \texttt{error closing \gls{w2p2cam}}
                \item Wait for the exposure to finish
                \item In \gls{bob}, click on \texttt{Reset status}
                \item Click on start again.
                \item If error persists, close \gls{bob} and open it again
             \end{enumerate} 
             \item Set telescope back to FEROS/WFI (0.5 min)\\
             In a terminal type, \texttt{\gls{grondM3} WFI \&\& \gls{grondMC} CLOSE \&\& \gls{grondCS} CLOSE}.
           \end{enumerate}
         \item If a restart (point \ref{list:grinsstart}) was done, set the image displays (1 min).
            \begin{enumerate}
               \item Go to the \texttt{GROND optical (FIERA)} screen.
               \item Find the \gls{rtd} window (griz images).
               \item Check that image is flipped along both axes and rotated (see \figref{flip}).
               \item Go to the \texttt{GROND infrared (IRACE)} screen.
               \item Find the \gls{irtd} window (JHK images).               
               \item Check that images are received live.\\
                     The left column should have a green button with text \texttt{Stop} (see \figref{iflip}).\\
                     If it is gray with text \texttt{Start}, click it so that it gets as describe above.
              \item Check that the image is horizontally flipped (see \figref{iflip}).
              \item Check that the image has positive pixel values\\
                    Find menu option \texttt{Negative real time image}
             \end{enumerate}
        \end{enumerate}
  \item \textbf{\gls{feros} and \gls{grond} guide cameras setup} (3--8 min)\label{list:ag}
        \begin{enumerate}
           \item Go to the \texttt{Autoguider GROND \& FEROS} screen. 
           \item Rearrange windows to their corresponding \gls{desktop}s (1 min)\\
                 \gls{autoguiding} window should go to all \gls{desktop}s.
           \item Use numbers 6, 3, 0.02 below \texttt{Autoguider control} and click \texttt{Apply}.
           \item Check the \gls{grond} autoguider (1--4 min)
               \begin{enumerate}
                  \item Go to \gls{desktop} \texttt{GROND AG}
                  \item Select \text{GROND} below \texttt{CCD change} (see \figref{agswitch})
                  \item If necessary, use \texttt{Start exposure} to change \texttt{CCD Status} to \texttt{Infinite loop}
                  \item Find window \gls{grondag}
                  \item Use \wmenu{TCS}{Attach camera}
                  \item A bias image should be seen within seconds
                  \item If it fails in the previous steps, go to \procref{restartgag} (3 min)
                  \item Use \wmenu{TCS}{Pick Reference Star}
                  \item On emerging window \gls{pickrefstar}, click \texttt{Cancel operation}
               \end{enumerate}
           \item Check the \gls{feros} autoguider (1--4 min)
               \begin{enumerate}
                  \item Go to \gls{desktop} \texttt{FEROS AG}
                  \item Select \text{FEROS} below \texttt{CCD change} (see \figref{agswitch})
                  \item If necessary, use \texttt{Start exposure} to change \texttt{CCD Status} to \texttt{Infinite loop}
                  \item Find window \gls{ferosag}
                  \item Click checkbox \texttt{Camera on/off} so that checkbox gets green
                  \item A bias image should be seen within seconds
                  \item Check that the image is horizontally flipped. 
                  \item If it fails in the previous steps, go to \procref{restartfag} (3 min)
                  \item Click \texttt{Set Reference}
                  \item On emerging window \gls{pickrefstar}, click \texttt{Cancel}
               \end{enumerate}
        \end{enumerate}           
  \item\textbf{FEROS data reduction software setup} (2--5 min)
    \begin{enumerate}
        \item Change the date  (1 min)
        \label{list:drs}
		\begin{enumerate}
		  \item Go to the \texttt{DRS:main} \gls{desktop} of screen \texttt{FEROS pipeline}
		  \item Locate or open FEROS DRS window\\
                It opens with left-click \mmenu{FEROS User}{FEROS DRS} 
		  \item \texttt{Stop} the \texttt{Reduce Queued Image Status}
		  \item \texttt{Stop} the \texttt{Midas Session Status}
		  \item Change the date 
		  \item \texttt{Start} the \texttt{Midas Session Status}
		  \item \texttt{Start} the \texttt{Reduce Queued Image Status}
		\end{enumerate}
		\item Free disk space (1--4 min)
		\begin{enumerate}
		    \item Go to \texttt{Visitor} \gls{desktop} of screen \texttt{FEROS pipeline}
		    \item Use or open a terminal
		    \item If df -h /data indicates more than 80\% disk usage, proceed
		    \item Delete the oldest nights in \texttt{/data/raw}, \texttt{/data/reduced}, and
		    \texttt{/data/reduced/FEROS}\\
		          Leave at least the last three nights.\\
		          Example: \texttt{rm -rf /data/reduced/2018-01-* /data/reduced/FEROS/2018-01-*}
		\end{enumerate}
	\end{enumerate} 
    \item\textbf{Afternoon calibrations can be done right after start-up} (see \chapref{daycal})
        \begin{itemize}
        \item \gls{wfi} \gls{dome flats} may be done in parallel starting from point~\ref{list:tcsonline}
        \item \gls{feros} standard calibration may be done in parallel starting from point~\ref{list:grond}
        \end{itemize}
\end{enumerate}
\newpage

\section{WFI startup}

\begin{figure}[ht!]
\centering
\subfigure[Launch the reboot from the terminal.]{
  \includegraphics[width=0.45\linewidth]{wfi/wfireboot-0.png}\label{fig:wfisu-launch}
}%
\hspace{0.15\linewidth}
\subfigure[Choose full startup.]{
  \includegraphics[width=0.2\linewidth]{wfi/wfireboot-1.png}\label{fig:wfisu-full}
}%

\subfigure[Click start.]{
  \includegraphics[width=0.365\linewidth]{wfi/wfireboot-2.png}\label{fig:wfisu-start}
  \label{fig:wfi-full-restart}
}%
\hspace{0.05\linewidth}
\subfigure[A log terminal opens. Process takes $\approx $ 10 min.]{
  \includegraphics[width=0.42\linewidth]{wfi/wfireboot-3.png}\label{fig:wfisu-log}%
}

\subfigure[When finished select menu \texttt{File} $\rightarrow$ \texttt{Quit} from start-up window of \figref{wfi-full-restart}. This PDF log opens. You can close 
it.]{
  \includegraphics[width=0.41\linewidth]{wfi/wfireboot-4.png}\label{fig:wfisu-pdf}%
}
\hspace{0.05\linewidth}
\subfigure[
Don't forget to rearrange all these windows.  
]{
  \includegraphics[width=0.47\linewidth]{wfi/wfireboot-5.png}\label{fig:wfisu-windows}%
}
\caption[Wide field imager restart]{\gls{wfi} restart.  When done, don't forget to take a test bias.}
\label{fig:wfi-restart}
\end{figure}

\newpage
\section{TCS startup}

\begin{figure}[h!]
%%
\begin{minipage}{0.4\linewidth}
\centering
\subfigure[Turn hydraulics and drives on, \gls{windows}.]{%
\hspace{0.1\linewidth}\includegraphics[width=0.8\linewidth]{dome/dome-auxfunc.png}\label{fig:tcssu-hydr}\hspace{0.1\linewidth}%
}
\end{minipage}
%%
\hspace{0.15\linewidth}%%
%%
\begin{minipage}{0.42\linewidth}
\subfigure[On the TCS machine, give \texttt{OK} to this error.]{%
\hspace{0.2\linewidth}\includegraphics[width=0.6\linewidth]{tcs/tcsreboot-initerror.png}\label{fig:tcssu-error}\hspace{0.2\linewidth}%
}
\subfigure[Reboot \gls{lte2p2} machine.]{%
\hspace{0.1\linewidth}\includegraphics[width=0.8\linewidth]{tcs/tcsreboot-lccboot.png}\label{fig:tcssu-boot}\hspace{0.1\linewidth}%
}
\subfigure[Launch the reboot from the terminal.]{%
\hspace{0.1\linewidth}\includegraphics[width=0.8\linewidth]{tcs/tcsreboot-0.png}\hspace{0.1\linewidth}\label{fig:tcssu-launch}%
}
\end{minipage}
\begin{minipage}{0.36\linewidth}
\subfigure[Click start.]{%
  \includegraphics[width=\linewidth]{tcs/tcsreboot-1.png}\label{fig:tcssu-start}%
}%
\end{minipage}
%%%
\hspace{0.14\linewidth}%
\begin{minipage}{0.45\linewidth}
\subfigure[Check elements then click \texttt{OK} to incoming pop-up.]{%
\includegraphics[width=\linewidth]{tcs/tcsreboot-2.jpg}\label{fig:tcssu-check}%
}
\subfigure[Check flat lamp is on or switch it on. 
After clicking \texttt{OK}, telescope should move.]{
  \includegraphics[width=\linewidth]{tcs/tcsreboot-5.png}\label{fig:tcssu-lampon}%
}
\subfigure[Check that CCD alarms are on in the black text window.]{%
\hspace{0.15\linewidth}\includegraphics[width=0.7\linewidth]{tcs/tcsreboot-6.png}\hspace{0.15\linewidth}\label{fig:tcssu-alarm}%
}
\end{minipage}
%%%
\begin{minipage}{0.4\linewidth}
\subfigure[Check flat field lamp is off, if not, turn it off]{%
\hspace{0.2\linewidth}\includegraphics[width=0.6\linewidth]{tcs/tcsreboot-7.jpg}\hspace{0.2\linewidth}%
}%
\end{minipage}
\caption[Telescope control software restart]{\acrshort{tcs} restart. As for \acrshort{wfi} there is a black terminal log) and process ends with a PDF log being popped up.  Emergent windows should be rearranged to their respective \gls{desktop}s.  The \gls{rtd} display should go to all desktops on the left screen, the other windows n the right screen.}
\label{fig:tcs-restart}
\end{figure}
%%%%
%%%% FEROS
%%%%
\newpage
\section{FEROS startup}

\begin{figure}[b!]
\null\hfill
\subfigure[Restart \gls{feros} from terminal. Ensure that telescope
is enabled in the FEROS control window.]{%
\includegraphics[width=0.62\linewidth]{feros/ferosreboot-0.png}\label{fig:feosu-launch}%
}\hfill
\subfigure[Click \texttt{FULL}.]{%
\includegraphics[width=0.18\linewidth]{feros/ferosreboot-1.png}\label{fig:feosu-full}%
}\hfill\null\\
\null\hfill
\subfigure[Click \texttt{START}.]{%
\includegraphics[width=0.35\linewidth]{feros/ferosreboot-2.png}\label{fig:feosu-start}%
}\hfill
\subfigure[This black log opens. Later on a PDF will pop-up.]{%
\includegraphics[width=0.40\linewidth]{feros/ferosreboot-3.png}\label{fig:feosu-log}%
}\hfill\null\\
\null\hfill
\subfigure[Click \texttt{START}.]{
  \includegraphics[width=0.31\linewidth]{feros/ferosreboot-4.png}\label{fig:feosu-start2}%
}\hfill
\subfigure[When finished, rearrange the windows to their corresponding
\gls{desktop}s.  \gls{rtd}, \gls{bob} and FEROS control go to \texttt{BOB+gen state}.]{
  \includegraphics[width=0.45\linewidth]{feros/ferosreboot-5.png}\label{fig:feosu-windows}%
}\hfill\null
\caption[FEROS restart]{\gls{feros} restart.}
\label{fig:feros-restart}
\end{figure}

\newpage
\section{GROND and FEROS AG}
\begin{figure}[ht!]
\centering
\includegraphics[width=0.7\linewidth]{ag/ag-changecam.png}
\caption[Switching between GROND and FEROS guide cameras]{Switching between \gls{grond} and \gls{feros} guide camera.}
\label{fig:agswitch}
\end{figure}
Check that the \gls{grond} and \gls{feros} guide cameras work by
switching between them on the \gls{ag} window (see \figref{agswitch}).
The switching should set the camera in CCD status \texttt{Infinite loop}.  It 
may be necessary to click on \texttt{Start exposure} after switching to
obtain this status.  If status is \texttt{Fail}, the camera must be restarted (see  \secref{agfail}).

%\newpage
\section{FEROS DRS}
\begin{figure}[ht!]
\centering
\includegraphics[width=0.3\linewidth]{drs/DiskMonit.png}
\caption[FEROS DRS Disk Monitor]{\gls{feros} \gls{drs} Disk Monitor to check free disk space.}
\label{fig:diskmonit}
\end{figure}
%Check \gls{feros} \gls{drs} free disk space.  

\begin{figure}[ht!]
\centering
\includegraphics[width=0.45\linewidth]{drs/drs-changedate.png}
\caption[Changing the date of FEROS DRS]{Changing the date of the \gls{feros} \gls{drs}.}
\label{fig:drsswitch}
\end{figure}
The \gls{feros} \gls{drs} should be set to process the data of the 
current night.  In the process the \gls{midas} session (with its characteristic
blue window) is closed and reopened.  

\section{Additional material}
\subsection{Harmless error messages}
\begin{figure}[ht!]
\centering
\includegraphics[width=\linewidth]{tcs/tcs-wfi-connection-error.png}
\caption[Harmless error message of the TCS during WFI restart]{When restarting \gls{wfi}, the \gls{tcs} generally issues a harmless
error message.  Get over it and click \texttt{OK}.}
\label{fig:wfistarterror}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=.6\linewidth]{wfi/wfi-ccs-alarm.png}
\caption[Harmless alarm display on WFI during TCS restart]{\texttt{CSS ALARM DISPLAY} will typically pop-up on the \gls{wfi}
screen with a line in red when the \gls{tcs} is restarted.  Get over it and
hide the window.}
\label{fig:wfialarm}
\end{figure}

\subsection{Display settings}
\begin{figure}[ht!]
\null\hfil
\subfigure[Optical]{\includegraphics[width=0.60\linewidth]{grond/grond-rtd-flips.png}\label{fig:flip}}%
\hfil
\subfigure[Infrared]{\includegraphics[width=0.20\linewidth]{grond/grond-irtd-flips.png}\label{fig:iflip}}
\hfil\null
\caption[Correct sky orientation of the GROND displays]{Correct sky orientation of the \gls{grond} displays. The infrared one
is receiving data in real time (green checkbox).}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\chapter{Afternoon: Day-time calibrations}
\label{chap:daycal}

The day-time observations use \glspl{ob} either stored in \gls{bob} or in a
\gls{vot} queue.  Managing \glspl{ob} with \gls{bob} and \gls{vot} is
explained in more detail in \chapref{ob}.

\section{WFI}
Internal calibrations and health checks are typically left running in the morning after the \gls{slit} has been closed.  See Sect.~\ref{sec:clocal}.

\procedure{WFI dome flat-fields}
   \begin{enumerate}
     \item Ensure that no one is in the \gls{dome} nor will enter it before
     starting the \gls{dome flats}.
     \item Prepare the telescope.
         \begin{enumerate}
            \item If hydraulics is off, switch it on and wait for connection with \gls{vme} 
                \begin{enumerate}
                    \item On the \gls{domefunc} panel click \texttt{Hydr On} then \texttt{Drives On}.
                    \item On the \gls{TCS control panel}, check if red message appears  \texttt{no connection}.
                    \item If it is the case, wait for it to disappear (about 2 min)
                \end{enumerate}
            \item If hydraulics were off, initialise telescope
                \begin{enumerate}
                    \item On the \gls{TCS setup panel}, click \texttt{Tel Init}
                    \item Wait for the telescope status on the \texttt{TCS control panel} to go from \texttt{WaitIni} to \texttt{Slew} (2 min)
                \end{enumerate}
            \item \Gls{preset} to flat-field screen
            \begin{enumerate}
                \item Go to the \gls{TCS setup panel} (\figref{tcssetup}) on screen \texttt{Telescope Control Software}.
                \item Put \texttt{Dome} on \texttt{automatic}.
                \item \Gls{preset} the telescope to flat-field screen.\\
                  Click \texttt{FF Scr} below \texttt{Fixed Presets}
                \item Wait for the movement to complete (2 min) before starting the flat-field \gls{ob}.\\
                  On the \gls{TCS control panel} (\figref{tcs}) telescope status is \texttt{Slew}.
            \end{enumerate}
            \item Prepare shutters and mirrors
            \begin{enumerate}
               \item Click \texttt{Open} under the \texttt{Main Mirror Cover}.
               \item Wait for opening to complete (2 min) before starting the flat-field \gls{ob}
               \item Open the \gls{wfi} \gls{protective shutter}.\\
                     In the \gls{auxfunc} (\figref{tcsauxfunc}), \texttt{OPEN} the \texttt{WFI PROTECTIVE SHUTTER}.
               \item Ensure the GROND \gls{M3} mirror is on WFI
               \item Ensure the FEROS \gls{mirr3} mirror is on FEROS
             \end{enumerate}
         \end{enumerate}
     \item Prepare the flat-field \gls{ob}
     \begin{enumerate}
        \item Go to \gls{bob} on the screen \texttt{BOB Wide Field Imager}.
        \item Fetch \gls{bob} from file (\fetchob) looking in sub-folder \texttt{DomeFlats}.
        \begin{itemize}
           \item If observing in UBVRI standard filtres: \texttt{DomeFlatCalPlan\_new.obd} (25 min).
           \item During an observing period or a \gls{visitor} run, a custom \gls{ob} may be used\\
    For instance: \texttt{DomeFlatsP103.obd} or \texttt{DomeFlatsVisitorName.obd}
           \item To choose filtres on the fly: \texttt{DomeFlatGeneric\_new.obd}.
           \item To test all filtres: \texttt{DomeFlatAllSnapshot.obd} (1 flat per filtre, 2 hrs 30 min).
        \end{itemize}
        \item If choosing filtres on the fly, customise the ob
              \begin{enumerate}
                 \item Open the \gls{dome flats} \gls{template}, left-clicking on the triangle of \texttt{WFI\_img\_cal\_DomeFlat\_new}
                 \item Open the instrument section, left-click on the triangle of section \texttt{INS}
                 \item Use \wmenu{Interface}{Engineering}.
                 \item Middle-click the filtre name, fill in value, and type enter.\\
                       Name is \texttt{ESONNN\_name/width} (\texttt{NNN}: number, \texttt{name}: filtre name or wavelength)\\
                       In \gls{desktop} \texttt{WFI ICS}, a filtre list is found below \texttt{SETUP Instrument}
                 \item Deactivate the filtres you don't want.\\
                       Right-click the triangles to get a thumb down
              \end{enumerate}       
     \end{enumerate}
     \item Execute \gls{ob} (15--30 min usually).
     \item If no other types of flats fields are done, park the telescope 
     \begin{enumerate}
         \item Go to the \gls{TCS setup panel} on screen \texttt{Telescope Control Software}.
         \item \texttt{Close} to the \texttt{Main Mirror Cover}.
         \item Set the \gls{dome} in \texttt{Manual}.
         \item Click \texttt{Zenith} below \texttt{Fixed Presets} (2 min)
         \item Close the \gls{wfi} \gls{protective shutter}.\\
           In the \gls{auxfunc} (\figref{tcsauxfunc}), \texttt{CLOSE} the \texttt{WFI PROTECTIVE SHUTTER}.
     \end{enumerate}
     \item If telescope will stay idle for hours, switch hydraulics off.
   \end{enumerate}



\section{FEROS}

A linearity check is left running in the morning (see Sect.~\ref{sec:clocal}). The standard \gls{feros} calibration is generally done after startup.  It is internal in a separate room, so it can be done while doing telescope movements, going to the \gls{dome}, or even \gls{wfi} or \gls{feros} observations.

\procedure{FEROS afternoon calibrations}
\begin{enumerate}
  \item Go to screen \texttt{FEROS BOB}.
  \item Check that FEROS does not communicate with the telescope\\
        On the \texttt{FEROS \gls{General State}} panel, use \wmenu{Telescope}{Ignore}.
  \item Execute \texttt{StanCalNorm.obd} from \gls{bob} ($\approx 1$\,h).
    \begin{enumerate}
       \item Use \fetchob.
       \item Click \texttt{Start}.
    \end{enumerate}
  \item Check that the \gls{drs} has processed it.  \textbf{While Fabry-Pérot stays installed, it will fail.}
    \begin{enumerate}
      \item Find a white graphics with title \texttt{OBJ FIB GUESS}.
      \item The wavelength solution should have $4 \times 10^{-3}$ Angstrom
         rms or less and look flat.
      \item If not, restart calibration if possible.
    \end{enumerate}
\end{enumerate}

\section{GROND}

GROND calibrations are left running in the morning after the \gls{dome} has been closed (see Sect.~\ref{sec:clocal}). Some observers may ask for GROND linearity calibration using \gls{dome flats}, providing the observing blocks and a detailed explanation.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Sunset: Getting ready}
\label{chap:sunset}

\section{Opening}
\label{sec:open}

Opening should take place about one or two hours before sunset if conditions allow it. In case of doubts, always ask to the day-time Telescope \& Instrument Operator of ESO.

\procedure{Dome opening and telescope readying}
\label{proc:open}
\begin{enumerate}
\item Check that the \gls{slit} is oriented opposite to the Sun. It does not apply when opening at night.
        \begin{enumerate}
            \item On the \gls{rose diagram} of the \gls{TCS control panel}, it should be to the East
            \item If not, rotate manually in the \gls{TCS setup panel}
        \end{enumerate}
\item Open the \gls{slit}\label{list:slitopen}
         \begin{enumerate}
           \item Go to the \gls{tcs} setup panel (\figref{tcssetup})
           \item Check that the value below \texttt{Main Mirror Cover} is \texttt{closed}.
           \item If not, click \texttt{Close} (2 min).
           \item n the \gls{tcs} setup panel (\figref{tcssetup}), below \texttt{slit}, click \texttt{Open} (1 min)
         \end{enumerate} 
\item Turn on the Dome Air in the \gls{domefunc} (\gls{windows}, \figref{domefunc}).
\item If opening during the night, you can directly prepare the telescope (\procref{ready}).
\end{enumerate}

\section{Telescope readying}

\begin{figure*}
\centering
\subfigure[Sky flat field selection]{\includegraphics[width=0.35\linewidth]{tcs/ff/tcs-ff-cat-select-01.jpg}\label{fig:emptyfield-1}}%
\hspace{0.1\linewidth}%
\subfigure[Catalogue selection]{\includegraphics[width=0.35\linewidth]{tcs/ff/tcs-ff-cat-select-02.jpg}\label{fig:emptyfield-2}}%
\caption[Presetting to an empty field for flat-fielding]{Presetting to an empty field for flat-fielding.  The \texttt{Presetting} section allows the user to select a catalogue (\texttt{Cat.Select}), select a field within the selected catalogue (arrows \texttt{Up}/\texttt{Dn}), and presetting there (\texttt{Preset}).}
\label{fig:emptyfield}
\end{figure*}

A bit before sunset if doing \gls{sky flats} or at sunset otherwise, you can ready the telescope and point to an empty field.

\procedure{Telescope readying}\label{proc:ready}
\begin{enumerate}
\item Prepare the telescope
         \begin{enumerate}
            \item If hydraulics is off, switch it on and wait for connection with \gls{vme} 
                \begin{enumerate}
                    \item On the \gls{domefunc} panel click \texttt{Hydr On} then \texttt{Drives On}.
                    \item On the \gls{TCS control panel}, check if red message appears  \texttt{no connection}.
                    \item If it is the case, wait for it to disappear (about 2 min)
                \end{enumerate}
            \item If hydraulics were off, initialise telescope
                \begin{enumerate}
                    \item On the \texttt{Telescope Setup} panel, click \texttt{Tel Init}
                    \item Wait for the telescope status of  the \gls{TCS control panel} to go from \texttt{WaitIni} to \texttt{Slew} (2 min)
                \end{enumerate}
	\item\label{list:mirropen}Open the \gls{main mirror} cover
            \begin{enumerate}
               \item Click \texttt{Open} under the \texttt{Main Mirror Cover}.
               \item Wait for opening to complete (2 min) before starting the flat-field \gls{ob}
            \end{enumerate}
        \end{enumerate}
        \item \Gls{preset} to an empty field if doing \gls{sky flats}, a test with GROND, or readying before sunset (\figref{emptyfield})
               \label{list:presetempty}         
            \begin{enumerate}
            \item Go to the \gls{TCS control panel} (\figref{tcs}) 
            \item Below \texttt{Catalogue Handling} click \texttt{Cat. Select} (\figref{emptyfield-1}).
            \item Choose \texttt{Empty Fields 2011} (\figref{emptyfield-2})
            \item Select field with \texttt{Up} and \texttt{Dwn}. (\figref{emptyfield-1})\\
                  Right ascension should be about 1 hour more than sidereal time at sunset.\\
                  Consider field quality: excellent, good, OK, poor.
            \item Click \texttt{Preset}. (\figref{emptyfield-1})
            \end{enumerate}      
         \item Set the \gls{dome} motion in automatic.\label{list:domeauto}\\
               On the \gls{tcs} setup panel (\figref{tcssetup}), below \texttt{Dome}, select the checkbox \texttt{Automatic}.
\end{enumerate}


\section{Making the instruments ready (at sunset)}
\label{sec:insprep}

\procedure{Making instrument ready}\label{proc:insready}
\begin{enumerate}
   \item Activate the connection between instruments and telescopes
       \begin{enumerate}
         \item On the \gls{feros} control panel (\figref{feroscon}), use \wmenu{Telescope}{Enable}.
         \item On the \gls{grond} control panel (\figref{grondcon}), click \texttt{TCS ON}.
         \item Refresh the \gls{wfi} general state panel (\figref{wfigen}).
               \begin{itemize}
                 \item Use \wmenu{Std. Options}{Refresh Database values}.
                 \item Check that \texttt{TCS} is \texttt{ONLINE}.
               \end{itemize}
       \end{enumerate}
  \item  Open the instrument covers
    \label{list:opencov}
     \begin{enumerate}
        \item In the \gls{auxfunc} (\figref{tcsauxfunc}), open the 
              \gls{wfi} \gls{protective shutter}.
        \item For \gls{grond} observations, in a terminal open the \gls{mc}, the \gls{cs}, and the optical ones through these commands
            \begin{enumerate}
              \item \texttt{\gls{grondMC} OPEN}
              \item \texttt{\gls{grondCS} OPEN}
              \item \gls{grondSHUTTER}
            \end{enumerate}
     \end{enumerate}
  \item Check for mirrors
     \label{list:checkmirror}
     \begin{enumerate}
        \item Check \gls{feros} mirror (\texttt{\gls{M3} Selected Mirror}) on the \gls{feros} control panel (\figref{feroscon}).\\
              If necessary, set \texttt{\gls{mirr3}} motor on the \gls{ferosics} (\figref{ferosics})
              \begin{itemize}
                \item to \texttt{WFI} for observations with \gls{wfi} or \gls{grond};
                \item to \texttt{FEROS} for observations with \gls{feros}.
              \end{itemize}
              (Select the \texttt{\gls{mirr3}} check box, select instrument, click \texttt{SETUP}, deselect checkbox.)
        \item Check \gls{grond} \gls{M3} mirror on the \gls{grond} control (\figref{grondcon}).\\
              If necessary, type 
              \begin{itemize}
                  \item \texttt{\gls{grondM3} WFI} for \gls{feros} or \gls{wfi} observations
                  \item \texttt{\gls{grondM3} GROND} for \gls{grond} observations.
              \end{itemize}
     \end{enumerate}
  \item If no test \gls{ob} with TCS on was done during the start-up, try to run a \gls{grond} test OB (\texttt{1min1TD\_test.obd}) on sky using \gls{bob} (\figref{grondbob}).
     \begin{enumerate}
       \item Fetch \gls{ob} with \fetchob.
       \item Click \texttt{Start}.      
       \item If an error occurs after the optical exposure has started
             \begin{itemize}
                \item Click \texttt{OK} on the error popups
                \item Wait for the exposure to finish
                \item In \gls{bob}, click on \texttt{Reset status}
                \item Click on start again.
                \item If error persists, close \gls{bob} and open it again
             \end{itemize} 
       \item For other errors, do a \gls{grondSHUTTER}, close bob and open it again.
     \end{enumerate}
\end{enumerate}

\section{Refining the night plan}

On the GROND remote observer screen at the side of the small laptop, one of the GROND team members should have contacted you by \texttt{slack} to indicate their observing plan, if they have some monitoring to do.  It generally consists of 1--3 targets to be observed within a time range, so that you try to accommodate with your own and/or other \gls{service} observations.  If it is detrimental to the other observations, there is sometimes some flexibility on which days they have their monitoring done, ask, but they have precedence.

If slack is closed, open a browser with the following link: https://slack.com/signin. Sign in to workspace grondobs.slack.com and continue. Use the credentials given on the cover of the laptop, account \texttt{lasillaskype} with password \texttt{pwd}$\star\star\star\star\star$. Under channel \texttt{remote\_observing} you can usually find the observing plan (late afternoon). 


%-------------------------------------------------------

\chapter{Twilight: On-sky calibrations}
\label{chap:nightcal}


\section{Outline}

\procedure{Summary of evening twilight operations}
\begin{enumerate}
    \item Flat-fielding
    \begin{enumerate}
        \item \gls{wfi} \gls{sky flats} can be done from sunset to sun at $-10$ degrees elevations depending on filtre.\\
        Standard filtres have that order: U, V, R, I, and B.\\
        Done daily if possible.
        \item \gls{grond} \gls{sky flats} are extensive and run from sun at $-4$ to $-9$ degrees elevation.\\
        To be started when 2s J-band exposures feature a
        relatively flat field with 20\,000 counts.\\
        Done weekly.
    \end{enumerate}
    \item Pointing \& Focus
    \begin{enumerate}
        \item Pointing check should be performed daily.  One basically points at
        a bright star and checks it falls where expected.  You may use
        one of these methods:
        \begin{itemize} 
            \item with \gls{wfi}, using an \gls{ob} from \gls{bob}.
            \item with \gls{feros}, using a \gls{spectrophotometric standard} or \gls{focus} \gls{ob}.
        \end{itemize}
        \item Focus is best done daily.  If conditions are stable, at the beginning of the night, but may be delayed in case of bad seeing, fast varying temperature, or late opening.  
        \begin{enumerate}
            \item \gls{feros} \gls{focus} should be performed nightly using an \gls{ob} from \gls{bob}
            \item \gls{wfi} \gls{focus} should be done closest to science observations.
            \item \gls{grond} \gls{focus} is usually not performed.
        \end{enumerate}
    \end{enumerate} 
    \item Standards
    \begin{enumerate}
        \item The \gls{feros} standards are
        \begin{enumerate}
            \item \Glspl{spectrophotometric standard} included in the Focus+Standard \glspl{ob}.
            \item \Glspl{rv standard} by IAU and Soubiran, available from \gls{bob}
        \end{enumerate}
        \item \gls{wfi} Landolt \glspl{standard field} are available from \gls{bob}.
        \item \gls{grond} SDSS \glspl{standard field} are available from \gls{bob}.\\
            The \gls{grond} team usually explicitly asks for them.    
    \end{enumerate}
\end{enumerate}

\section{WFI}


\subsection{Sky flats}
\label{sec:wfiflats}
\Gls{sky flats} in most narrow-band filtres and the darkest broad-band ones ($U$ \& $V$) should be started right at sunset or slightly before sunrise.  The brightest
broad band filtres ($R$, $I$, $B$) can be obtained with the sun at $-6$ to
$-9$ degrees approximately.  It is possible to obtain the five standard filtres in one twilight provided they are started at sunset or in the morning twilight when the sun is at $-9$ degrees.

The procedure has been somehow modified (January 2014).  

\procedure{Taking sky flats with WFI}
\begin{enumerate}
  \item If not done, check that \gls{dome} and \gls{main mirror} cover are open (\procref{open}). 
  \item If not done, check \gls{grond} \gls{M3} and \gls{feros} \gls{mirr3} mirrors (\procref{insready}, point~\ref{list:checkmirror}).
  \item If not done, check that the WFI \gls{protective shutter} is open (\procref{insready}, point~\ref{list:opencov}).
  \item If not done, point the telescope to an empty field (\procref{ready}, point~\ref{list:presetempty}).
      \begin{enumerate}
         \item Go to \texttt{TCS control panel} the on screen \texttt{Telescope Control Software}.
         \item Below \texttt{Catalogue handling} click \texttt{Cat. Select} (\figref{emptyfield-1}).
         \item Choose \texttt{Empty Fields 2011} (\figref{emptyfield-2})
         \item Select field with \texttt{Up} and \texttt{Dwn}. (\figref{emptyfield-1})\\
               Right ascension should be about 1 hour from sidereal time, opposite to the Sun.\\
               Consider field quality: excellent, good, OK, poor.
         \item Click \texttt{Preset}. (\figref{emptyfield-1})
      \end{enumerate}
  \item Go to \gls{bob} on screen \texttt{BOB Wide Field Imager}.
  \item Fetch \gls{sky flats} \gls{ob} from file (\fetchob).\\
        (Go to folder \texttt{.../TEMPLATES/OBD/SkyFlats/})
    \begin{itemize}
       \item For standard filtres use \texttt{SkyFlatsEveningCalPlan.obd}\\
           (\texttt{SkyFlatsMorningCalPlan.obd} in the morning)
       \item Some other filtres have their own flat \glspl{ob} (e.g. \texttt{SkyFlatsI203}).
       \item For a set of non standard filtres use \texttt{SkyFlatsGeneric.obd}.
    \end{itemize}
  \item If not doing the standard filtres, customise \gls{ob}.
    \begin{enumerate}
       \item For non standard filtres, edit the filtre names.
             \label{list:editfilt} 
              \begin{enumerate}
                 \item Open the \gls{sky flats} \gls{template}, left-clicking on the triangle of \texttt{WFI\_img\_cal\_DomeFlat}
                 \item Open the instrument section, left-click on the triangle of section \texttt{INS}
                 \item Use \wmenu{Interface}{Engineering}.
                 \item Middle-click the filtre name, fill in value, and type enter.\\
                      (In \gls{desktop} \texttt{ICS}, a filtre list is found below \texttt{SETUP Instrument})
              \end{enumerate}
       \item Deactivate unneeded \gls{template}s.\\
             Right-click the triangles to get a thumb down.
    \end{enumerate}
  \item Execute \gls{ob}
    \begin{enumerate}
      \item Click \texttt{Start}.
      \item For each \gls{template}
       \begin{enumerate}
         \item \label{list:flattestexp}A test exposure is taken. (1 min)
         \item A pop-up estimates the exposure time. (a few seconds)
         \item If it is too late (too dim in the evening), the \gls{template} will be skipped.
         \item If it is too early (too bright in the evening), the \gls{template} will restart from point~\ref{list:flattestexp}.
       \end{enumerate}
    \end{enumerate}
\end{enumerate}


\subsection{Pointing} 

\subsubsection{Pointing with FEROS}

If starting with FEROS, you can use the \gls{focus} and/or \gls{spectrophotometric standard} star \gls{ob} to check \gls{pointing}.

\procedure{Ensure that pointing is correct using FEROS}
\begin{enumerate}
  \item Update the \gls{pointing model} parameters
  \begin{enumerate}
     \item Go to the \texttt{Telescope Control Software} workstation.
     \item Open or use a UNIX terminal.
     \item Type  \~{}\texttt{/bin/fixPointing.sh}
  \end{enumerate}
  \item Change \gls{pointing model} to FEROS.
  \begin{enumerate}
    \item Go to the \gls{TCS status panel} (\gls{desktop} \texttt{Status}, see \figref{tcsstatus}).
    \item Use \wmenu{Instrument selection}{FEROS}
  \end{enumerate}
  \item Check the sidereal time
  \begin{enumerate}
    \item On the digital clock of the \gls{control room}, switch display to sidereal time.
    \item Go to the \gls{TCS control panel} (\gls{desktop} \texttt{Control}).
    \item The sidereal time of the TCS Control Panel should lag by approximately 5 s. 
  \end{enumerate}
  \item Point at a FEROS \gls{focus}/\gls{spectrophotometric standard} star. See \secref{ferosfocus}.
\end{enumerate}

\subsubsection{Pointing and autoguider test with WFI}

If things go well, the bright star used for the \gls{pointing} test should fall a few hundreds of pixels from the centre of the mosaic in the North-West direction (as of 2019). 
\procedure{WFI pointing}
\begin{enumerate}
  \item Switch the instrument to \gls{wfi} on the \gls{tcs} status panel.\\
    (\texttt{Instrument Selection}, \figref{tcsstatus}. Do it even if it already says \gls{wfi}).\label{list:switchwfi}
  \item If not done, check that dome and \gls{main mirror} are open, and dome is in automatic.\\
    (Refer to \secref{open}, points~\ref{list:slitopen}, \ref{list:mirropen} and \ref{list:domeauto}). 
  \item If not done, check \gls{grond} \gls{M3} and \gls{feros} \gls{mirr3} mirrors (\secref{insprep}, point~\ref{list:checkmirror}).
  \item If not done, check that the WFI \gls{protective shutter} is open (\secref{insprep}, point~\ref{list:opencov})\label{list:pointing:opencov}.
  \item Go to \gls{bob} on screen \texttt{BOB Wide Field Imager}.
  \item Fetch \gls{pointing} \gls{ob} from file (\fetchob).\\
        (Go to folder \texttt{.../TEMPLATES/OBD/Pointing/})
        \begin{itemize}
           \item \glspl{ob} are \texttt{Pointing-<ra>h.obd}, where \texttt{<ra>} is the right ascension.
           \item Chose an OB with \texttt{<ra>} close to sidereal time.
        \end{itemize} 
  \item After the exposure is taken, accept ``refine \gls{acquisition}''.\\
        A small form asking for the star's coordinates will appear.
  \item Use \wmenu{View}{Pick Object} in the \gls{rtd} to obtain the star's pixel coordinates.  
  \item Input the pixel coordinates.\\
        Copy them with the mouse from the \gls{pickobj} popup to the small form. 
  \item After \texttt{offset and quit} a popup should have appeared.\\
        Click \texttt{OK} if satisfied with the offset values (in arcsec).
  \item If no star at all is seen, see 
    \secref{trouble:pointing} to check that:
    \begin{enumerate}
      \item You did not forget Points \ref{list:switchwfi}-\ref{list:pointing:opencov}.
      \item The sidereal time of the \gls{tcs} is correct within seconds.
      \item The pointing parameters of the \gls{tcs} are correct.
      \item Check that the star does not fall into the gap between two CCDs. (Give coordinates falling in the gap to the pop-up, offset and reacquire. 
      \item Once you have a star, as long as the offset is large, use \texttt{offset and reacquire}
      \item If the correct \gls{pointing model} is selected, that should not take more than 2-4 repeats (max 10 min).
    \end{enumerate}
  \item At that point, the \gls{pointing} is done, and a small test of the
        autoguider is done.\\
        If it crashes, it has no impact on the \gls{pointing}
        check.  You can skip it if you do not intend to use the WFI autoguider.
  \item When asked, acquire a guide star on the \gls{tcs}.\\
        On the \gls{TCS control panel}, follow the steps of \secref{guidewfi}\\
        If it is still too bright to click on a guide star, click on background.
  \item Click \texttt{OK} to the popup asking for guiding on the \gls{wfi} workstation.
  \item Wait for a short exposure to read out (30 sec).
%  \item When the pointing OB is finished (with small offsets to the nominal position) do not forget to press \texttt{Corr.Co} in the \gls{tcs} Setup panel, under Telescope.
\end{enumerate}

\subsection{Focus}

\gls{focus} with \gls{wfi} should be preferrably done close in time and telescope position to the target's.  It is not necessary to use the same filtre as the observation, but using the same one saves about 2\,min. in particular if the observation uses a narrow band or a dimm filtre ($U$), for WFI knows the focus offsets between filtres.  Using the same filtre saves about 2\,min. 

It is possible to skip the focus if an \gls{acquisition} or test image shows sharp, round stars or if the seeing is too bad ($\gtrsim 2$). It is advisable to (re)focus once conditions have stabilised, a few hours into the night, if on-chip seeing is critical.

\begin{figure*}
\centering
\subfigure[Selecting focus OB]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-01-ob-selection.jpg}\label{fig:wfifocus-1}}
\hfill
\subfigure[Start the WFI autoguider]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-02-start-guiding.jpg}\label{fig:wfifocus-2}}
\\
\subfigure[Monitor focus offsets]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-03-subexposures.jpg}\label{fig:wfifocus-3}}
\hfill
\subfigure[Click on the upper star (\gls{midas})]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-04-click-upper-star.jpg}\label{fig:wfifocus-4}}
\\
\subfigure[If 1st measurement is useless, \texttt{Re-measure}]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-05-measurement-1.jpg}\label{fig:wfifocus-5}}
\hfill
\subfigure[If 2nd measurement if fine, \texttt{OK}]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-06-measurement-2.jpg}\label{fig:wfifocus-6}}
\\
\subfigure[Choose to log if it went fine]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-07-log-focus-value.jpg}\label{fig:wfifocus-7}}
\hfill
\subfigure[OB fully executed]{\includegraphics[width=0.45\linewidth]{wfi/focus/wfi-focus-08-ob-finished.jpg}\label{fig:wfifocus-8}}
\caption[Main steps in the focus sequence of WFI]{Main steps in the \gls{focus} sequence of \gls{wfi}.}
\label{fig:wfifocus}
\end{figure*}

\procedure{Focusing with WFI}\label{proc:wfifocseq}
This procedure lasts a bit less than 10 minutes.
\begin{enumerate}
    \item Prepare telescope and filtre for focusing (1--3\,min)
    \begin{enumerate}
        \item If focusing in the same field and filtre as a target's, use the target OB's preset.
        \begin{enumerate}
            \item Load \gls{ob} for the target.
            \item Thumb-down all templates except the \gls{acquisition}.
            \item If template contains an acquisition image, decrease exposure time to 10\,s.
            \item Start ob.
            \item If it asks for \acrlong{ag}, acquire it (\procref{guidewfi}).
            \item If it asks to refine acquisition after an image pops-up, skip it.
            \item If an image pops-up and stars appear round and sharp enough for the science goal, you may skip the focusing altogether.
        \end{enumerate}
        \item If focusing in another field and filtre, do it manually
        \begin{enumerate}
            \item In the \gls{TCS control panel}, enter the coordinates and click \texttt{Preset} 
            \item In the \gls{wfiics}, choose the filtre and click \texttt{???} 
            \item Wait for telescope and filtre movements to complete (2--3\,min).
            \item In the \gls{TCS control panel} and \gls{skycat}, acquire \acrlong{ag} (\procref{guidewfi}, 1\,min)
        \end{enumerate}
    \end{enumerate}
    \item Start the focus \gls{ob} (\figref{wfifocus-1} and perform \gls{ag} \gls{acquisition} if required (\figref{wfifocus-2})
    \begin{enumerate}
        \item In bob, use \wmenu{File}{Load OB,from file…}
        \item Double-click subfolder \texttt{.../TEMPLATES/OBD/Focus}
        \item Choose ob, e.g. \texttt{focusV.obd} or \texttt{focusCurrentFiltre.obd}
        \item Click \texttt{OK}
        \item Click \texttt{Start} on the OB
        \item If a pop-ups asks for \gls{ag}, acquire it (\procref{guidewfi}, 1\,min)
    \end{enumerate}
    \item Monitor the progress of the focus sequence on \gls{bob} and \gls{skycat} (\figref{wfifocus-3}, 6\,min).
    \begin{itemize}
        \item Guide star will disappear and reappear between all subexposures.
        \item If bob repeats a message about a \gls{focus} order for more than 10-15 s, you will need to enter the target values in the \gls{TCS control panel} for all subexposures starting from the one where problem appears (second one). Otherwise, the ob will crash.  See \procref{wfifocseqtimeout}.
    \end{itemize}
    \item Perform a dummy focus measurement (bug workaround)
    \begin{enumerate}
        \item Click \texttt{OK} on the pop-up asking to pick a star in \gls{midas} window (\figref{wfifocus-4})
        \item Go to \gls{desktop} \texttt{MIDAS} (\figref{wfifocus-5})
        \item Locate a black MIDAS window intended for graphics
        \item Left-click, then right-click close to its centre
        \item On the pop-up asking for confirmation, click \texttt{Redo}
    \end{enumerate}
    \item Perform focus measurement (\figref{wfifocus-6})
    \begin{enumerate}
        \item Click \texttt{OK} on the pop-up asking to pick a star in \gls{midas} window
        \item Find a vertical star sequence that is relatively separated from other ones
        \item On the same black window, use arrow keys to dimension a box
         centred on the cursor, so that it encompasses a star of the sequence,
         but not two.
        \item Left-click, then right click the upper star of the sequence
        \item Look at the graphics displaying the FWHM fit as a function of
         focus offset
        \item Decide what to do (confirm exact labels...)
        \begin{itemize}
            \item If the fit and optimum focus offset value are correct, click \texttt{OK}
            \item If the fit is not correct but you can spot the best focus value, \texttt{Enter best focus} in the popup and click \texttt{OK} 
            \item If you are not sure, click \texttt{Re-mesure} and pick another star sequence
            \item If it is clear that conditions have messed the focus, click \texttt{Do Nothing}.
        \end{itemize}
        \item Wait for a pop-up to ask whether to log the value (\figref{wfifocus-7}, 20\,s)
        \begin{itemize}
            \item If you are happy with the focus, click \texttt{OK}
            \item Otherwise, click \texttt{Do not log}
        \end{itemize}
        \item Wait for OB to finish (\figref{wfifocus-8}, 10\,s) 
    \end{enumerate}
\end{enumerate}

\subsection{Standard fields (quick tips)}

\procedure{WFI photometric standard fields}
\begin{enumerate}
  \item Go to screen \texttt{BOB Wide Field Imager}.
  \item If not done, switch the instrument to \gls{wfi} on the \gls{tcs} status panel
        (\figref{tcsstatus}).
  \item Fetch \gls{standard field} \gls{ob} from list 
    \begin{enumerate}
       \item Use \fetchob.
       \item Go to folder \texttt{.../TEMPLATES/OBD/Standards/}.
       \item Select \gls{ob}
          \begin{itemize}
            \item If good image quality in $U$ is needed, select \texttt{Standard-<RA>-<name>-UBVRI.obd}.
            \item If not, select  \texttt{Standard-noAG-<RA>-<name>-UBVRI.obd} (no guiding).
          \end{itemize}
    \end{enumerate}
   \item Customize OB.
     \begin{itemize}
       \item If non-standard filtres are needed, edit filtre names (\secref{wfiflats}, item~\ref{list:editfilt}).
       \item Deactivate unneeded \gls{template}s.\\
               (Right-click the triangles to get a thumb down.)
     \end{itemize}
   \item Execute \gls{ob} (20 min).
     \begin{enumerate}
        \item Click \texttt{Start}.
        \item For each filtre
         \begin{enumerate}
             \item Guide if required by a pop-up and click \texttt{OK}.
             \item A pop-up with number of dithers to skip must be answered (with value 0).\\
               If it doesn't appear it is hidden behind a window.  If left unanswered, observation will just pause. 
         \end{enumerate}
      \end{enumerate}
\end{enumerate}
   


\section{FEROS}
You can choose \gls{focus} only, or \gls{focus} and \gls{spectrophotometric standard}, which takes only 5 min more.  A \gls{rv standard} can be taken any time needed (they take 5-10 minutes with overheads).

\subsection{Focus}
\label{sec:ferosfocus}
\begin{figure*}
\subfigure[Started focus OB]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-1-bob.jpg}\label{fig:ferosfocus-1}}
\hfill
\subfigure[Acquire the bright star onto fibre]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-2-acquire.jpg}\label{fig:ferosfocus-2}}
\\
\subfigure[Check loop time in the autoguider]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-3a-loop-time.jpg}\label{fig:ferosfocus-3}}
\hfill
\subfigure[Confirm old focus value]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-3b-focus-value.jpg}\label{fig:ferosfocus-3b}}
\\
\subfigure[Select a focus star in MIDAS window]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-4-select-star.jpg}\label{fig:ferosfocus-4}}
\hfill
\subfigure[MIDAS window]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-5-midas.jpg}\label{fig:ferosfocus-5}}
\\
\subfigure[Focus fit]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-6-fit.jpg}\label{fig:ferosfocus-6}}
\hfill
\subfigure[Confirm the focus value (or not)]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-7-focus-value.jpg}\label{fig:ferosfocus-7}}
\\
\subfigure[Check correct centring of the bright star]{\includegraphics[width=0.45\linewidth]{feros/focus/feros-focus-8-centering.jpg}\label{fig:ferosfocus-8}}
\caption[Focus with FEROS]{\Gls{focus} with \gls{feros}.}
\label{fig:ferosfocus}
\end{figure*}

Focusing with \gls{feros} takes about 5 minutes.  It is summed up in \figref{ferosfocus} and detailed in \procref{ferosfocus}.

\procedure{FEROS focusing}\label{proc:ferosfocus}
\begin{enumerate}
  \item Perform the necessary checks and preparations for FEROS
  \begin{enumerate}
    \item Check that dome and \gls{main mirror} are open (\procref{open}).\label{list:ferosfocus1}
    \item Check \gls{grond} \gls{M3} and \gls{feros} \gls{mirr3} mirrors (see \secref{insprep}, point~\ref{list:checkmirror}).
    \item Check that the WFI \gls{protective shutter} is open (\secref{insprep}, point~\ref{list:opencov}).
    \item Select instrument \texttt{feros} on the \gls{TCS status panel} (screen \texttt{Telescope Control Software}).
  \end{enumerate}
  \item Start the focus \gls{ob}
  \begin{enumerate}
     \item Go to \gls{bob} on screen \texttt{FEROS \gls{ob}} and fetch \gls{focus} \gls{ob}:
     \item Use \fetchob.
     \item Select directory \texttt{.../TEMPLATES/OBD/Focus/}.
     \item Select \texttt{Focus-<ra>….obd} with \texttt{<ra>} close to sidereal time.
     \item Click \texttt{Start} (Fig.~\ref{fig:ferosfocus-1}).
  \end{enumerate}
  \item Acquire object on fibre and guide (see \secref{switchingFeros}, point~\ref{list:autoguiderFeros}, \& \secref{ferosguiding})
  \begin{enumerate}
     \item Click centering on the \gls{ferosag}\\
           It is located on \gls{desktop} \texttt{FEROS AG}, screen \texttt{Autoguider GROND \& FEROS}
     \item Click on the bright star
     \item Once on fibre, click start guiding on the \gls{autoguiding} panel.
     \item Once guiding, click on popup asking for acquisition (Fig.~\ref{fig:ferosfocus-2}).
  \end{enumerate}
  \item Perform the \gls{focus}
  \begin{enumerate}
     \item On the \gls{autoguiding} window, select numbers 6, 3, 0.2.
     \item After about 30\,s, click \texttt{OK} to pop-up asking to ensure loop time is more than 3 (Fig.~\ref{fig:ferosfocus-3})
     \item A pop-up asks and suggest a \gls{focus} estimate
       \begin{enumerate}
         \item If number is in range 300--500, it should be fine, click \texttt{OK}.
         \item If not, fill in last remembered value or, if you don't have any, 400, then click \texttt{OK}.
       \end{enumerate}
     \item\label{list:ferosfocus-select} Shortly after, a pop-up asks to select a star to \gls{focus} on (Fig.~\ref{fig:ferosfocus-4})
        \begin{enumerate}
           \item A \gls{midas} image appears, left and right-click on a non-saturated source (Fig.~\ref{fig:ferosfocus-5}). 
           \item Click \texttt{OK} to pop-up
        \end{enumerate}
     \item Wait for the focus to finish (5~min)
     \begin{enumerate}  
        \item The white graph window should have points a two curves fitting them (Fig.~\ref{fig:ferosfocus-6})
        \item A pop-up appears asking action to take about focus fit (Fig.~\ref{fig:ferosfocus-7})
     \end{enumerate}
     \item Take time to examine the focus fit quality and answer the popup: 
        \begin{enumerate}
           \item If it seems correct, click \texttt{OK}.
           \item If it seems incorrect, but you can spot a good \gls{focus} value by eye
             \begin{itemize}
                \item Click \texttt{No} 
                \item Give your guesstimate to new pop-up and click \texttt{OK}
             \end{itemize}
           \item If you think you can try on another star, click \texttt{Retry} and go to step~\ref{list:ferosfocus-select} ($\le 1$\,min).
           \item If you have no clue, just abort. No focus is performed.
        \end{enumerate} 
  \end{enumerate}
\end{enumerate}


\subsection{Focus and spectrophotometric standard}

You may deactivate the \gls{focus} sequence by thumbing down the second \gls{template} in \gls{bob} (10 min without focus).

\procedure{Focus and/or spectrophotometric standard}
\begin{enumerate}
\item Perform steps of \secref{ferosfocus} except that
   \begin{itemize}
     \item \gls{ob} directory is \texttt{.../TEMPLATES/OBD/Focus+Standard}
     \item \gls{ob} name is \texttt{Focus+Standard-<ra>….obd} with \texttt{<ra>} close to sidereal time. 
   \end{itemize}
\item After \gls{focus} is done, change integration time to 0.01 on the \gls{autoguiding} window.
\item Two pop-ups will ask to wait for object to be centred on the fibre.  Wait for it to occur and click \texttt{OK}.
\item Wait for \gls{spectrophotometric standard} template to integrate and read out (1 min)
\end{enumerate}

\subsection{Radial velocity standards}

\procedure{FEROS radial velocity standards}
\begin{enumerate}
  \item Got to \gls{bob} on screen \texttt{FEROS \gls{ob}} and fetch \gls{rv standard} \gls{ob}:
  \begin{enumerate}
     \item Use \fetchob.
     \item Select directory \texttt{../TEMPLATES/OBD/RVStandard}.
     \item Select \texttt{RVStandard…<ra>….obd} with \texttt{<ra>} close to sidereal time.
  \end{enumerate}
  \item Proceed with guiding and answer popups, that's a normal observation (about 5 - 10 min).
  \begin{enumerate}
    \item In the \texttt{e2p2 RTD} window, click \texttt{Centering} (below \texttt{Image Control}), then click on the object.
    \item In the \gls{autoguiding} window, set the integration time if necessary.
    \item OK on popups (\texttt{FEROS \gls{ob}}) when the object is centred.
  \end{enumerate}  
    
\end{enumerate}

\section{GROND}

\begin{figure*}
\centering
\subfigure[Loaded sky flat-field OB]{\includegraphics[width=0.45\linewidth]{grond/ff/grond-ff-00-bob.jpg}\label{fig:grondff-0}}%
\hspace{0.05\linewidth}
\subfigure[Setting integration time to 2\,s]{\includegraphics[width=0.45\linewidth]{grond/ff/grond-ff-01-irace.jpg}\label{fig:grondff-1}}%
\\
\subfigure[Menu View$\rightarrow$Cuts]{\includegraphics[width=0.3\linewidth]{grond/ff/grond-ff-02-cuts.jpg}\label{fig:grondff-2}}%
\hspace{0.1\linewidth}%
\subfigure[Cut line drawn on $J$-band detector]{\includegraphics[width=0.5\linewidth]{grond/ff/grond-ff-03-cuts.jpg}\label{fig:grondff-3}}%
\\
\subfigure[Cuts for saturated $J$-band detector]{\includegraphics[width=0.45\linewidth]{grond/ff/grond-ff-04-not-ready.jpg}\label{fig:grondff-4}}%
\hspace{0.05\linewidth}%
\subfigure[Cuts at 20,000 counts, ready to start flats]{\includegraphics[width=0.45\linewidth]{grond/ff/grond-ff-05-ready.jpg}\label{fig:grondff-5}}%
\caption[GROND evening sky flat-fields]{\gls{grond} evening \gls{sky flats}.}
\label{fig:grondff}
\end{figure*}

\subsection{Sky flats}

\paragraph{Evening flats}

Before taking evening flat fields, check the relevant items of ``no flux or little flux'' in \secref{noflux}. In particular the \gls{main mirror} cover should be open and the dome set in automatic.  The \gls{sky flats} typically start when the sun is 4 degrees below the horizon.  To be able to start on time, the following procedure should be started right at sunset.

\procedure{GROND evening flat fields}
\gls{grond} flat field \gls{ob} lasts about 30 min.
\begin{enumerate}
  \item If not done, check that dome and \gls{main mirror} are open (\procref{open}).
  \item If not done, point the telescope to an empty field (\procref{ready}, point~\ref{list:presetempty}).
  \item If not done, set the dome in automatic.
  \item Go to \texttt{GROND BOB} screen.
  \item If not done in the evening, do some prophylaxis (\procref{startup}, points~\ref{list:grond-prophylaxis} and \ref{list:grond-testtcs})
     \begin{enumerate}
       \item Close \gls{bob}.
       \item In the terminal, type \gls{grondGRI}.
       \item In the terminal, type \texttt{\gls{grondSHUTTER} \&\& \gls{grondFM}} (may last 1 min).
       \item From the terminal, launch a new \gls{bob} with \texttt{bob \&}.
       \item Execute a \texttt{1min1TD\_test.obd} with \gls{tcs} \texttt{ON}.
     \end{enumerate}
  \item Insert \gls{M3} mirror and open shutters
     \begin{enumerate}
       \item In the terminal, type \texttt{\gls{grondM3} GROND}.
       \item In the terminal, type \texttt{\gls{grondMC} OPEN}.
       \item In the terminal, type \texttt{\gls{grondCS} OPEN}.
     \end{enumerate}
  \item Get \gls{sky flats} \gls{ob} ready (\figref{grondff-0})\\
         In \gls{bob}, fetch \gls{ob} \texttt{GROND\_img\_cal\_skyflats\_ev}\\
         (use \texttt{Flats/} folder).
  \item Monitor the $J$-band counts.
        \begin{enumerate}
           \item Go the the \texttt{GROND infrared (IRACE)} screen.
           \item Set the IR integration time to 2\,s (\figref{grondff-1}).
              \begin{itemize} 
                 \item Find window \texttt{Infrared Acquisition Module} (see \figref{grondirace}).
                 \item Close to the \texttt{INTEGRATION TIME}, fill in value 2.
                 \item Press enter (Don't do \texttt{Apply}.)
              \end{itemize}
           \item Draw cuts in the infrared image.
              \begin{itemize}
                 \item Go the the \gls{irtd} window.
                 \item Go the the $J$-band (right handside)
                 \item Use \wmenu{View}{Cuts…}, then click \texttt{OK} on the pop-up (Figures \ref{fig:grondff-2}--\ref{fig:grondff-3}).
                 \item Draw a diagonal on the image with the mouse.
              \end{itemize}
           \item Wait for the cuts to look flat and with about 20\,000 counts.
            (Figures~\ref{fig:grondff-4}--\ref{fig:grondff-5})\\
           This should occur when the sun is about 4 degrees below the horizon.
        \end{enumerate}
  \item When counts are OK, on the \texttt{GROND BOB} screen, click \texttt{Start} in \gls{bob}. 
\end{enumerate}

\paragraph{Standards}

\procedure{GROND standard field observation}
The procedure lasts 7 min.
\begin{enumerate}
       \item Select an SDSS \gls{standard field} close to the meridian\\
             In \gls{bob} use \fetchob{} and select one in sub-folder \texttt{Standards}
       \item Execute it by clicking \texttt{Start}
       \item You can ignore guiding and click \texttt{OK} if the \texttt{ob asks for it}
\end{enumerate}


\paragraph{Morning flats}
Morning \gls{sky flats} are trickier to get right. They should be started when the sun is at 9 degrees below horizon.

\procedure{GROND morning flat fields}
\begin{enumerate}
  \item Point the telescope to an empty field as explained in \secref{open}.
  \item Go to \texttt{GROND BOB} screen.
  \item Insert \gls{M3} mirror and open shutters (if you were not already with \gls{grond})
     \begin{enumerate}
       \item In the terminal, type \texttt{\gls{grondM3} GROND}.
       \item In the terminal, type \texttt{\gls{grondMC} OPEN}.
       \item In the terminal, type \texttt{\gls{grondCS} OPEN}.
     \end{enumerate}
  \item Get \gls{sky flats} \gls{ob} ready\\
        In \gls{bob}, fetch \gls{ob} \texttt{GROND\_img\_cal\_skyflats\_mo}.\\
               (Use \texttt{Flats/} folder.)
  \item When sun is at 9 degrees below horizon, click \texttt{Start} on \gls{bob}.
\end{enumerate}

\subsection{Focus}

The \gls{focus} of \gls{grond} is stable and managed periodically by the \gls{mpe} team.  Defocused observations can be obtained by specifying a \gls{focus} offset in the \gls{ob}.

The \gls{ag} can also be focused separately from the instrument, in case of defocused observations (I don't remember how to open the new GUI though).


\subsection{Photometric standard fields}

There are \glspl{ob} for Landolt and SDSS \glspl{standard field} that can be fetched from file with \gls{bob} (10 min).

\subsection{RRM online}
In the \texttt{GROND \gls{General State}} panel (\figref{grondcon}), click \texttt{\gls{rrm} ONLINE} at the end of the twilight (beginning of the night) to allow for remote observations with this instrument.




%----------------------------------------------------------------------------------------

\chapter{Night: Observing}
\label{chap:nightops}

\section{WFI}

\subsection{Popup handling}

\gls{bob} will generally throw a few pop-ups during a typical observation. Failing  to answer them, nothing will happen and time will be irremediably lost.  These pop-ups may appear behind windows, so be proactive.

At the beginning of an observation, you may have have popups asking
\begin{itemize}
    \item to refine acquisition (\secref{refinewfi}), i.e. recentre the object of interest if the observer has specifically asked for a precise position of his target.  Three successive popups will ask whether to recenter, enter the pixel coordinates of the object, and whether to offset and/or refine again.
    \item to acquire the guiding (\secref{guidewfi}), which you will click once you have done it.  Almost all science observations will ask  for it.
\end{itemize}

During an observation, it can happen that guiding acquisition is asked for several time
\begin{itemize}
    \item For an observation with large dithers (\texttt{COMBINED.OFFSET} is \texttt{F}) the guiding will be asked at the beginning of each exposure. 
    \item For an observation with different filtres, it will be asked for if at each filtre change.
\end{itemize}

Error popups may also appear, see \chapref{trouble}.

\subsection{Switching to WFI}

You may start an \gls{ob} once point \ref{list:pmwfi} has been done.  This minimises
overheads by parallelising \gls{preset} and mirror movements.  However, beware that some\gls{acquisition} \gls{template}s (movetopixel and movetogap) don't ask before taking the acquisition image, so you should be faster than preset.  

\procedure{Switch to WFI observations}
\begin{enumerate}
  \item Open the \gls{wfi} \gls{protective shutter}.
  \item Switch the \gls{pointing model} to \gls{wfi}.\label{list:pmwfi}
  \begin{enumerate}
    \item Go to screen \texttt{Telescope Control Software}.
    \item Go to the \gls{TCS status panel} (\gls{desktop} \texttt{Status}, see \figref{tcsstatus}). 
    \item Use \wmenu{Instrument selection}{WFI}
  \end{enumerate}
  \item Check the \gls{grond} \gls{M3} mirror.\\
        Go to screen \texttt{GROND BOB}.
  \begin{enumerate}
      \item Ensure that the \gls{M3} mirror is on \gls{wfi}.\label{list:wfi:checkm3}
      \begin{enumerate}
         \item Go to the GROND \gls{General State} panel (\gls{desktop} \texttt{BOB+gen state}).
         \item Check the value of \texttt{GROND \gls{M3}}.
      \end{enumerate}
      \item If it is on \gls{grond}, set it to \gls{wfi}.\\
            In a terminal, type \texttt{\gls{grondM3} WFI}.\\
            Redo point \ref{list:wfi:checkm3} (value should be MOVING then WFI).
  \end{enumerate}
  \item Check the \gls{feros} \texttt{\gls{mirr3}} mirror.\\
        Go to screen \texttt{FEROS BOB}.
  \begin{enumerate}
      \item Ensure that the mirror is on \gls{wfi}
      \begin{enumerate}
         \item Go to the \texttt{FEROS \gls{General State}} panel (\gls{desktop} \texttt{BOB+gen state}).
         \item Check the value of \texttt{\gls{M3} Selected Mirror}.
      \end{enumerate}
      \item If it is on \gls{feros}, set it to \gls{wfi}.
      \begin{enumerate}
         \item Go to the \texttt{FEROS \gls{ICS Control}} panel (\gls{desktop} \texttt{ICS}).
         \item Select the \texttt{\gls{mirr3}} checkbox (in green) under the \texttt{Motors} section.
         \item Select \texttt{WFI} on the same line.
         \item Click \texttt{SETUP} at the bottom of the panel.
         \item Deselect the \texttt{\gls{mirr3}} checkbox.
      \end{enumerate}  
  \end{enumerate}
\end{enumerate}

\subsection{Refining acquisition}
\label{sec:refinewfi}

\begin{figure*}
\subfigure[Whether to refine acquisition]{\includegraphics[width=0.45\linewidth]{wfi/qso/wfi-qso-01-confirm-continue.jpg}\label{fig:refinewfi-1}}
\hfill
\subfigure[Pick the target on the rtd]{\includegraphics[width=0.45\linewidth]{wfi/qso/wfi-qso-02-pick.jpg}\label{fig:refinewfi-2}}\\
\subfigure[Enter its pixel coordinates]{\includegraphics[width=0.45\linewidth]{wfi/qso/wfi-qso-03-coordinates.jpg}\label{fig:refinewfi-3}}
\hfill
\subfigure[By default, choose to \texttt{Offset and quit}]{\includegraphics[width=0.45\linewidth]{wfi/qso/wfi-qso-04-do-offset.jpg}\label{fig:refinewfi-4}}
\caption[Refining the WFI acquisition]{Refining the WFI \gls{acquisition} for the \texttt{WFI\_img\_acq\_MoveToPixel} \gls{template}.}
\label{fig:refinewfi}
\end{figure*}

It is possible to refine the \gls{acquisition} with WFI if the \gls{ob} has explicitly planned for it. Technically speaking, if the \gls{template} is \texttt{WFI\_img\_acq\_MoveToPixel} or \texttt{WFI\_img\_acq\_MoveToGap}, the observer will be asked whether to offset the telescope so that a given target falls on a specific pixel of the CCD matrix or a gap of between the CCDS.

Refining takes place after telescope \gls{preset} and before acquisition of the \gls{ag}.

\procedure{Refine the acquisition of WFI}
\begin{enumerate}
    \item\label{list:refine:img} Wait for acquisition image 
    \begin{enumerate}
        \item Wait for the acquisition image to read out ($\approx 1$\,min)\\
              On screen \texttt{WFI BOB}, window \gls{rtd} you can change
              the cuts of the image and the scale.
        \item Wait for a pop-up asking to refine acquisition (a few seconds)\\
              It may appear on any of the two screens. 
    \end{enumerate}
    \item Accept or decline refining by answering the pop-up \text{Confirm continue} (\figref{refinewfi-1}
    \begin{enumerate}
        \item With \texttt{Yes}, this procedure continues and a second
        pop-up appears.
        \item With \texttt{No}, this procedure ends and observation goes on without recentring.
    \end{enumerate}
    \item\label{list:refine:pick} Pick target (\figref{refinewfi-2})
    \begin{enumerate}
        \item Locate the target by means of a finding chart.\\
              Inspect the \gls{rtd}  window of screen \texttt{WFI BOB}
        \item Open the \gls{pickobj} window.\\
              On the \gls{rtd}, use \wmenu{View}{Pick OBject}
        \item Select the target.
        \begin{enumerate}
            \item Click on the target
            \item Check the cross is centred on target in the \gls{pickobj} window 
            \item If it isn't zoom out \texttt{z} and \texttt{Z} to achieve centring of the cross
        \end{enumerate}
    \end{enumerate}
    \item\label{list:refine:coord} Enter coordinates on pop-up \texttt{Coordinates} (\figref{refinewfi-3})
    \begin{enumerate}
        \item On \gls{pickobj}, copy the value of \texttt{Image X}
        \item On popup \texttt{Coordinates}, paste the value in \texttt{X coordinate}
        \item Do the same for \texttt{Image X}
        \item Click \texttt{OK} on the popup \texttt{Coordinates}
    \end{enumerate}
    \item If a pop-up asks for the coordinates of the gap, attend it.\\
          It occurs for template \texttt{WFI\_img\_acq\_MoveToGap}.
          Its handling is similar to steps~\ref{list:refine:pick}--\ref{list:refine:coord}. 
    \item Examine the offset proposition on pop-up \texttt{Do offset} (\figref{refinewfi-4})\\
          Read the offset values (in arcseconds) and decide whether they make sens.
    \item Answer pop-up \texttt{Do offset} (\figref{refinewfi-4})
    \begin{enumerate}
        \item \texttt{Offset and quit}: the recentring will be performed.\\
        This is the most common action.
        \item \texttt{Offset and reaquire}: the recentring will be performed, and procedure starts again from step~\ref{list:refine:img} for an additional centring to increase precision.\\
        This is used when an accuracy of the order of a pixel is needed or it is important to ensure the target is in the gap.
        \item \texttt{Quit}: no offset will be performed and this procedure ends.\\
        Mostly used when the OB will be aborted.
        \item \texttt{Reclick}: no offset is performed and this procedure starts again from step~\ref{list:refine:pick}.\\
        Mostly used if an obvious clicking or copying error has been done in steps~\ref{list:refine:pick}--\ref{list:refine:coord}.
    \end{enumerate}
    \item Wait for telescope offset (recentring) to complete ($\approx 30$\,s)\\
          After that, either \gls{ag} acquisition will be asked or science observations will start.
\end{enumerate}

\subsection{Guiding}
\label{sec:guidewfi}

\begin{figure*}
\centering
\subfigure[Whether to guide, answer once \gls{ag} is active]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-01-turnAG.jpg}\label{fig:guidewfi-1}}
\hfill
\subfigure[Retrieve the \gls{ag} field on \gls{TCS setup panel}]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-02-retrieve-field.jpg}\label{fig:guidewfi-2}}\\
\subfigure[Pick the guide star on \gls{skycat}]{\includegraphics[width=0.8\linewidth]{wfi/ag/wfi-ag-03-pick.jpg}\label{fig:guidewfi-3}}\\
\subfigure[Start guiding with box to star]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-04-box-to-star.jpg}\label{fig:guidewfi-4}}
\hfill
\subfigure[Wait for guiding to get ACTIVE]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-05-active.jpg}\label{fig:guidewfi-5}}
\caption[Guide with WFI]{Setting the WFI \gls{ag} for targets outside the solar system}
\label{fig:guidewfi}
\end{figure*}

\begin{figure*}
\subfigure[Start monitoring]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-01-start-monitoring.jpg}\label{fig:fastguidewfi-1}}
\hfill
\subfigure[\Gls{pickrefstar} on \gls{skycat}]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-02-pick-while-monitoring.jpg}\label{fig:fastguidewfi-2}}
\\
\subfigure[Stop monitoring]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-03-stop-monitoring.jpg}\label{fig:fastguidewfi-3}}
\hfill
\subfigure[Start guiding with \texttt{Box to Star}]{\includegraphics[width=0.45\linewidth]{wfi/ag/wfi-ag-04-box-to-star.jpg}\label{fig:fastguidewfi-4}}
\caption{Fast guiding acquistion with WFI}
\label{fig:fastguidewfi}
\end{figure*}

\procedure{Guide with WFI}\label{proc:guidewfi}
A graphical outline of the procedure is given in \figref{guidewfi} in the case no differential guiding (for solar system bodies) is needed.
\begin{enumerate}
    \item On the \gls{tcs} workstation, acquire the guide field (\figref{guidewfi-2})
    \begin{enumerate}
        \item Go to screen \texttt{Telescope Control Software}.
        \item Locate the \gls{TCS control panel} (\figref{tcs}).
        \item Click \texttt{Retrieve Field} below \texttt{AG Field Acquisition}.
    \end{enumerate}
    \item For solar system objects, set-up the differential guiding
n  
    \begin{enumerate}
        \item Locate the \texttt{Differential guiding} section on the \gls{TCS control panel} (\figref{tcs})
        \item Enter the target's proper motion in arcseconds per hour
        \item Click \texttt{ON}
    \end{enumerate}
    \item On the autoguider windows (\figref{tcsag}), choose the guide star (\figref{guidewfi-3})
    \begin{enumerate}
        \item Wait ($\approx 30$\,s) for \gls{skycat} to read out the guide field.
        \item On the same window, click \texttt{Auto Set Cut Levels}.
        \item Open the \texttt{\gls{pickrefstar}} window if necessary.\\
          In \texttt{skycat} chose \wmenu{TCS}{\gls{pickrefstar}}.
        \item Pick the reference star\\
          On the \gls{pickrefstar} window click \texttt{Pick}\\
          On the \gls{skycat} window, click a bright star not too close to the border. 
    \end{enumerate}
    \item On the \gls{TCS control panel} (\figref{tcs}) start the guiding
    \begin{enumerate}
        \item Activate the guiding (\figref{guidewfi-4})\\
              Click \texttt{Box to Star} below \texttt{Autoguider}.
        \item Wait for guiding to start (\figref{guidewfi-5})\\
              In a few seconds \texttt{\-\-\-ACTIVE\-\-\-} should appear in \texttt{AG Stat}.
    \end{enumerate}
    \item Proceed with the observation, typically by clicking on pop-up asking for guiding (\figref{guidewfi-1})
\end{enumerate}

After a filtre change or when running several observing blocks on the same
field, it is possible to reacquire guiding within a few seconds instead of the
full procedure (1 min).  It is not possible to do it after a \gls{focus} sequence. 

\procedure{Restart guiding with WFI}
A graphical outline of the procedure is given in \figref{fastguidewfi}.  Stopping monitoring and picking reference star can be performed in any order.
\label{proc:quickguide}
\begin{enumerate}
    \item On the \gls{tcs} machine, go to screen \texttt{Telescope Control Software}.
    \item On the \gls{TCS control panel} (\figref{tcs})
    \begin{enumerate}
        \item Click \texttt{Start monitoring} (\figref{fastguidewfi-1})
        \item Click \texttt{Stop monitoring}  (\figref{fastguidewfi-3})
    \end{enumerate}
    \item Select the star on the autoguider windows (\figref{tcsag}) 
    \begin{enumerate}
        \item Click \texttt{Pick object} in the \gls{pickrefstar} window.
        \item Click on the star in the \gls{skycat} window (\figref{fastguidewfi-2}).
    \end{enumerate}
    \item On the \gls{TCS control panel} (\figref{tcs}) start the guiding
    \begin{enumerate}
        \item Activate the guiding (\figref{fastguidewfi-4})\\
              Click \texttt{Box to Star} below \texttt{Autoguider}.
        \item Wait for guiding to start (\figref{guidewfi-5})\\
              In a few seconds \texttt{\-\-\-ACTIVE\-\-\-} should appear in \texttt{AG Stat}.
  \end{enumerate}
  \item Proceed with the observation, typically by clicking on pop-up asking for guiding (\figref{guidewfi-1}).
\end{enumerate}


\section{FEROS}

\subsection{Switching to FEROS}
\label{sec:switchingFeros}

You can start an \gls{ob} once point \ref{list:pmferos} has been done.  This minimises
overheads by parallelising \gls{preset}, mirror movements, and \gls{ag} settings

\procedure{Switch to FEROS observation}
\label{proc:switchferos}
\begin{enumerate}
  \item Switch the \gls{pointing model} to \gls{feros}.
  \begin{enumerate}
    \item Go to screen \texttt{Telescope Control Software}.
    \item Go to the \gls{TCS status panel} (\gls{desktop} \texttt{Status}, see \figref{tcsstatus}). 
    \item Use \wmenu{Instrument selection}{FEROS}
  \end{enumerate}
  \item Ensure the \gls{feros} \texttt{\gls{mirr3}} mirror is on FEROS.\label{list:pmferos}
  \begin{enumerate}
    \item Go to he \texttt{FEROS \gls{General State}} panel on \gls{desktop} \texttt{BOB+gen state} on screen \texttt{FEROS BOB}.
    \item If the value of \texttt{M3 Selected Mirror} is WFI, set it to \gls{feros}
    \begin{enumerate}
      \item Go to the \texttt{FEROS \gls{ICS Control}} panel (\gls{desktop} \texttt{ICS}).
      \item Select the \texttt{\gls{mirr3}} checkbox (in green) under the \texttt{Motors} section.
      \item Select \texttt{FEROS} on the same line.
      \item Click \texttt{SETUP} at the bottom of the panel.
      \item Deselect the \texttt{\gls{mirr3}} checkbox.
    \end{enumerate}   
  \end{enumerate}
  \item Ensure the \gls{grond} \gls{M3} mirror is on \gls{wfi}.
  \begin{enumerate}
    \item Go to he \texttt{GROND general state} panel on \gls{desktop} \texttt{bob+gen space} of screen \texttt{GROND BOB}
    \item If the value \texttt{GROND \gls{M3}} is \gls{grond} send it to \gls{wfi}.\\
          In a terminal, type \texttt{\gls{grondM3} WFI}.
    \item Check that value \texttt{GROND \gls{M3}} goes to \texttt{MOVING} then \texttt{WFI} (2 min)
  \end{enumerate}
  \item Set up the autoguider\label{list:autoguiderFeros} 
  \begin{enumerate}
    \item Go to the \texttt{FEROS} \gls{desktop} of screen \texttt{Autoguider GROND \& FEROS}
    \item Set up the autoguiding properties. (See \figref{agswitch})
    \begin{enumerate}
      \item Go to window \texttt{Autoguider}\\
            If necessary open with \mmenu{CAM user}{Autoguider}.
      \item Change the guiding unit to \gls{feros}\\
            Select \texttt{FEROS} under \texttt{Guiding unit} in the \texttt{CCD Control} area. 
      \item Select autoguiding loop times.\\
            Under \texttt{Autoguider control} fill in the numbers from top to bottom
      \begin{itemize}
        \item For \gls{focus}: 6, 3, 0.02
        \item For science targets adapt last number to magnitude (0.001--2.999).
      \end{itemize}
      \item Restart exposure so that guider takes new values into account.
      \begin{itemize}
        \item If \texttt{CCD Status} is \texttt{Infinite loop}, click \texttt{Stop exposure}
        \item Wait a few seconds for it to change to \texttt{Inactive} (check the exact word)%% TODO
        \item Click \texttt{Start exposure}.
      \end{itemize}
    \end{enumerate}
    \item Set up the autoguider real time image.
    \begin{enumerate}
      \item Go window \gls{ferosag}.\\
            If necessary open with \mmenu{CAM user}{E2P2...} 
      \item Activate the guide camera image flow if necessary.\\
            If checkbox \texttt{Camera On/Off} is not green, click on it.
      \item Ensure autoguider refreshes image\\
            On the \texttt{Autoguider control} the checkbox \text{Display Enable} should be red
      \item Ensure the image is horizontally flipped.\\
            Right of scale the button $\leftrightarrow$ should be pressed.
    \end{enumerate}
    \item\label{list:setfibre} Set the fibre reference position if GROND was used 
    \begin{enumerate}
      \item Open or activate window \gls{pickrefstar} (\figref{pickref}).\\
            Click \texttt{Set Reference} on window \gls{ferosag}.
      \item Ensure the reference is set on the cursor's clicking position.\\
            On window \gls{pickrefstar}, select checkbox \texttt{Pick Cursor}.
      \item Back on window \gls{ferosag}, click on fibre position.\\
            Coordinates are x=822 and y=516, zooming to 3 or 4$\times$ helps to click accurately.\\
            A box centred on the pixel should appear.
    \end{enumerate}
  \end{enumerate}
  \item Start the observation.
  \begin{enumerate}
    \item Go the the \texttt{bob+gen state} \gls{desktop} of screen \texttt{FEROS BOB}
    \item In \texttt{bob}, fetch \gls{ob} and click \texttt{Start}
  \end{enumerate}
\end{enumerate}

\begin{figure}[!ht]
\centering
\includegraphics[width=.5\linewidth]{ag/PickRef.png}
\caption[Window to set FEROS fibre reference position]{Window to set \gls{feros} fibre reference position \gls{pickrefstar}. Select checkbox \texttt{Pick Cursor}.}
\label{fig:pickref}
\end{figure}

\newpage

\subsection{Guiding}
\label{sec:ferosguiding}

\paragraph{On fibre}

The fastest way to guide with FEROS is using the reflection on the fibre head.  It is not adequate for faint stars (try to get $\approx 4\text{--}5000$ counts) or with bad weather.

\procedure{Guide a FEROS observation using reflection on the fibre head}
\label{proc:guideferos}
\begin{enumerate}
    \item Check that \gls{wfi} \gls{ag} is off.
    \begin{enumerate}
        \item Go to the \texttt{Control} \gls{desktop} of screen \texttt{Telescope Control Software}
        \item On the \gls{TCS control panel}, below \texttt{Autoguider}, check that \texttt{Ag Stat} is \texttt{Not\_active}
        \item If active, click \texttt{OFF} 
    \end{enumerate}
    \item Centre the target onto the fibre.
    \begin{enumerate}
        \item Go to screen \texttt{Autoguider GROND \& FEROS}, \gls{desktop} \texttt{FEROS}
        \item In window \gls{ferosag}, change scale back to full field ($1/2$) 
        \item Change cuts (\texttt{Autoset Cut Levels})
        \item Click \texttt{Centering} below \texttt{Image Control}
        \item Click on the target.
        \item Wait for target to be centred (5--10 s).
    \end{enumerate}
    \item\label{list:agcontrol}Adapt guiding integration time to the stellar brightness
    \begin{enumerate}
        \item In \gls{autoguiding} window, fill values
            \begin{enumerate}
                \item \texttt{Correction Time} (usually 6)
                \item \texttt{Loop Time} (usually 3, must be $\le $\texttt{Correction Time})
                \item \texttt{Integration time} (depends on star, must be $< $\texttt{Loop Time})
            \end{enumerate}
        \item Click \texttt{Apply}
    \end{enumerate}
    \item Click \texttt{Start guiding}.
    \item Ensure that brightness is sufficient for guiding
    \begin{enumerate}
        \item In window \gls{ferosag}, check that the counts on the doughnut around the fibre are above 4\,000 to 5\,000
        \item In \gls{autoguiding} window, adapt \texttt{Integration time}
        \item Click \texttt{Set Int. time}. 
        \item If you need an integration time larger than \texttt{Loop time},
            \begin{enumerate}
                \item Click \texttt{Stop guiding}
                \item Perform point~\ref{list:agcontrol} again with larger values (e.g. 8, 8, 7.99)
                \item Click \texttt{Start guiding}
            \end{enumerate}
    \end{enumerate}
    \item If running the \gls{acquisition} of an \gls{ob}
    \begin{enumerate}
        \item Wait for star to be well-centred on the fibre (5--30 s).
        \item Go to screen \texttt{FEROS BOB}, \gls{desktop} \texttt{bob+gen. state}
        \item Click \texttt{OK} to the pop-up asking for guiding.
    \end{enumerate}
\end{enumerate}

It is possible to guide blindly using another star of the field in the fibre head viewer.  It is not recommended and should be used as a last resort.

\paragraph{Off fibre}

\procedure{Guide a FEROS observation blindly using off-fibre reference}
\label{proc:guideferosoff}
\begin{enumerate}
    \item Check that \gls{wfi} \gls{ag} is off.
    \begin{enumerate}
        \item Go to the \texttt{Control} \gls{desktop} of screen \texttt{Telescope Control Software}
        \item On the \gls{TCS control panel}, below \texttt{Autoguider}, check that \texttt{Ag Stat} is \texttt{Not\_active}
        \item If active, click \texttt{OFF} 
    \end{enumerate}
    \item Centre the target precisely onto the fibre.
    \begin{enumerate}
        \item Go to screen \texttt{Autoguider GROND \& FEROS}, \gls{desktop} \texttt{FEROS}
        \item In window \gls{ferosag}, change scale back to full field ($1/2$) 
        \item Change cuts (\texttt{Autoset Cut Levels})
        \item Click \texttt{Centering} below \texttt{Image Control}
        \item Click on the target.
        \item Wait for target to be centred (5--10 s).
        \item Repeat if necessary to achieve close to perfect centering.
    \end{enumerate}
    \item Adapt guiding integration time to the off-fibre guide star brightness
    \begin{enumerate}
        \item In \gls{autoguiding} window, fill values
            \begin{enumerate}
                \item \texttt{Correction Time} to 6
                \item \texttt{Loop Time} to 3
                \item \texttt{Integration time} to a value $< $\texttt{Loop Time})
            \end{enumerate}
        \item Click \texttt{Apply}
    \end{enumerate}
    \item Select the guide star
    \begin{enumerate}
        \item Click \texttt{Set reference}
        \item In window \gls{pickrefstar}, under \texttt{Select 'pick' mode} select \texttt{Pick Object}
        \item In window \gls{ferosag}, click on star
    \end{enumerate} 
    \item Click \texttt{Start guiding}.
    \item Ensure that brightness is sufficient for guiding
    \begin{enumerate}
        \item In window \gls{ferosag}, check that the counts on the star are above 4\,000 to 5\,000
        \item In \gls{autoguiding} window, adapt \texttt{Integration time}
        \item Click \texttt{Set Int. time}. 
    \end{enumerate}
    \item If running the \gls{acquisition} of an \gls{ob}
    \begin{enumerate}
        \item Wait for star to be well-centred on the fibre (5--30 s).
        \item Go to screen \texttt{FEROS BOB}, \gls{desktop} \texttt{bob+gen. state}
        \item Click \texttt{OK} to the pop-up asking for guiding.
    \end{enumerate}
    \item When the \gls{ob} is finished, set the reference back to fibre
          (see point~\ref{list:setfibre} of \procref{switchferos}).
\end{enumerate}

\paragraph{Using the WFI autoguider}

This is the preferred method for faint targets.  When the FEROS \gls{adc} is used the WFI guide field is extremely defocused and this guiding method may be unstable.  In case of clouds, guiding will do a random walk...

\procedure{Guide a FEROS observation with the WFI guide camera}
\label{proc:guideferoswfi}
\begin{enumerate}
    \item Check that \gls{wfi} \gls{ag} is off.
    \begin{enumerate}
        \item Go to the \texttt{Control} \gls{desktop} of screen \texttt{Telescope Control Software}
        \item On the \gls{TCS control panel}, below \texttt{Autoguider}, check that \texttt{Ag Stat} is \texttt{Not\_active}
        \item If active, click \texttt{OFF} 
    \end{enumerate}
    \item Adapt guiding integration time to quick visual monitoring
    \begin{enumerate}
        \item In \gls{autoguiding} window, fill values to allow a quick visual monitoring, yet bright enough to see target:
            \begin{enumerate}
                \item \texttt{Correction Time} to 1--3
                \item \texttt{Loop Time} to 1--3
                \item \texttt{Integration time} to 0.99--2.99
            \end{enumerate}
        \item Click \texttt{Apply}
    \end{enumerate}
    \item Change \gls{wfi} filtre to limit the defocus in the WFI \gls{ag}
    \begin{enumerate}
        \item Go to the workstation \texttt{WFI BOB}, \gls{desktop} \texttt{ICS}.
        \item In panel \gls{wfiics}, select filtre under \texttt{SETUP Instrument}.
        \begin{itemize}
            \item If \gls{feros} \gls{adc} is used, select Cousins $I$.
            \item Other wise, use standard $R$.
        \end{itemize}
        \item In the same panel, click apply.
        \item Wait for filtre change ($\approx 1$--2 min), to start step~\ref{list:wfiguideforferos}
        \begin{itemize}
             \item On the panel, field \texttt{Filtre Name} will first display \texttt{Moving}.
            \item When the right filtre name appears, proceed 
        \end{itemize}
    \end{enumerate}
    \item Centre the target onto the fibre.
    \begin{enumerate}
        \item Go to screen \texttt{Autoguider GROND \& FEROS}, \gls{desktop} \texttt{FEROS}
        \item In window \gls{ferosag}, change scale back to full field ($1/2$) 
        \item Change cuts (\texttt{Autoset Cut Levels})
        \item Click \texttt{Centering} below \texttt{Image Control}
        \item Click on the target.
        \item Wait for target to be centred (5--10 s).
        \item Zoom in to check centring (scale $\sim$~5)
        \item If not using the \gls{adc}, repeat centring until you achieve close to perfect centering.
    \end{enumerate}
    \item If executing an \gls{ob} with the \gls{adc}
    \begin{enumerate}
        \item Go to screen \texttt{FEROS BOB}, \gls{desktop} \texttt{bob+gen. state}
        \item Click \texttt{OK} on the first pop-up asking for guiding
        \item Wait for the first exposure to start
        \item In \texttt{FEROS \gls{General State}}, click \texttt{PAUSE}
    \end{enumerate}
    \item\label{list:wfiguideforferos} Proceed with guiding as for a \gls{wfi} \gls{ob} (\procref{guidewfi}).
    \item Recentre the target on the fibre 
    \begin{enumerate}
         \item Go to the workstation \texttt{Telescope Control Software}.
         \item On the \texttt{TCS Main Panel} find the virtual racket.
         \item Select \texttt{Offset} and tick checkbox \texttt{Combined Offsets}.
         \item Enter offset values for both axes (0.3) and click \texttt{Store}.
         \item While monitoring the \gls{ferosag} on screen \texttt{Autoguider GROND \& FEROS}, use arrows to centre the target\\
              A full fibre width is 5 arrow clicks.\\
              Keep in mind the centring will have a delay of 10--15\,s. 
    \end{enumerate}
    \item Attend the \gls{ob} on  screen \texttt{FEROS BOB}, \gls{desktop} \texttt{bob+gen. state}
    \begin{enumerate}
        \item If using the \gls{adc}, click \texttt{CONT} in the \texttt{FEROS \gls{General State}}
        \item Click \texttt{OK} on any pop-up asking for centring on the fibre
    \end{enumerate}
    \item When the OB is finished, turn off the WFI autoguider
        \begin{enumerate}
            \item Go to the \texttt{Control} \gls{desktop} of screen \texttt{Telescope Control Software}
            \item On the \gls{TCS control panel}, below \texttt{Autoguider}, click \texttt{OFF} 
            \item Check that \texttt{Ag Stat} turns to \texttt{Not\_active}
        \end{enumerate}
\end{enumerate}

\section{GROND}

\subsection{Switching to GROND}

You can start an \gls{ob} once point \ref{list:switch-mcclose} has been done.  This minimises overheads by parallelising \gls{preset}, mirror movements, and autoguiding configuration.  If the Moon is between the first target and the current position or you are on a bright star, you should manually preset with the \gls{mc} closed to avoid blinding the IR detector.

\procedure{Switch to GROND observations}
\begin{enumerate}
  \item Ensure the \gls{grond} \gls{mc} is closed to avoid \gls{pointing} at a bright target with open shutters\\
        Your FEROS targets may be very bright or you might slew over the moon in your first GROND observation.\label{list:switch-mcclose}
  \begin{enumerate}
    \item Go to screen \texttt{GROND BOB}.
    \item In a terminal, type \texttt{\gls{grondMC} CLOSE}.
    \item Wait for cover to close (10-15 s) on panel \texttt{GROND \gls{General State}}\\
          Due to a bug, it will say \texttt{Moving}, \texttt{Open}, then \texttt{Closed}
  \end{enumerate}
  \item There is no need to switch the \gls{pointing model} to \gls{grond}\\
        GROND does it automatically, but you can do it to be consistent with FEROS and WFI.
  \item To gain time, ensure the \gls{grond} \gls{M3} mirror is on \gls{grond}
  \begin{enumerate}
    \item Go to window \texttt{GROND \gls{General State}} on screen \texttt{GROND BOB}
    \item If \texttt{\gls{M3}} says WFI\label{list:grond:checkm3}, send it to GROND.\\
            In a terminal, type \texttt{\gls{grondM3} GROND} and wait for it to go from \texttt{MOVING} to \texttt{GROND}
    \end{enumerate}
    \item Check that \gls{wfi} \gls{ag} is off 
    \begin{enumerate}
        \item Go to the \texttt{Control} \gls{desktop} of screen \texttt{Telescope Control Software}
        \item On the \gls{TCS control panel}, below \texttt{Autoguider}, check that \texttt{Ag Stat} is \texttt{Not\_active}
        \item If active, click \texttt{OFF} 
    \end{enumerate}
  \item Set up the autoguider 
  \begin{enumerate}
    \item Go to the \texttt{GROND} \gls{desktop} of screen \texttt{Autoguider GROND \& FEROS}
    \item Set up the autoguiding properties. (See \figref{agswitch})
    \begin{enumerate}
      \item Go to window \texttt{Autoguider},\\
            If necessary open it with \mmenu{CAM user}{Autoguider}.
      \item Change the guiding unit to \gls{grond}\\
            Select \texttt{GROND} under \texttt{Guiding unit} in the \texttt{CCD Control} area. 
      \item Select autoguiding loop times.\\
            Under \texttt{Autoguider control} fill in the numbers from top to bottom\\
            8, 4, 1 is usually fine, then 1 can be increased or decreased (0.001--3.999) depending on guide star.
      \item Restart exposure so that guider takes new values into account.
      \begin{itemize}
        \item If \texttt{CCD Status} is \texttt{Infinite loop}, click \texttt{Stop exposure}
        \item Wait a few seconds for it to change to \texttt{Inactive} (check the exact word)%% TODO
        \item Click \texttt{Start exposure}.
      \end{itemize}
    \end{enumerate}
    \item Set up the autoguider real time image.
    \begin{enumerate}
      \item Go window \texttt{Telescope R.T.D.}\\
              If necessary open it with \wmenu{CAM User}{Autoguider RTD Grond} 
      \item Activate the guide camera image flow if necessary.\\
              Use \wmenu{TCS}{Attach camera}.
      \item Ensure autoguider refreshes image\\
              On the \texttt{Autoguider control} the checkbox \text{Display Enable} should be red
    \end{enumerate}
    \item Ensure the reference picking window \gls{pickrefstar} is open\\
          If necessary open it from \gls{rtd} with \wmenu{TCS}{\gls{pickrefstar}}
  \end{enumerate}
  \item Start the observation
  \begin{enumerate}
    \item Go the the \texttt{bob+gen state} \gls{desktop} of screen \texttt{FEROS BOB}
    \item In \texttt{bob}, fetch \gls{ob} and click \texttt{Start}
    \item Wait for \gls{preset} to near or reach target\\
          Look on the Rose Diagram of the \gls{TCS setup panel} on the \texttt{TCS} screen.
    \item Open the \gls{mc}
    \begin{enumerate}
      \item Go to screen \texttt{GROND BOB}.
      \item In a terminal, type \texttt{\gls{grondMC} OPEN}.
      \item Wait for cover to close (10-15 s) by checking value on panel \texttt{GROND \gls{General State}}\\
            Due to a bug, it will say \texttt{Moving}, \texttt{Closed}, then open \texttt{Open}. 
    \end{enumerate}
    \item Acquire guide star is needed or asked
  \end{enumerate}
\end{enumerate}


\subsection{React to an automatic trigger}

When the \gls{rrm} of \gls{grond} is activated, it is possible that the detection of a transient by a satellite sends an automatic notice that will result in GROND taking command of the telescope.

\procedure{React to an automatic trigger}
\begin{enumerate}
  \item Check that your exposure is being read out automatically, if not, do it manually
    \begin{itemize}
        \item \textit{(\gls{feros})} click \texttt{END} on \texttt{FEROS \gls{General State}}
        \item \textit{(\gls{wfi})} click \texttt{END} on \texttt{WFI \gls{General State}} panel.\\
        If WFI wasn't read out and \gls{preset} is started, frame is lost.
    \end{itemize}
  \item Click \texttt{OK} on the trigger to start \gls{preset}.\\
        Preset will be automatic after 30 seconds.
  \item Set up the autoguider (unless you were observing with GROND).\\
        Go to the screen \texttt{Autoguider GROND \& FEROS}
  \item Switch off the \gls{wfi} autoguider if needed
  \begin{enumerate}
    \item Set up the autoguiding properties. (See \figref{agswitch})
    \begin{enumerate}
      \item Go to window \texttt{Autoguider}, open it if necessary.\\
            To open: left-click on the background, choose \texttt{Autoguider} from menu \texttt{CAM user}.
      \item Change the guiding unit to \gls{grond}\\
            Select \texttt{GROND} under \texttt{Guiding unit} in the \texttt{CCD Control} area. 
      \item Select autoguiding loop times.\\
        Under \texttt{Autoguider control} fill in the numbers from top to bottom\\8, 4, 1 is usually fine, then 1 can be increased if necessary.
      \item You may need to \texttt{Start exposure}.
    \end{enumerate}
    \item Set up the autoguider real time image.
      \begin{enumerate}
      \item Go window \texttt{Telescope R.T.D.}, open it if necessary.\\
            To open: left-click the screen background, choose \texttt{Autoguider RTD Grond} from menu \texttt{CAM user}.
      \item Activate the guide camera image flow if necessary.\\
        Use window \wmenu{TCS}{Attach camera}.
      \end{enumerate}
    \item Ensure the reference picking window is open
      \begin{enumerate}
        \item Look for window: \gls{pickrefstar}\\
              To open: from \gls{rtd} window use \wmenu{TCS}{\gls{pickrefstar}}
      \end{enumerate}
  \end{enumerate}
  \item Start the guiding (\secref{grond:guide} below).
\end{enumerate}

\subsection{Guiding}
\label{sec:grond:guide}
\procedure{Guide with GROND}
\label{proc:guidegrond}
\begin{enumerate}
    \item Prepare the guiding field
    \begin{enumerate} 
        \item Go to \gls{grondag} on screen \texttt{Autoguider GROND \& FEROS}, \gls{desktop} \texttt{GROND AG}
        \item Set the scale to $1/2$
        \item Set cuts (\texttt{Autoset Cut Levels})
    \end{enumerate}
    \item\label{list:agcontrolgrond} Adapt guiding integration time to the guide star brightness
    \begin{enumerate}
        \item In \gls{autoguiding} window, fill values
            \begin{enumerate}
                \item \texttt{Correction Time} (usually 8)
                \item \texttt{Loop Time} (usually 4, must be $\le $\texttt{Correction Time})
                \item \texttt{Integration time} (depends on star, must be $< $\texttt{Loop Time})
            \end{enumerate}
        \item Click \texttt{Apply}
    \end{enumerate}
    \item Acquire a guide star
    \begin{enumerate}
        \item On the \gls{pickrefstar} window, click \texttt{Pick Object}\\
        (It can be open from the \gls{grondag}, using \wmenu{TCS}{Pick Reference Star}) 
        \item Click on a star at least 100 pixels off any border
        \item On the \gls{autoguiding} window, click \texttt{Start guiding}.
    \end{enumerate}
    \item Ensure that brightness is sufficient for guiding
    \begin{enumerate}
        \item In window \gls{grondag} check that counts are $\gtrsim 4000$.
        \item In \gls{autoguiding} window, adapt \texttt{Integration time}
        \item Click \texttt{Set Int. time}. 
        \item If you need an integration time larger than \texttt{Loop time},
            \begin{enumerate}
                \item Click \texttt{Stop guiding}
                \item Perform point~\ref{list:agcontrolgrond} again with larger values (e.g. 8, 8, 7.99)
                \item Click \texttt{Start guiding}
            \end{enumerate}
    \end{enumerate}
    \item If running the \gls{acquisition} of an \gls{ob}
    \begin{enumerate}
        \item Go to screen \texttt{GROND}, first \gls{desktop}
        \item Click \texttt{OK} if there is a pop-up asking for guiding.
    \end{enumerate}
\end{enumerate}

\section{All instruments}

\subsection{Run an observing block}

There are two ways to run an \gls{ob}: use a \gls{template} in \gls{bob} and modify it on the fly or call it from the \gls{vot} execution sequence.  The last method allows to automatically fetch and run OBs in a sequence, without lost time, but popups must be attended, of course.


\subsection{Skip the preset}

If the telescope is already on the right target, you can skip the \gls{preset}
when starting an \gls{ob}. For observations requiring guiding, you should make sure
that it is already on or acquire it right after the first exposure begins.  On
\gls{wfi}, it should be avoided if the observing \gls{template} sets \texttt{RETURN}
to F (false) and \gls{pointing} position is important.

\procedure{Skip the preset}
\begin{enumerate}
    \item Generic method
    \begin{enumerate}
        \item In \gls{bob}, open the acquisition \gls{template}\\
          Use left click on the triangle.
        \item Edit the \texttt{PRESET} field to \texttt{F}\\
          You need to set bob to ``engineering'' mode.\\
          Middle click on the value, it should be \texttt{T} by default.
        \item Start the guiding if needed\\
              For \gls{wfi}, see quick guiding \procref{quickguide}
        \item Start the \gls{ob}.
    \end{enumerate}
    \item Standard observation with FEROS or GROND
    \begin{enumerate}
        \item In \gls{bob}, deactivate the \gls{acquisition} \gls{template}\\
              Use right click on the triangle.
        \item Ensure guiding is working if needed
        \item Start the OB.
    \end{enumerate}
\end{enumerate}
    
 
%Ivan: open Protective Shutter to observe?
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Morning: Closing \& Calibrations}
\label{chap:closing}

\section{Panels referred to}
When closing, you may need panels that are not automatically opened at startup. Here is how to find and open them.
\begin{enumerate}
\item On the \gls{tcs} screen, ensure that the \gls{auxfunc} (\figref{tcsauxfunc}) is open.\\
      If not, left-click on an empty region and select \wmenu{TCS User}{Panels,ux Functions}.
\item On the \gls{windows}, ensure mozilla shows the \gls{webcam} (\figref{webcam}).\\
      The tab named \texttt{TRENDNET…} can be opened with bookmark \texttt{Dome Webcam}.
\item On the \gls{windows}, ensure mozilla has a tab with \gls{domefunc}.\\
      Tab tab named \texttt{ADAM 6000…} can be opened with bookmark \texttt{Dome Controls} (\figref{domefunc}).
\end{enumerate}

\section{Telescope}

To put the telescope to a safe parking position one has to follow steps in a definite order, in particular, it is best to close the \gls{main mirror} cover before anything else. (Except in an emergency closing of the dome.) 

\procedure{Close the dome}
\begin{enumerate}
\item Close the \gls{main mirror} cover.\\ 
      In the \gls{TCS setup panel} (\figref{tcssetup}), click \texttt{Close} below \texttt{Main Mirror Cover}. 
\item Wait $\approx 2\,$min until it says closed.\\
      In the same panel, it should state \texttt{Closed} below \texttt{Main Mirror Cover}.
\item Park the telescope.\\ 
      In the same panel, click \texttt{Zenith} under \texttt{Fixed preset}.
\item Wait for preset to complete.\\
      In the \gls{TCS control panel}, the telescope should be at the zenith in the \gls{rose diagram}.
\item Put the dome in manual.\\  
      In the \gls{TCS setup panel}, click the \texttt{Manual} checkbox under \texttt{Dome}.
\item Close the \gls{slit}.\\ 
      In the same panel, click \texttt{Close} under \texttt{Slit}.
\item Switch on the light in the dome (\figref{webcam}).\\ 
      In the \gls{auxfunc} (\figref{tcsauxfunc}), select \texttt{200V} under \texttt{Flat Field Lamp}.
\item Check the \gls{slit} is closed and telescope at zenith \\
      Use the \gls{webcam} (\figref{webcam}) on the mozilla tab \texttt{TRENDNET} on the \gls{windows}.
\item Switch off the light in the dome. \\
      In the \gls{auxfunc}, select \texttt{OFF} under \texttt{Flat Field Lamp}
\end{enumerate}

If the panel is frozen, you can execute commands from a terminal, in directory \texttt{bin}: \texttt{closemirror}, \texttt{presetzenith}, \texttt{closeslit}, \texttt{domemanual}.  Or you can try to revive the panel (See \procref{unstuckTCSpanel}).

If nothing works, you must ask for support from an ESO \gls{tio}.  ESO is still responsible for the safety of the facilities.

\section{Instruments}
One should close the \gls{protective shutter} of \gls{wfi} and \gls{mc} of \gls{grond},  cut the communication between instruments 
and \gls{tcs}, and ensure mirrors let light directly to \gls{wfi} for \gls{dome flats}.

\procedure{Put the instruments offline}
\begin{enumerate}
\item Close the \gls{wfi} \gls{protective shutter}.\\
      Check on the \texttt{WFI \gls{General State}} panel in the WFI monitor (\figref{wfigen}) that \texttt{Protective Shutter State} is \texttt{CLOSED}.\\
      If not, go to \gls{auxfunc} (\figref{tcsauxfunc}) and \texttt{CLOSE} the \texttt{WFI Protective Shutter}.
\item Deactivate \gls{feros} communication.\\ 
      In the FEROS control panel (\figref{feroscon}) select from \wmenu{Telescope}{IGNORE}.
\item Deactivate \gls{grond} communication.\\ 
      In the \texttt{GROND \gls{General State}} panel (\figref{grondcon}), click \texttt{\gls{rrm} STANDBY} and \texttt{TCS OFF}
\item With \gls{grond}, close the \gls{cs} and \gls{mc}.\\ 
      In a terminal, type \texttt{\gls{grondCS} CLOSE} and \texttt{\gls{grondMC} CLOSE}.
\item Ensure \gls{feros} \gls{mirr3} mirror is not in the way.\\
      In panel FEROS \gls{General State} (\figref{feroscon}), \texttt{\gls{M3} Selection Mirror} should state \texttt{WFI}\\
      If not, int the \gls{ferosics} control panel (\figref{ferosics}), check the \texttt{\gls{mirr3}} box, select \texttt{WFI}, click \texttt{SETUP}.
\item Ensure \gls{grond} \gls{M3} mirror is not in the way.\\
      In panel  GROND \gls{General State} (\figref{grondcon}), \texttt{GROND \gls{M3}} should state \texttt{WFI}.\\
      If not, type \texttt{\gls{grondM3} WFI} in a terminal.
\end{enumerate}


\section{Dome}

Turn off ventilation and hydraulics using the \gls{domefunc} (\gls{windows}, \figref{domefunc}). If it is required, use the good seeing password.
\begin{enumerate}
  \item Turn off the dome ventilation.\\
        Click \texttt{Dome Air} if the button just above it is green.
  \item Turn off the hydraulics.\\
        Click \texttt{HydrOff}. The button above \texttt{Hydr} should go red. 
\end{enumerate}

\section{Tidying folders}

Scripts move the data of the previous nights are to a sub-directory directory and and remove old ones (already in the ESO archive) if disk space is needed.  It can be done any time (night, day) on a daily basis for WFI and FEROS.  The GROND team manages the data.

\procedure{Tidy folders}
\begin{enumerate}
  \item On the \gls{wfi} screen, type \~{}\texttt{/bin/sciopsTidyMess.sh} in a terminal (wfi xterm).
  \item On the \gls{feros} screen, type \~{}\texttt{/bin/sciopsTidyMess.sh} in a terminal.
\end{enumerate}

\section{Health checks \& internal calibrations}
\label{sec:clocal}

Launch health checks and internal calibrations.

\procedure{Launch morning health checks and internal calibrations}
\begin{enumerate}
  \item Run \gls{feros} linearity check.\\
        In \gls{bob}, load and run the daily linearity \gls{ob} using \texttt{Fetch an OB from file}.\\
        Name is \texttt{linearity-\#-weekday} where \texttt{weekday} is that at the start of the night.
  \item Run the \gls{wfi} health check, biases, and dark.\\
        In \gls{bob}, load and run the daily calibration OB using \texttt{Fetch an OB from file}.\\
        Name is \texttt{WFI\_cal\_\#-weekday} where \texttt{weekday} is that at the start of the night.
  \item Run \gls{grond} calibrations.\\
        In \gls{grond} \gls{bob}, load and run \texttt{GROND\_cal.obd} using \texttt{Fetch an OB from file}\\ 
        (\texttt{.../TEMPLATES/OBD/}). 
\end{enumerate}




%----------------------------------------------------------------------------------------

\chapter{Managing observing blocks}
\label{chap:ob}

\section{Transferring OBs from one's laptop}

\subsection{Standard way}

\procedure{Transfer OBs from one's computer to the telescope}
\begin{itemize}
    \item On your laptop open \gls{p2} in a browswer
    \item Log in and select all your \glspl{ob}.
    \item Use \wmenu{File}{Check-in}
    \item Use \wmenu{Readme}{CheckIn Readme} if necessary
\end{itemize}

\subsection{Loading manually}
If this fails, for instance for \glspl{ob} longer than one hour, you should
ssh them from your laptop and load them manually into the dhs computer.

\procedure{Transfer OBs from one's computer to the telescope, using manual file transfer.}
\begin{itemize}
  \item Check that your laptop accept ssh connections.
  \item Connect it to the cable network.
  \item Find your laptop's IP address.  With linux or mac, 
        \texttt{/sbin/ifconfig} or \texttt{ifconfig} should give it.
  \item On the \gls{p2}/\gls{vot} machine create a directory let's say \texttt{~/yourname/OBs} 
  \item On the same machine, type \texttt{scp -r yourlogin@youripaddress:pathtoOBs ~/yourname/OBs}
        and type your password.
  \item Open \gls{vot} with your credentials
  \item Select your program ID on the left column
  \item Use \wmenu{File}{Import}
\end{itemize}

Note: if you cannot activate ssh services on your laptop, use a USB stick and someone else's computer.   Alternatively, send an e-mail you will open on the \gls{p2}/\gls{vot} machine (not advised). 

\section{vOT}
%Ivan: completar

On the \gls{p2}/\gls{vot} machine, there is a \gls{desktop} to use \glspl{ob} from the observing tool (\gls{vot}). In the \texttt{Repository Browser} of the \gls{vot}, find your OB using fields such as instrument, period, ID, username, position, etc.  Click on the OB and then on a tab called \texttt{Execution Sequence} that it is in the same panel.

There should be an open window which is called \texttt{Execution Sequence}. The selected \gls{ob} will be listed there, maybe with a list of others. Use the buttons \texttt{move up} (or \texttt{move down})  to move the OB you want to run next to the top of the list since it has to be the first one.

Then, go to \gls{bob} and use the \wmenu{Configure}{Environment}. In the \texttt{Process} use \gls{vot}. Now you can fetch the \gls{ob} from \gls{vot}.


%\section{BOB}

%----------------------------------------------------------------------------------------

\chapter{Software maintenance}
\label{chap:reboots}

\section{Monthly}

About once a month a software maintenance should be done for prophylaxis.

\procedure{Monthly software maintenance}
\label{proc:monthly}
\begin{enumerate}
\item \label{list:soft:stop} Stop some processes and applications (2 min)
  \begin{enumerate}
     \item On the \texttt{vOT/p2} screen, exit applications
     \begin{enumerate}
      \item Locate the main \gls{vot} window with the execution sequence and exit it.
      \item Locate any open web browswer with open \gls{p2} and exit it
     \end{enumerate}
     \item On the pipeline screen, stop pipeline processes
             \begin{enumerate}
                \item Open or locate a terminal
                \item Type \texttt{doControl stop}
                \item Type \texttt{stopRBS}
             \end{enumerate}
     \item On the FEROS DRS screen, stop data processes following the first two points of \procref{FEROSDRSrestart}
             \begin{enumerate}
                \item Stop and close the \gls{ds} and the FEROS \gls{drs} panel (point~\ref{list:stopDRS})
                \item Kill processes and remove lock files (point~\ref{list:killDRS})
             \end{enumerate}
   \end{enumerate}
\item \label{list:soft:exit} Exit all sessions except \gls{grond} (1 min)
    \begin{enumerate}
        \item On the \gls{tcs} screen, exit the X environment
        \item On the \gls{wfi} screen, exit the X environment
        \item On the \gls{feros} screen, exit the X environment
        \item On the GROND and FEROS \gls{ag} screen, exit the X environment
        \item On the \gls{grond} screen, exit the X environment
        \item On the \texttt{p2/vot screen}, exit the X environment
        \item On the pipeline workstation, exit the X environment
        \item On the FEROS DRS workstation, exit the X environment
    \end{enumerate}
\item \label{list:soft:power}\Gls{power cycle} all black Dell boxes except \gls{grond}'s (2 min) 
\item Log into all sessions (2 min)
\begin{enumerate}
    \item On the \gls{tcs} screen, login as \texttt{tcs}
    \item On the \gls{wfi} screen, login as \texttt{wfi}
    \item On the \gls{feros} screen, login as \texttt{feros}
    \item On the FEROS and GROND AG screen, login as \texttt{cam}
    \item On the GROND screen, login as \texttt{grond}
    \item On the \gls{p2}/\gls{vot} workstation, login as \texttt{dhs}
    \item On the pipeline workstation, login as \texttt{pipeline}
    \item On the FEROS \gls{drs} workstation, login as \texttt{astro}
\end{enumerate}
\item Reboot workstations (except GROND)
\begin{enumerate}
    \item On the \gls{tcs} screen, open a tcs terminal and type \texttt{reboot}
    \item On the \gls{wfi} screen, open a wfi terminal and type \texttt{reboot} 
    \item On the \gls{feros} screen, open a feros terminal and type \texttt{reboot}
    \item On the FEROS DRS screen, open a terminal type \texttt{reboot} as root
    \item On the pipeline screen, open a terminal type \texttt{reboot} as root
    \item On the \texttt{p2/vot} screen, open a terminal type \texttt{reboot} as root
\end{enumerate}
\item Wait for the reboots to complete (20--30 min). You can check with any of the following:
    \begin{itemize}
        \item The terminal disappears when clicked on
        \item From a grond terminal, type \texttt{ping <machine>}.
             \begin{itemize}
             \item <machine> can be \gls{w2p2tcs}, \gls{w2p2ins} (WFI), \gls{wferos}, \gls{w2p2dhs} (vOT/p2), \gls{w2p2pl} (pipeline), \gls{w2p2off} (FEROS DRS). 
             \item Reboot is not done if \texttt{No route to host} is answered.
             \item When ping starts sending internet speed stats reboot is almost complete (less than one minute left).
             \end{itemize}
    \end{itemize}
\item Restart some processes and applications
    \begin{enumerate}
        \item On the \texttt{vOT/p2} screen, open \gls{vot}
        \item On the pipeline workstation
             \begin{enumerate}
                \item Open  a terminal
                \item Type \texttt{dhsSubscribeControl start pipeline -backsince <date>}\\
            pick <date> a few days ago
                \item Type \texttt{doControl start wfi,feros}
                \item Type \texttt{startRBS pipeline.config}
             \end{enumerate}
        \item On the FEROS DRS workstation, follow the last point of \procref{FEROSDRSrestart} in order to
             \begin{enumerate}
                \item Open and configure \gls{ds} (point~\ref{list:DS})
                \item Open the FEROS DRS panel (point~\ref{list:DRS})
             \end{enumerate}
    \end{enumerate}
\item \label{list:soft:tcs}Perform a full \gls{tcs} restart
\end{enumerate}

\section{Every six months}

Every six months a weekly software maintenance has an additional step with the reboot of the user workstation.

\procedure{Biannual software maintenance}
\begin{enumerate}
\item Stop processes and exit sessions (steps~\ref{list:soft:stop}--\ref{list:soft:exit} of \procref{monthly})
\item Have a reboot of the user workstation done (15 min?)
    \begin{enumerate}
        \item Contact IT at Paranal (Josefina Urrutia) 
        \item Coordinate a reboot of user workstation \gls{uws2p2}
        \item Wait for their confirmation that it is done
    \end{enumerate}
\item Power cycle dell boxes, log into sessions, reboot workstations, restart processes, and start-up TCS (steps~\ref{list:soft:power}--\ref{list:soft:tcs})
\end{enumerate}


\chapter{Troubleshooting}
\label{chap:trouble}

\section{Power outage}
\label{sec:power}

In case of a power outage or a after a switch back to the outer electric network a micro powercut occurs.  In that case, it is best to

\procedure{Recover from a power outage}
\begin{enumerate}
    \item Check the state of the \gls{main mirror} cover.\\
          If necessary set it back manually to closed or open, \procref{mainmirrorstuck}.
    \item Check the state of the \gls{grondM3} mirror.\\
          If necessary set it back manually to GROND or WFI, \procref{grondM3stuck} (\figref{grondM3-box}).
    \item Check the power switches of the telescope drives.\\
          Go to the dome, see \figref{drives}.
    \item Do a full restart of the telescope and instruments
\end{enumerate}

\section{No flux or little flux}
\label{sec:noflux}

\procedure{Investigate and fix the reason for the absence of flux in an instrument}. Ensure that
\begin{itemize}
  \item the \gls{slit} is \texttt{OPEN} (\gls{tcs} setup, \figref{tcssetup}).
  \item the dome is on automatic (\gls{tcs} setup,
        \figref{tcssetup}) and the slit is aligned (\gls{tcs}, \figref{tcs}).
  \item the Main Mirror Cover is \texttt{OPEN} (\gls{tcs} setup,
        \figref{tcssetup}).
  \item the \texttt{\gls{mirr3}} mirror is on \texttt{WFI} or \texttt{FEROS} (\gls{feros} \gls{ics}, 
        \figref{ferosics}) if observing with \gls{wfi} or \gls{feros}.  If necessary,
        click its checkbox and \texttt{SETUP}.
  \item the \gls{M3} mirror is on \gls{grond} if observing with \gls{grond} and on \gls{wfi} otherwise
         (\gls{grond} control, \ref{fig:grondcon}).  Use 
        \texttt{\gls{grondM3} WFI} or \texttt{\gls{grondM3} GROND} in the terminal if
        necessary.
  \item \textit{(\gls{wfi})} the \gls{protective shutter} is \texttt{OPEN} (\gls{auxfunc} 
        on the \gls{tcs} machine, \ref{fig:tcsauxfunc}). 
  \item \textit{(\gls{grond})} the \gls{mc} and \gls{cs} are \texttt{OPEN} (\gls{grond} control,
        \figref{grondcon}).  Use \texttt{\gls{grondMC} OPEN} and \texttt{\gls{grondCS} OPEN} in the terminal if necessary.
  \item \textit{(\gls{grond})} If images look like biases, restart \gls{fiera}.\\
  On the \texttt{FIERA Control Panel} do \texttt{Shutdown} / \texttt{Startup}.
\end{itemize}

\section{Autoguider camera fails}
\label{sec:agfail}

\begin{figure}[p!]
\subfigure[\text{Rack tower}]{
    \includegraphics[width=0.3\linewidth]{feros/l2p2cam-rack.jpg}%
    \label{fig:l2p2cam-rack}%
}\hfill
\subfigure[\text{\gls{l2p2cam} reset}]{
    \includegraphics[width=0.3\linewidth]{feros/l2p2cam-front.jpg}%
    \label{fig:l2p2cam-rst}%
}\hfill
\subfigure[\text{\gls{l2p2cam} \gls{power cycle}}]{%
    \includegraphics[width=0.3\linewidth]{feros/l2p2cam-back.jpg}%
    \label{fig:l2p2cam-pow}%
}
\caption[Rack with FEROS AG LCU]{Rack with the \gls{feros} \gls{ag} \gls{lcu}.}
\label{fig:l2p2cam}
\end{figure}

\begin{figure}[p!]
\begin{minipage}{0.48\linewidth}
\subfigure[\texttt{scanei}]{%
  \includegraphics[width=\linewidth]{ag/ag-scanei-0.png}
}\\
\subfigure[Click on \gls{l2p2cam} or \gls{l2p2agr} (top right)]{%
  \includegraphics[width=\linewidth]{ag/ag-scanei-1.png}
}
\end{minipage}
\hspace{0.02\linewidth}
\begin{minipage}{0.48\linewidth}
\subfigure[Click enable or disable (top left)]{%
  \includegraphics[width=\linewidth]{ag/ag-scanei-2.png}
}
\end{minipage}
\caption[Command scanei to control \glspl{environment}]{\texttt{scanei} on the \gls{feros} and \gls{grond} 
\gls{ag} machine.}
\label{fig:agscanei}
\end{figure}


The \gls{grond} and \gls{feros} autoguider use the same system on screen \texttt{Autoguider GROND \& FEROS}, between the GROND and FEROS screens.  \gls{wfi} has its own system on screen \texttt{Telescope Control Software}.

It is possible to go on observing with GROND and FEROS while restarting the autoguider (\acrlong{tccd}), provided that the modules are deactivated on the \gls{tcs}. However, you need to reactivate them to do the last step of restarting the autoguider (gls{e2p2StartTCCDs}).

\procedure{Observe when the autoguider fails}
\label{proc:agmodules}
\begin{enumerate}
    \item On screen \texttt{Telescope Control Software} go to \texttt{Status} \gls{desktop}
    \item On the \gls{TCS status panel} locate the modules section (\figref{tcsstatus})
    \item Check ignore for the corresponding modules
    \begin{itemize}
        \item For \gls{grond}, \texttt{ag\_ccdGRND} and \texttt{ccdGRND}
        \item For \gls{feros}, \texttt{ag\_ccdGRND} and \texttt{ccdGRND}
    \end{itemize}
    \item Remember to uncheck them for \gls{e2p2StartTCCDs} to work!
\end{enumerate}

\subsection{GROND}
If you want to observe while fixing the issue you need to deactivate the modules in the \gls{tcs}, see \procref{agmodules}.  You will need to uncheck them just before starting the guider software with \gls{e2p2StartTCCDs}.

\procedure{Restart the GROND autoguider}
\label{proc:restartgag}
\begin{enumerate}
   \item\label{list:gag1} If in a hurry try the quick restart (1--2 min)
   \begin{enumerate}
       \item On screen \texttt{Autoguider GROND \& FEROS}, find or open a terminal.
       \item Stop the GROND \acrlong{tccd}\\
             Type \texttt{\gls{e2p2StopTCCDs} gag} and wait for command to finish
       \item Start the GROND \acrlong{tccd}\\
             Type \texttt{\gls{e2p2StartTCCDs} gag} and wait for command to finish
   \end{enumerate}
   \item If you have time or \ref{list:gag1} does not solve the issue,
   go for the full restart (3--4 min)
   \begin{enumerate}
       \item On screen \texttt{Autoguider GROND \& FEROS}, find or open a terminal.
       \item Type \texttt{\gls{lccBoot} \gls{l2p2agr}}
       \item Wait for the command to finish (1--2 min)
       \item Type \texttt{scanei} to open the scanei GUI
       \begin{enumerate}
	   \item Check that l2p2agr is \texttt{ENABLED}
	   \item If not, enable l2p2agr (see \figref{agscanei})
	   \item Close the GUI
       \end{enumerate}
       \item Start the \acrlong{tccd} with command \texttt{\gls{e2p2StartTCCDs} gag}
   \end{enumerate}
\end{enumerate}

\subsection{FEROS}
If you want to observe while fixing the issue you need to deactivate the modules in the \gls{tcs}, see \procref{agmodules}.  You will need to uncheck them before starting the guider (Technical CCD) with \gls{e2p2StartTCCDs} (step~\ref{lab:fag2}). 

\procedure{Restart the FEROS autoguider}
\label{proc:restartfag}
\begin{enumerate}
    \item Restart the \gls{ag} software (1--2 min).
        \begin{enumerate}
            \item\label{lab:fag0} On screen \texttt{Autoguider GROND \& FEROS}, find or open a terminal.
            \item Stop the FEROS \acrlong{tccd} with command
                  \texttt{\gls{e2p2StopTCCDs} fag} and wait for command to finish
            \item\label{lab:fag1} Start the FEROS \acrlong{tccd} with command
                  \texttt{\gls{e2p2StartTCCDs} fag} 
            \item\label{lab:fag2} Wait for about 1--2 min for the command to exit successfully.
        \end{enumerate}
    \item\label{list:fag3} If the problem persists or an error pops up in step~\ref{lab:fag2}, reboot the \gls{ag} \gls{lcu} (3--4 min) 
        \begin{enumerate}
            \item\label{list:fag4} Type \texttt{\gls{lccBoot} \gls{l2p2cam}} and wait for command to finish (2 min)
            \item Type \texttt{scanei} to open the scanei GUI
            \begin{enumerate}
                \item Check that l2p2cam is ENABLED
                \item If not enable l2p2cam (see \figref{agscanei})
                \item Close the GUI
            \end{enumerate}
            \item Perform steps \ref{lab:fag0}, \ref{lab:fag1}, \ref{lab:fag2}.
        \end{enumerate}
    \item If the problem persists, step~\ref{list:fag4} does not terminate with minutes, or an error pops up at some point in step~\ref{list:fag3}, perform a hardware reset of the FEROS AG \gls{lcu} (15 min)
    \begin{enumerate}
       \item Go to the FEROS room located in the telescope enclosure. 
       \item Locate the big blue rack tower (\figref{l2p2cam-rack}).
       \item On the lower racks, near to l2p2cam label, push a small RST button (\figref{l2p2cam-rst}).
       \item Perform steps \ref{lab:fag0}, \ref{lab:fag1}, \ref{lab:fag2}.
    \end{enumerate}
    \item If this does not solve the issue, \gls{power cycle} the \gls{lcu} (15 min)
    \begin{enumerate}
        \item Go to the FEROS room located in the telescope enclosure. 
        \item On the back of the rack tower, unplug and replug the lower rack (\figref{l2p2cam-pow}).
        \item Perform steps \ref{lab:fag0}, \ref{lab:fag1}, \ref{lab:fag2}.
    \end{enumerate}
\end{enumerate}

\subsection{WFI}
Failure of the \gls{wfi} autoguider will generally be silent.  It will just do nothing when asked to retrieve field or start monitoring.

If the quick 30 seconds fix does not work, it is not possible to observe with WFI during the 15--35 minute-long fix, but it should be possible to go on with GROND or FEROS with no guarantee though---the \gls{tcs} has the bad habit of communicating with the WFI computers for \gls{focus}. 

\procedure{Fix WFI autoguider issues}
\label{proc:fixwfiag}
Try in this order
\begin{enumerate}
  \item\label{wfiagrestart}
       On the \acrlong{tcs} screen, restart the \acrlong{ag} (30 s)
    \begin{enumerate}
       \item Use left-click menu \texttt{Stop Autoguider}
       \item Use left-click menu \texttt{Start Auoguider}\\
             If window closes quickly (less than 10 s), it is a failure and
             the next step should be done.
    \end{enumerate}
  \item Restart the WFI \acrlong{tccd}.\\
        This should be done if \texttt{Retrieve Field} gives the error \texttt{Error opening RPC connection} or if point~\ref{wfiagrestart} does not solve the issue.
    \begin{enumerate}
       \item On the WFI screen, locate or open a terminal.
       \item Stop the WFI \acrlong{tccd} with command
             \gls{wfinsStopTCCDS} and wait for it to finish
       \item Start the WFI \acrlong{tccd} with command \gls{wfinsStartTCCDS} and wait for it to complete (2 min)
       \item Perform the AG restart of point~\ref{wfiagrestart}
    \end{enumerate}
  \item If an autoguider process is suspended, restart the \gls{tcs}
    \begin{enumerate}
       \item In a terminal, type \texttt{i}
       \item If there is an AG-related suspended process, proceed as follow
       \item Deactivate the connection between \gls{feros} and TCS
           \begin{itemize}
                \item On the \gls{feros} screen (\figref{saladecontrol}), locate the \gls{feros} control panel (\figref{feroscon})
                \item Select \wmenu{Telescope}{IGNORE}
           \end{itemize}
       \item Perform a full restart the \gls{tcs} including \gls{vme} reboot (\procref{startup})
       \item Reactivate the connection between \gls{feros} and TCS
           \begin{itemize}
                \item On the \gls{feros} screen (\figref{saladecontrol}), locate the \gls{feros} control panel (\figref{feroscon})
                \item Select \wmenu{Telescope}{ENABLE}
           \end{itemize}
    \end{enumerate}
    \item Reboot the \gls{wfi} SPARC station and dependencies (15--35 min).
    \begin{itemize}
        \item From a terminal type \texttt{rlogin \gls{wwffcd} -l fcdrun}
        \item Once logged in, type \texttt{reboot}
        \item Wait for reboot to complete (a few minutes)\\
              In a terminal type \texttt{ping wffcd} and wait until it shows packets.
        \item Reboot \gls{wfi} computer (a few minutes)\\
              On screen \texttt{Wide Field Imager}, type \texttt{reboot} in a terminal.
        \item Do the \gls{wfi} weekly startup (10 min)
        \item Restart the TCS or just autoguider (see point 1 \ref{wfiagrestart}), not sure here if TCS restart is needed.
    \end{itemize}
\end{enumerate}

\section{OB doesn't work}

\subsection{OB doesn't load}

If an \gls{ob} import fails with error message \texttt{Could not communicate with OH}.

\procedure{Fix OB communication issue}
Try, in the following order
\begin{enumerate}
    \item Check that the source is set on \texttt{vot}.
        \begin{enumerate}
            \item In \gls{bob} and use the \wmenu{Configure}{Environment}.
            \item Ensure that \texttt{Process} is set to \gls{vot}.
        \end{enumerate}
    \item Check that \gls{vot} is open\label{list:openvot}
    \begin{enumerate}
        \item Go to screen \texttt{vOT / p2}
        \item Open \gls{vot} either from a terminal or the menu
    \end{enumerate}
    \item Check that only one \gls{vot} is running
    \begin{enumerate}
        \item On screen \texttt{vOT / p2}, locate or open a terminal
        \item Type \texttt{ps gaux | grep vot}
        \item For all process listed, type \texttt{kill <pid>} where \texttt{<pid>} is the process number
        \item Open \gls{vot} (step~\ref{list:openvot}).
    \end{enumerate}
\end{enumerate}

\subsection{OB gives an error when started}

If an \gls{ob} issues an error within seconds of being started.

\procedure{Fix OB start error}
\begin{enumerate}
  \item If OB was already executed or aborted, click \texttt{Reset status}. 
  \item Check that the object is observable (above 20 degrees).
  \item If telescope preset is needed, check that the communication with the \gls{tcs} is on
    \begin{itemize}
       \item \textit{(\gls{feros})} Use \wmenu{Telescope}{Enable}.
       \item \textit{(\gls{grond})} Click \texttt{TCS ON}.
    \end{itemize}
  \item If telescope preset is not needed (e.g. calibrations), deactivate it in 
    \begin{itemize}
      \item \textit{(\gls{feros}, \gls{grond})} Right-click the triangle of the \gls{acquisition} \gls{template}.
                   (A thumb down should appear.  If you get a stop, go on clicking.)
      \item \textit{(\gls{wfi})} Set \texttt{PRESET.NEW} to \texttt{F} in the \gls{acquisition} \gls{template}.\\
         (This needs \wmenu{Interface}{Engineering}.) 
    \end{itemize}
\end{enumerate}

\subsection{OB stalls before starting to observe}

It may happen that an \gls{ob} \gls{stall}s, that means, nothing is happening.  No error is reported but the telescope does not move, no integration seems to take place and the \gls{bob} windows has stopped to give information about what is going on.

\procedure{Fix stalling of an OB}
\begin{itemize}
\item \textit{(\gls{wfi},\gls{feros})} Try to find a hidden pop-up asking for interaction (behind a window).
\item \textit{(\gls{wfi})} If OB stalls when \gls{focus} order is sent by \gls{bob},
set it manually.\\
In the TCS screen, enter \gls{focus} value in the \gls{TCS control panel} (\figref{tcs}).\\
Note: A permanent fix is to restart the \gls{tcs} (see \secref{tcsrestart}).
\item \textit{(\gls{grond})} If IR exposure does not start after the optical one has, reset the IR \gls{flip mirror}.\\
In a terminal, type \texttt{\gls{grondFM}}
\item \textit{(\gls{feros})} If the exposure time is not marking and the Exposure status stays in RUNNING after readout, the scan links must be reinstalled with \texttt{feinsInstallScanLinks wfefcd}.
\end{itemize}

\subsection{Crash before an exposure}
\label{sec:expocrash}

Here are possible fixes, from shortest to longest.  Try each one in this
order, until problem is fixed.

\procedure{Investigate and fix a crash occurring before the start of an optical exposure}
\begin{enumerate}
  \item Close \gls{bob} and launch a new one.
  \item \gls{feros}
    \begin{enumerate}
      \item Restart \gls{fiera}\\
            On the \texttt{FIERA Control Panel} do \texttt{Shutdown} / \texttt{Startup}.
            \label{restartfiera}
      \item Restart the instrument with telescope enabled\\
            (In particular if the second exposure of the night fails.)
         \begin{enumerate}
            \item On the \texttt{FEROS \gls{General State}} panel, use \wmenu{Telescope}{enabled}.
            \item Do the full start-up procedure.
         \end{enumerate}
    \end{enumerate}
  \item \gls{grond}
    \begin{enumerate}
       \item If error \texttt{closing \gls{w2p2cam} \gls{environment}}
       \begin{enumerate}
          \item If a \gls{fiera} exposure is running in \texttt{GROND \gls{General State}}, click \texttt{End} or let it finish.
          \item Type \gls{grondSHUTTER} in a terminal.
       \end{enumerate} 
       \item If the error mentions \gls{irace}
       \begin{enumerate}
            \item Go to monitor \texttt{GROND IRACE}.
            \item Locate the \texttt{Infrared Acquisition Module} (\figref{grondirace})
            \item Click \texttt{Reset} on the lower left part of the panel
            \item Select from \wmenu{Online}{Online}
            \item If it fails, you may need $\approx 40$\,min to deep restart (\procref{iracerestart}) \gls{irace}.
       \end{enumerate}
       \item Ensure only one \gls{bob} is running
         \begin{enumerate}
           \item Find all \glspl{bob} (\texttt{ps gaux | grep bob})
           \item \texttt{kill} them
           \item launch a new \gls{bob}.
         \end{enumerate}
       \item \textit{(\gls{grond})} Restart \gls{fiera} (see ~\ref{restartfiera}).
       \item \textit{(\gls{grond})} Restart \gls{grond}.
         \begin{enumerate}
           \item Type \gls{grinsStop}
           \item Type \gls{grinsStart}
           \item In \texttt{GROND \gls{General State}} panel, put instrument \texttt{ONLINE}.
         \end{enumerate}
       \item \textit{(\gls{grond})} Reboot \gls{grond}.
       \item \textit{(\gls{grond})} If the GROND control has many TCS-related fields with gray background or the error says something about the FITS keyword TELESCOP, a last resort reboot of GROND may be needed. \textbf{BUT} in case of the first scenario, take a separate exposure with \gls{fiera} (in the control panel) first and check if these fields turn back to their usual color.
     \end{enumerate}
  \item\label{list:wfiexpocrash} \gls{wfi}
    \begin{enumerate}
      \item Abort a possible running exposure manually, in particular if \gls{bob} issues the error message
             ``Cannot start exposure before the last one has read out'' or some
             equivalent message (10~sec)
        \begin{enumerate}
           \item On the \gls{wfiics} (\figref{wfios}) click \texttt{Abort Exp./Seq.}
           \item The GUI should display the text \texttt{ABORT    > INVOKED}
           \item Wait for a few seconds for the answer \texttt{ABORT    > REPLY/ L   OK}.
           \item If it works, problem is solved, if not go to next point.
        \end{enumerate}
      \item Do a \texttt{DAILY} startup of \gls{wfi} (5~min).
      \item\label{list:wfifierarestart} Do a full restart of \gls{fiera} and \gls{wfi} (10-15~min).
        \begin{enumerate}
          \item Go to a \texttt{wfi} terminal or open it from menu \texttt{wfi xterm}.
          \item Shut down the instrument.\\
                Type \texttt{wfinsShutDown}
          \item Check that the \gls{environment} are enabled.
             \begin{enumerate}
               \item Type \texttt{scanei \&} 
               \item Go to the opening GUI titled \texttt{CSS Scan System}.
               \item Check that \gls{wwffcd} and \gls{w2p2tcs} are \texttt{ENABLED}
               \item If either environment is \texttt{DISABLED}, proceed with these points
               \item Click on \texttt{DISABLED}
               \item In emerging GUI, click \texttt{Enable} just below \texttt{Environment}.
               \item Close it with \wmenu{File}{Quit}.
               \item Close \texttt{CSS Scan System} with \wmenu{File}{Quit}.
            \end{enumerate} 
          \item Restart the CCD managing components
             \begin{enumerate} 
               \item Stop \acrlong{tccd} by typing \gls{wfinsStopTCCDS}
               \item Stop \acrlong{sccd} by typing \gls{wfinsStopSCCDS}
               \item Start SCCDs by typing \gls{wfinsStartSCCDS}
               \item Start TCCDs by typing \gls{wfinsStartTCCDS}
             \end{enumerate}
          \item Restart the instrument.\\
                Type \texttt{wfinsStartUp}.
          \item Restart the \gls{ag}
             \begin{enumerate}
                \item Go to screen \texttt{Telescope Control Software}. 
                \item Left-click on an empty space to open the menu \texttt{TCS User}.
                \item Use \wmenu{TCS User}{Stop autoguider}.
                \item Use \wmenu{TCS User}{Start autoguider}.
             \end{enumerate}
          \item Open missing windows on screens \texttt{Wide Field Imager}.
             \begin{enumerate}
                \item \gls{bob} with \mmenu{WFI User}{WFI,BOB (WFI)}.
                \item \gls{rtd} with \mmenu{WFI User}{WFI,WFI RTD}.
             \end{enumerate}
          \item Take a test bias.
        \end{enumerate}
      \item Restart the instrument.  You will need to restart the autoguider on the \gls{tcs} machine.
    \end{enumerate}
\end{enumerate}

\subsection{Crash during an exposure}

\procedure{Fix a crash during an exposure}
\begin{enumerate}
  \item \gls{feros} 
    \begin{enumerate}
       \item \gls{ob} crashes with ``error closing cam \gls{environment}''
          while an exposure (usually the first of the night) is running
          \begin{enumerate}
            \item Let the current exposure finish and read out, it will be fine.
            \item In the meantime, close and relaunch \gls{bob}.
          \end{enumerate}
    \end{enumerate}
  \item \gls{wfi}
    \begin{enumerate}
       \item \gls{wfi} \gls{stall}s just before the read out of an exposure.\\
             Abort it manually, if unsuccessful restart \gls{fiera} (follow point \ref{list:wfiexpocrash} in \secref{expocrash})
    \end{enumerate}
  \item \gls{grond}
    \begin{enumerate}
       \item \gls{ob} crashes with ``error closing cam environment''
          while an optical exposure is running
          \begin{enumerate}
            \item End the optical exposure (if it's a long one)\\
                  On the grond control panel, click \texttt{END}.
            \item Wait for exposure to read out
            \item Restart the \gls{ob} without \gls{preset}ting\\
                  (In \gls{bob} deactivate preset and reset status.)
          \end{enumerate}
       \item \gls{ob} \gls{stall}s or crashes during an exposure
	      \begin{enumerate}
             \item In a terminal, execute \texttt{grondFM} to reset the \gls{flip mirror}. If issue is not fixed, proceed.
             \item Close and/or kill all {bob} instances\\
                   Find them by typing \texttt{ps gaux | grep bob} in a terminal).\\
                   Kill them with \texttt{kill -9 <pid>} where \texttt{<pid>} is the job number.
             \item Launch \gls{bob}\\  
                   Type \texttt{bob \&} in a terminal.
             \item In the same terminal, execute \gls{grondGRI} and \gls{grondSHUTTER}
             \item Wait for \gls{grondSHUTTER} command to end (10 s to 1 min).
             \end{enumerate}
  \end{enumerate}
\end{enumerate}

\subsection{Crash during telescope offset}

Here are possible fixes, from shortest to longest.  Try each one in this
order, until problem is fixed.
\begin{itemize}
  \item Close \gls{bob} and launch a new one. (Works with \gls{wfi}).
  \item Restart the \gls{tcs} (see \secref{tcsrestart}).
\end{itemize}

\subsection{Crash during a telescope focus offset}
If a timeout error occurs relating to \texttt{FOCOFF} or some message about
\gls{focus} that cannot be done:
\begin{itemize}
  \item (\gls{grond}) Disable and enable \gls{w2p2tcs} in \texttt{scanei}.
  \item (\gls{wfi}) See \secref{wfifocseqtimeout}.
\end{itemize}

\subsection{Crash at the beginning of WFI sky flats}

The typical crash is before the first exposure with a timeout error on the first telescope movement.

\procedure{Fix a WFI sky flats crash}
\begin{enumerate}
\item Abort the current exposure in the \gls{wfiics}.\\
      In the \texttt{ICS} \gls{desktop}, use \texttt{Abort Exp./Seq.} on the panel. 
\item Do one of the following
   \begin{enumerate}
        \item If the dome is in manual, set it to automatic. (Likely fix).
        \item If the dome is in automatic, try a daily restart of \gls{wfi}.
        \item If a restart of WFI did not help, try a quick \gls{tcs} restart.
   \end{enumerate} 
\item Run the flat field \gls{ob} again.
\end{enumerate}

\subsection{Crash during filtre change in WFI}
\label{sec:crashfiltre}

\procedure{Fix a WFI filtre change crash}\label{proc:filtrereset}
If the \gls{ob} crashes at the moment to change the filtre using \gls{wfi} and the \texttt{Filter Name} status is \texttt{Moving} on the \texttt{WFI \gls{General State}} panel (\figref{wfigen})
 \begin{enumerate}
      \item On the \gls{wfiics} (\figref{wfios}), select the filtre on the \texttt{Filter} option below \texttt{Setup Instrument}.\label{list:filtchange1}
      \item Click on the \texttt{Apply} button.
      \item Wait for filtre \texttt{Filter Name} to change from \texttt{Moving} to selected filtre (up to to 2\,min)\label{list:filtchange2}
      \item In case of error: ``icswsERR\_MOVE\_FILTER : Error during movement of filtre. ErrNo:7 ErrString: NO DETECTION'', reset the filtre controller
           \begin{enumerate}
           \item On the \gls{auxfunc} (\figref{tcsauxfunc}) in the \gls{tcs}, click on the \texttt{RESET} button below \texttt {WFI FILTER CONTROLLER}.
           \item Repeat steps \ref{list:filtchange1}--\ref{list:filtchange2}.
           \end{enumerate}
 \end{enumerate}

\section{Focus issues}

\subsection{GROND autoguider defocused}

If the \gls{grond} \gls{ag} is highly defocused:
\begin{itemize}
  \item When switching from \gls{wfi} or \gls{feros}, \gls{focus} fixes itself after the observing \gls{template} starts.
  \item If the problem persists, FOC.OFFSET in the \gls{ob} allows a manual workaround.
\end{itemize}

\subsection{Defocused wih FEROS ACS}

See \secref{focusadc}.

\subsection{WFI focus sequence fails with a timeout}
\label{sec:wfifocseqtimeout}
The \gls{wfi} \gls{focus} sequence may fail to communicate the focus offsets to the telescope.  In that case, \gls{bob} will display several lines of focus orders ending with a timeout message. Then an error pop-up will appears.

\procedure{Fix the WFI focus sequence timeout}
\label{proc:wfifocseqtimeout}
\begin{enumerate}
    \item Quick workaround
    \begin{enumerate}
        \item Start a focus OB or restart the crashed one.
        \item When the focus sequence starts, repeat the following
        \begin{enumerate}
            \item Wait for the previous subexposure to finish\\
                  There is no readout, so messages in bob should be monitored
            \item Identify the focus offset required for the new subexposure\\
                  The lower part of \gls{bob} will give several lines with
                  \texttt{current value -> target value}, one every few seconds.
            \item Manually preset the focus to the target value\\ 
                  In the \gls{TCS control panel}, below \texttt{M2 Focus}, enter the target value and click \texttt{Preset to}.  
        \end{enumerate}
        \item Once exposure is read out, proceed as usual (\procref{wfifocseq})
        \item Science observations will not be impacted.
    \end{enumerate}
    \item Clean fix (30 min)
    \begin{enumerate}
        \item Do a full restart of \gls{wfi} (10 min)
        \item Do a full restart of the \gls{tcs} (20 min).
    \end{enumerate}
   \item When the problem becomes recurrent, the \gls{wfi} workstation should
be rebooted.
\end{enumerate}

\subsection{No focus offset when filtres are changed}
\label{sec:filfocoffset}
The \gls{focus} sequence is run for a specific filtre, when changing filtres during an \gls{ob}, the TCS should apply a focus offset, which should be seen in the \gls{TCS control panel}, M2 Focus. If no offset is applied, check if in the \gls{wfi} \gls{state manager}, the Focusing flag should be \texttt{True}. The ESO people were not really clear on that.


\section{FEROS ADC}
\subsection{ADC cannot be put off}

At the start of an observation there is a message that the \gls{adc} cannot be
put off.  This happens after an observation using the \gls{adc}.  On the 
\gls{ferosics} panel (\figref{ferosics}) the line \texttt{adca} of the
\texttt{adc} field contains \texttt{ERROR} in red.  


\procedure{Remove the ADC from the optical path of FEROS}. Try in order the following items.
\begin{itemize}
  \item Manually put it off from the \gls{ferosics} panel (\figref{ferosics})
     \begin{itemize}
      \item Select the checkbox of \texttt{adca}
      \item Select \texttt{OFF} from the menu of \texttt{adca} 
      \item Click \texttt{SETUP} on the bottom of the panel.
      \item Wait for \texttt{ERROR} to be replaced by \texttt{OFF}
      \end{itemize}
  \item If it fails with a timeout error, restart the devices on the \gls{ICS Control} panel
     \begin{itemize}
      \item Use \wmenu{Device}{Select all devices}, then
      \item Use \wmenu{Device}{OFF}
      \item Use \wmenu{Device}{ONLINE}
      \item Wait for about one minute for \texttt{STATE} to be \texttt{ONLINE}
     \end{itemize}
  \item If in the last step there is an error that one of the devices that cannot be set
        \texttt{ONLINE}
      \begin{itemize}
       \item Use menu \wmenu{\gls{lcu}}{Reboot LCU1} 
       \item Use \wmenu{Device}{Select all devices}
       \item Use \wmenu{Device}{ONLINE}
        \item Wait for about one minute for \texttt{STATE} to be \texttt{ONLINE}
      \end{itemize}
  \item If problem occurs repeatedly, FEROS needs a restart, and problem
        should be reported.  Risk of the \gls{adc} 
        getting physically stuck, needing
        intervention on the instrument.
\end{itemize}

\subsection{Telescope focus is not corrected when ADC enters}
\label{sec:focusadc}

If the focus is not corrected at \gls{adc} insertion, try the items of the following procedure.

\procedure{Fix the absence of focusing after FEROS ADC enters}
\begin{itemize}
\item If no red messages appear below \texttt{\gls{vme} messages}, manually
preset to the theoretical \gls{focus} displayed on the \gls{TCS control panel}
\item If repeated red messages concerning M2 preset appear below 
 \texttt{\gls{vme} messages} on the
  \gls{TCS control panel} (\figref{tcs}), break the infinite set-focus loop
  \begin{itemize} 
    \item Under \texttt{M2 Focus} on the same panel, click \texttt{Set >}
    \item Click \texttt{Apply}  
    \item Maybe play around more \gls{preset}ting M2 manually until red messages
        disappear
    \item Re-execute the \gls{feros} \gls{ob} from preset. 
  \end{itemize}
\item If the red messages don't disappear, restart the \gls{tcs} (\secref{tcsrestart}).
\end{itemize}

\section{FEROS-DRS}

\subsection{FEROS exposure number is close to 10\,000}

If it goes past 10\,000, the reduction software will fail.  It is very easy to fix before it has reached the limit.
\procedure{Reset the exposure number}
\label{proc:FEROSDRSresetnum}
\begin{enumerate}
    \item Close the \gls{feros} \gls{drs}.
    \item Open file \texttt{/data/reduced/FEROS/.feroNNNN} and replace number by \texttt{0000}.
    \item Open the DRS again.
\end{enumerate}

If the exposure number has reached the limit, the observations for that night will not be reduced, unless the following procedure is performed.

\procedure{Fix a FEROS exposure number going above 10\,000}
\label{proc:FEROSfix10000}
\begin{enumerate}
    \item Stop \gls{ds} and \gls{drs} (point~\ref{list:stopDRS} of \procref{FEROSDRSrestart}).
    \item Kill processes and tidy lock files (point~\ref{list:killDRS} of \procref{FEROSDRSrestart}).
    \item Remove the night directory of the reduced data\\
          In a terminal, type \texttt{rm -rf /data/reduced/FEROS/yyyy-mm-dd},
          where the date is \texttt{yyyy-mm-dd}
    \item Change the \gls{feros} exposure number (\procref{FEROSDRSresetnum})
    \item Restart the \gls{ds} (point~\ref{list:DS} of \procref{FEROSDRSrestart}).
    \item Restart the \gls{drs} (point~\ref{list:DRS} of \procref{FEROSDRSrestart}).
\end{enumerate}


\subsection{FEROS DRS fails}

Check that
\begin{itemize}
    \item A full standard calibration has been done\\
          It should be on the same day with the same setup (binning and readout speed).
    \item The exposure number is smaller than 10\,000.\\
          In a terminal, write \texttt{cat /data/reduced/FEROS/.feroNNNN}.\\
          If number is above 10\,000, go to \procref{FEROSfix10000}.
\end{itemize}

\subsection{Problems to restart the FEROS-DRS and data subscriber}


If you cannot start the \gls{feros} \gls{drs} this might be for the following reason: when rebooting \gls{w2p2off} without bringing down the pipeline before, a hidden watch-dog file and several locks may survive.  It also happens in other contexts and the aetiology is unclear (most likely a bug). If all other attempts have failed to start the DRS, follow these steps.

\procedure{Restart the FEROS data reduction software and data subscriber}
\label{proc:FEROSDRSrestart}
  \begin{enumerate} 
    \item If the workstation \gls{w2p2off} was rebooted, remove the watch-dog that may have survived.
    \begin{enumerate}
        \item To check when station was last rebooted, you can use \texttt{uptime} in the terminal.
        \item In a terminal execute \texttt{cd \$DHS\_LOG} (should be \texttt{/data/msg})
        \item Get root access using \texttt{su}
        \item Remove the PID files therein with \texttt{rm *.pid}
        \item Exit root access with \texttt{exit}
    \end{enumerate}
    \item \label{list:stopDRS}Stop \gls{ds} and \gls{drs} at the \gls{drs} computer (\figref{datasubscriber}).
      \begin{enumerate}
          \item Stop and close the \gls{ds}\\
                If window is frozen, you can use \texttt{xkill} from a terminal.\\
          \item Stop and close the \gls{drs} panel\\
                If window is frozen, you can use \texttt{xkill} from a terminal.
      \end{enumerate}
    \item \label{list:killDRS}Kill processes and tidy lock files
    \begin{enumerate}
    \item Type \texttt{killall -9 ferosReduceQueuedIms}\\
          It either returns \texttt{no process killed} or nothing.  
    \item Type \texttt{rm -f /data/reduced/.ferosQueueIms/.ferosReduceQueuedIms*.pid}\\
          It is either silent or gives error \texttt{no file removed}
    \item Type \texttt{killall -9 ferosQueueIms}\\
          It either returns \texttt{no process killed} or nothing.  
    \item Type \texttt{rm -f /data/reduced/.ferosQueueIms/.ferosQueueIms*.pid}\\
          It is either silent or gives error \texttt{no file removed}
    \end{enumerate}
    \item Restart the \gls{ds} and \gls{drs}
    \begin{enumerate}
        \item \label{list:DS} Left click start \gls{ds} and configure it  (\figref{datasubconfig}).
            \begin{enumerate}
                \item \texttt{Program ID: service}
                \item \texttt{Observer Name: service}
                \item \texttt{Rename to Keyword: Name on INS ws}
             \end{enumerate}
        \item \label{list:DRS} Left click start \texttt{FEROS DRS}, and start from top to bottom
            \begin{enumerate}
                \item Start \texttt{Queue Image Status}
                \item Start \texttt{\gls{midas} Session Status}
                \item Start \texttt{Reduced Queued Image}
            \end{enumerate}
            The statuses may take several dozen of seconds turn \texttt{Online}. 
    \end{enumerate}
\end{enumerate}
  

\begin{figure}[t!]
\begin{minipage}{0.48\linewidth}
\subfigure[\texttt{\gls{feros} \gls{ds}.}]{%
\includegraphics[width=\linewidth]{drs/datasubscriber.png}
\label{fig:datasubscriber}
}
\end{minipage}
\hspace{0.02\linewidth}
\begin{minipage}{0.48\linewidth}
\subfigure[\gls{feros} \texttt{data subscriber configuration window.}]{
\includegraphics[width=\linewidth]{drs/datasubscriberconfig.png}
\label{fig:datasubconfig}
}
\end{minipage}
\caption[FEROS DRS]{\gls{feros} \gls{ds}.}
\end{figure}

\subsection{Data won't show up}

If data taken with FEROS do not show up in the ESO archive and/or in the
FEROS DRS, you will need to restart processes on the data handling machine \gls{w2p2pl} (username pipeline).

\procedure{Restart the data handler.}
\label{proc:DHrestart}
\begin{enumerate} 
    \item Go to screen \texttt{\gls{w2p2pl} Pipeline}
    \item In a terminal you will need to type some of the following
        \begin{enumerate}
            \item \texttt{dhsSubscribeControl start pipeline -backsince <date>}\\where <date> in the format YYYY-MM-DD is where you want to start again.
            \item (needed?) \texttt{pipelineControl stop}
            \item (needed?) \texttt{pipelineControl start}
            \item (needed?) \texttt{stopRBS}
            \item (needed?) \texttt{startRBS pipeline.config}
            \item \texttt{doControl stop}
            \item \texttt{doControl start wfi,feros}
        \end{enumerate}
\end{enumerate}

\section{Startup issues}

\subsection{FEROS}
\label{sec:ferosstartuptimeout}

There are a few issues that may pop-up at startup.

\paragraph{Timeout}

If there is an error about process \texttt{feoControl} stating ``accepted PING but did not reply properly within 10000 msec''', you need to restart \gls{environment} using \procref{restartenv} and go on with startup.

\procedure{Restart FEROS environment}
\label{proc:restartenv}
\begin{enumerate}
\item Type \texttt{vccEnvStop -e \$RTAPENV}
\item Type \texttt{vccEnvStart -e \$RTAPENV}
\item Redo the full FEROS startup procedure
\end{enumerate}
 
\paragraph{Telemetry is not active}

There is a problem with the FEROS \gls{telemetry} at TCS (window should show some graphs, \figref{tcstelemetry}), activate the telementry using \procref{telemetry}

\procedure{Activate FEROS or WFI telemetry}
The \gls{telemetry} module is activated following these steps:
\label{proc:telemetry}
\begin{enumerate}
    \item Go to FEROS or WFI screen
    \item Open or locate a terminal and type \texttt{\gls{fcdTelemetry} \&}
    \item On the emerging \texttt{FIERA - Telemetry} GUI, press \texttt{Start}
    \item Close the GUI
    \item Go to TCS screen
    \item Close the \texttt{ESO 220 General Telemetry Panel}
    \item Open or locate a terminal and type \texttt{sciops2p2Telemetry \&}
\end{enumerate}

\paragraph{Instrument stays in STANDBY}

If the instrument does not go \texttt{ONLINE}, it is possible that the \gls{adc} is in the way. Check if \texttt{ADC} is \texttt{IN} in the \gls{General State} 
panel. If it is the case, you have to remove it manually using \procref{ferosadcatstartup}.

\procedure{Remove the ADC at startup}
\label{proc:ferosadcatstartup}
\begin{enumerate}
    \item Go the the \gls{ICS Control} panel on \gls{desktop} \texttt{ICS}
    \item Simulate motors that are not online
    \begin{enumerate}
         \item Select motors (e.g. \texttt{scsm})
         \item Use \wmenu{Devices}{Simulate HW}
         \item Wait for the motors to indicate \texttt{SIM} (a few seconds)
         \item De-select motors (e.g. \texttt{scsm})
    \end{enumerate}
    \item Remove \gls{adc}
    \begin{enumerate}
        \item Select \texttt{adca}
        \item Choose \texttt{OUT}
        \item At the bottom of the ICS Control, click \texttt{SETUP}
        \item De-select \texttt{adca}
    \end{enumerate}
    \item Use motors that are simulated and put them online
    \begin{enumerate}
         \item Select motors (e.g. \texttt{scsm})
         \item Use \wmenu{Devices}{Use HW}
         \item Wait for \texttt{SIM} to disappear (a few seconds)
         \item Use \wmenu{Decives}{ONLINE}
         \item De-select motors (e.g. \texttt{scsm})
    \end{enumerate}
    \item Wait for the instrument to be \texttt{ONLINE} (a few seconds to a minute).
\end{enumerate}

\paragraph{Instrument stays in STANDBY and all devices are OFF}
\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{feros/FEROS-badscanlinks.jpg}
\caption[When feinsInstallScanLinks is needed]{FEROS General state when scan links are compromised and need Procedure~\ref{proc:ferosscanlinks}.}
\end{figure}
Another reason for the instrument to stay in STANDBY are bad scan links to the ICS LCU \gls{lfeics1}. In that case, the \gls{General State} panel will show several red FAILED statuses for lamps and the \gls{ICS Control} will have all devices OFF.

\procedure{Restore scan links to the FEROS ICS LCU}
\label{proc:ferosscanlinks}
\begin{enumerate}
    \item Install scan links to ICS LCU,
          In a terminal, type \texttt{feinsInstallScanLinks lfeics1}
    \item Optional: Install scan links to FEROS FIERA SLCU
          In a terminal, \texttt{feinsInstallScanLinks wfefcd}
    \item Optional: Install scan links to the TCS
          In a terminal, \texttt{feinsInstallScanLinks w2p2tcs}
    \item Restart the instrument
\end{enumerate}

The optional steps may shorten troubleshooting as all scan links may have been compromised.


\begin{figure}[t!]
\begin{minipage}{0.48\linewidth}
\subfigure[\Gls{telemetry} window at \gls{tcs}, should show some graphs normally.]{%
\includegraphics[width=\linewidth]{tcs/TCS-telemetry.png}
\label{fig:tcstelemetry}
}
\end{minipage}
\hspace{0.02\linewidth}
\begin{minipage}{0.48\linewidth}
\subfigure[\gls{feros} \gls{telemetry} window.]{
\includegraphics[width=\linewidth]{feros/FEROS-telemetry.png}
\label{fig:ferostelemetry}
}
\end{minipage}
\caption[Telemetry window]{\Gls{telemetry} window.}
\end{figure}


\subsection{WFI}

The commonest issues are:
\begin{itemize}
  \item \gls{tcs} is \texttt{OFF} after startup on the \gls{General State} Panel\\
   This is harmless. Use \wmenu{Gen. Options}{Refresh Database Events}.
  \item WFI startup stops with an error during \texttt{WFI Init/Online}\\
       It most likely requires a \gls{power cycle} of the \gls{wfi} electronics, see below.
\end{itemize}

\begin{figure}[ht]
    \centering
	\includegraphics[width=0.45\linewidth]{wfi/wfielectronics-1.png}
	\hglue 0.02\linewidth
	\includegraphics[width=0.45\linewidth]{wfi/wfielectronics-2.png}
	\caption[WFI electronics: power cycle button and boards]{\gls{wfi} electronics.  The box on the right controls the power and can be used to \gls{power cycle}. The box on the left contains the electronics boards that one may need to unplug and replug.}
	\label{fig:wfielectronics}
\end{figure}

\procedure{Fix WFI init error}
\begin{figure}
    \centering
    \includegraphics[width=.8\linewidth]{wfi/wfiselftest.jpg}
    \caption{Successful self-test run of WFI electronics}
    \label{fig:wfiselftest}
\end{figure}
\begin{enumerate}
  \item Determine whether WFI passes the hardware self-test
    \begin{enumerate}
	\item Locate or open a \texttt{logMonitor}
	\item If it was not active, choose to inspect the last 500 lines
	\item Find red error ``Failed to dispatch command for camera LOADED OK''.
	\item Lines below and above contain ``C40 ping failed'' and ``Could not download \gls{fiera} config''
	\item You can also check directly whether WFI passes the self-test
            (\figref{wfiselftest})\\
        \begin{enumerate}
          \item In a terminal, type \texttt{rsh -l fcdrun \gls{wwffcd} "export DISPLAY=\$DISPLAY; fcdtestseq"}
          \item Locate a newly opened terminal with a lot of text scrolling
          \item Wait for the test to finish with \texttt{fcdlDetOnline complete} or with an error message (1--2 min)
        \end{enumerate} 
    \end{enumerate}
  \item\label{list:wfionline:reboot} Reboot the \gls{fiera} workstation
	\begin{enumerate}
		\item In a terminal, type \texttt{rsh -l fcdrun \gls{wwffcd} reboot}
	        \item Wait for 1--2 minutes for it to get back online\\
		      You may check in a terminal using \texttt{ping \gls{wwffcd}}
	\end{enumerate}
  \item If \gls{wfi} doesn't pass the self-test, \gls{power cycle} the WFI electronics 
	\begin{enumerate}
		\item Go to the telescope floor
		\item Locate the WFI power unit close to the FIERA electronics
			(\figref{wfielectronics})
		\item Switch it off
                \item Wait for 30 seconds.\\
                      (On a 2nd or 3rd attempt, you may try to unplug/replug the electronics boards if you dare.)
		\item Switch it on.
	\end{enumerate}
  \item  If WFI passes the self-test, do a restart of the \gls{fiera} 
        \begin{enumerate}
		\item In a terminal, type \texttt{fcdCtrl}
                \item On the emerging GUI, click \texttt{Shutdown}
                \item On the emerging GUI, click \texttt{Startup}
		\item Wait for \gls{fiera} to restart (1 min ?)
        \end{enumerate}
  \item\label{list:wfionline:restart} Do a full WFI restart (see Proc.~\ref{proc:startup} point~\ref{list:wfistartup} and \figref{wfi-restart})
  \item You may have to redo steps \ref{list:wfionline:reboot}--\ref{list:wfionline:restart} until WFI can finish the full restart.
\end{enumerate}


\subsection{Hydraulics cannot be switched on/off}
\label{sec:hydr-loc}
If you see that the \texttt{Loc/Re} button is red on the \texttt{2.2m Auxiliary Funct} on the Windows computer, it means that the hydraulics system is for local control in the dome.

You need to go to the dome.

\procedure{Set the hydraulics for remote control}
\begin{enumerate}
   \item Go to the dome.
   \item Locate the gray 1.5-metre-high \gls{adam} rack (\figref{dome}).
   \item Locate the switch for \texttt{ADAM Remote} / \texttt{Local} (\figref{dome-adam}, lower left).
   \item Put it towards \texttt{ADAM Remote}.
\end{enumerate}

\subsection{TCS}
\paragraph{Start-up fails with \gls{l2p2cam} error}
\begin{figure}
    \centering
    \includegraphics[width=0.8\linewidth]{tcs/TCS-l2p2cam.jpg}
    \caption[TCS restart failing to reboot the FEROS AG LCU]{When TCS restart fails to reboot the \gls{feros} \gls{ag} \gls{lcu}}
\end{figure}

If the start-Up stops with error \texttt{could not send command "PING" to l2p2cam/lccServer}, you probably need to hard reboot the  \gls{feros} \gls{ag} \gls{lcu} in the dome, but try a software reboot first to save time.

\procedure{Fix FEROS AG LCU during start-up}
    \begin{enumerate}
        \item Try a software restart of the \gls{feros} \gls{ag} \gls{lcu} (likely to fail).
        \begin{enumerate}
            \item On the \gls{tcs} screen, find or open a terminal
            \item Type \texttt{rsh \gls{l2p2cam} reboot}\\
                  If it gives an error, proceed to step~\ref{lab:startupfag2}
            \item Wait for 1--2 min for the reboot to complete 
            \item Check that the LCU is up using \texttt{ping \gls{l2p2cam}}
            \item Press \texttt{CONTINUE} in the Start/Shutdown panel\\
                  If it gives the same error popup, proceed to step~\ref{lab:startupfag2}. 
        \end{enumerate}
        \item\label{lab:startupfag2} Go to the dome and try, in that order (see \procref{restartfag}).
            \begin{enumerate}
            \item A hard reset of the \gls{lcu}
            \item A \gls{power cycle} of the \gls{lcu}
            \end{enumerate}
    \end{enumerate}

\paragraph{Start-up fails with telescope not initialised}
\begin{figure}[t]
\subfigure[Drive error]{\includegraphics[width=0.48\linewidth]{drive-error.jpg}}\hfill
\subfigure[Drives switches to push up]{\includegraphics[width=0.48\linewidth]{drives.jpg}}
\caption{Fixing drive errors during telescope initialisation}
\label{fig:drives}
\end{figure}
If the start-up stops with \texttt{telescope not initialised}, you probably forgot to switch the hydraulics and/or drives on or the telescope was not parked at zenith. 

\procedure{Fix the telescope not initialized popup} 
\begin{enumerate}
    \item Ensure hydraulics and drive are on
        \begin{enumerate}
            \item Locate the \gls{domefunc} tab on screen \texttt{Dome webcam \& hydraulics}. 
            \item Check that the \texttt{Hydr} and \texttt{Drives} buttons are green.
            \item If not, switch the hydraulics and drives on (step~\ref{lab:hydron} in \procref{startup}).
        \end{enumerate}
    \item Manually initialise the telescope
        \begin{enumerate}
            \item\label{lab:notinit1} 
                In a terminal type \texttt{\home/bin/telinit}
            \item If an error reads "cannot initialise the 
                telescope at more than 45 degrees from zenith"
                \begin{enumerate}
                    \item Go to the dome and manually park it (\procref{park}). 
                    \item Repeat step~\ref{lab:notinit1}
                \end{enumerate}
            \item If an error reads "NO\_CURRENT\_DELTA\_PRELOAD" or there has been a power outage
                \begin{enumerate}
                    \item Go to the computer room in the telescope building
                    \item Locate the ALPHA and DELTA drive in the VME rack (\figref{drives})
                    \item Turn its power switch on (black switch up)
                    \item Repeat step~\ref{lab:notinit1}
                \end{enumerate}
            \item Wait for 2--3 min for initialisation to complete.
        \end{enumerate}
    \item On the error popup, press \texttt{SKIPIT}
\end{enumerate}

\section{TCS issues}
\subsection{Quick TCS restart}
\label{sec:tcsrestart}

Many \gls{tcs} issues are solved by a fast restart, with a time loss of $\approx 10$~min. Before, it is important move the telescope to zenith since one cannot initialize it later if the telescope is at $\le$ 45 degrees above the horizon.

\procedure{Quick TCS restart}
\begin{itemize}
 \item \gls{preset} to zenith
    \begin{itemize}
	\item On the \gls{tcs} setup panel (\figref{tcssetup}), click \texttt{Zenith} under \texttt{Fixed Presets}.
        \item Alternatively, if panel is frozen, type \texttt{\home/bin/presetzenith} in a terminal.
    \end{itemize}
 \item Execute the fast restart.\\
       Type \texttt{e2p2NewStartUp} and wait for it to complete.
 \item Initialise the telescope\\
       On the \gls{tcs} setup panel (\figref{tcssetup}) press \texttt{Initialize} under \texttt{Telescope}.
\end{itemize}

\subsection{No connection with VME}
If the \gls{TCS control panel} indicates ``No connection'' in red, just below \texttt{VME messages}, it means that the \gls{tcs} workstation has lost connection to the \gls{vme} (telescope \gls{lcu}). You can try the following:

\begin{figure}
\centering
\subfigure[Remote/local pointing control]{%
\includegraphics[width=0.33\linewidth]{dome/dome-tel-local-to-remote.jpg}%
\label{fig:tel-remote}%
}%
\subfigure[Reboot of the \gls{vme}]{%
\includegraphics[width=0.33\linewidth]{dome/dome-vme-reboot.jpg}%
\label{fig:vme-reboot}%
}
\subfigure[\gls{vme} monitor]{%
\includegraphics[width=0.33\linewidth]{dome/dome-vme-monitor.jpg}%
\label{fig:vme-monitor}%
}
\caption[VME rack in the computer room of the telescope building]{\gls{vme} rack in the \gls{computer room} of the telescope building 
\emph{Left:} to
manually point the telescope to zenith, you need to switch away from 
the yellow 'd' label. \emph{Centre:} To hard reboot the VME, press the small red/pinkish reset button. \emph{Right:} the VME monitor with the ``end of boot script'' after a reboot.}
\end{figure}

\procedure{Solve the connection issue with the VME}
\begin{enumerate}
    \item If you just switched hydraulics on, wait for a few minutes to see
        if connection is back.
    \item Do a remote reboot of the \gls{vme}.\\
          Type \texttt{\gls{lccBoot} \gls{lte2p2}} in a terminal.
    \item Do a manual reboot of the \gls{vme} in the dome.
    \begin{enumerate}
        \item Go to the \gls{computer room} of the telescope enclosure.
        \item Locate the \gls{vme} (\figref{computer-room}) in front of the entrance, slightly to the left.
        \item Press the small red/pinkish button (\figref{vme-reboot}).
        \item Locate the \gls{vme} monitor, behind you if you face the VME.
        \item Wait for boot sequence to finish with ``end of boot script'' (\figref{vme-monitor})
    \end{enumerate}
\end{enumerate}

A quick restart the \gls{tcs} (\secref{tcsrestart}) is generally needed right after a reboot of the \gls{vme}.

\subsection{TCS is OFF on an instrument}
The \gls{General State} Panel of an instrument the TCS is in the state \texttt{OFF}. You should check the corresponding modules on the \gls{TCS status panel}.  If red, try to bring them \texttt{ONLINE}.

\subsection{Telescope doesn't take focus orders}

\procedure{Fix telescope focus issues}
\begin{itemize}
  \item \textit{(\gls{wfi})} \gls{ob} \gls{stall}s when \gls{focus} order is sent by \gls{bob}.\\
        Set it manually from the \gls{TCS control panel} (\figref{tcs})
  \item \textit{(\gls{feros})} Focus is not corrected after insertion of the \gls{adc}.\\
        See \secref{focusadc}.
  \item Focus cannot be set from the \gls{TCS control panel}.\\
        Restart the \gls{tcs}, see \secref{tcsrestart}.
\end{itemize}

\subsection{TCS Setup panel is stuck}

If you need to close when the panel is stuck, a few command lines are available in \texttt{/home/tcs/bin}: \texttt{closemirror}, \texttt{closeslit}, \texttt{presetzenith}, \texttt{domemanual}. 

\procedure{Unstuck the TCS Setup panel}
\label{proc:unstuckTCSpanel}
\begin{enumerate}
  \item In a terminal type \texttt{killall rs232}\\
        If ``no process killed'' appears, this procedure will not be useful.
  \item If the panel gets stuck again quickly (10--20 s), a restart of the TCS usually fixes the issue. 
\end{enumerate}

\subsection{Main mirror cover cannot be moved}
\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{dome/dome-adam.jpg}
\caption{Controlling the hydraulics and mirror cover}
\label{fig:dome-adam}
\end{figure}

If the \texttt{Main Mirror Cover} state in the \gls{TCS setup panel} says
\texttt{LOCAL} you need to go to the dome, close it, and set it
to remote control.

pf the \texttt{Main Mirror Cover} state in the \gls{TCS setup panel} stays in
\texttt{MOVING} whatever order you send, you need to go to the dome, set it for local control, close it, and set it to remote control.
 

\procedure{Manually close the main mirror cover}
\label{proc:mainmirrorstuck}
The \gls{main mirror} cover is closed following these steps:
\begin{enumerate}
   \item Go to the \gls{dome}
   \item Locate the gray 1.5-metre-high \gls{adam} control box (\figref{dome}).
   \item Locate the \texttt{Main Mirror Cover} controls (\figref{dome-adam}, upper right) 
   \item If the mirror was \texttt{MOVING}, press the yellow \texttt{Local/Remote} button.
   \item Press the red \texttt{Mirror Close} button.
   \item If any noise is heard, wait for the cover to be closed.
   \item Press the yellow \texttt{Local/Remote} button.
\end{enumerate} 


\subsection{Dome doesn't move}
\begin{figure}
\centering
\includegraphics[width=0.6\linewidth]{dome/dome-control.jpg}
\caption[Local control of the dome]{Local control of the \gls{dome}.  Local or remote control is set with the leftmost button.  Other two bottons on the same row set the direction and speed of rotation in the local control mode.  Just below, a start and stop button are used to initiate and finalise rotation.}
\label{fig:dome-control}
\end{figure}

If the \texttt{Dome Status} is \texttt{Local} on the \gls{TCS control panel}, it means that the dome is for local control from the dome.

You need to go to the \gls{dome}.

\procedure{Set the dome for remote control}
\begin{enumerate}
   \item Go to the dome.
   \item Locate the dome controls (\figref{dome}), placed on the wall opposite to the entrance.
   \item On the dome controls (\figref{dome-control}) turn the leftmost button from local to remote
\end{enumerate}

\subsection{Slit does not open or close}
If the slit does not open or close, check if urgent mechanical intervention is needed.

\procedure{Slit does not open or close}
\begin{enumerate}
    \item Ensure that the main mirror cover is closed.
    \item Go to the observing floor in the \gls{dome}.
    \item Access the \gls{TCS setup panel}
        \begin{enumerate}
            \item Locate and turn on the monitors.
            \item If necessary, log in to the \texttt{tcs} account.
            \item If necessary, open the \gls{TCS setup panel}.
        \end{enumerate}
    \item Try to move the slit doors
        \begin{enumerate}
            \item If slit status is \texttt{MOVING}, click \texttt{STOP}.
            \item Wait for status to say \texttt{STOP} (a few seconds).
            \item If the slit seems closed, click \texttt{OPEN}
            \item If the slit is ajar or open, click \texttt{CLOSE}
        \end{enumerate}
    \item If the motor turns on and stays on but slit doors do not move
        \begin{enumerate}
            \item Click \texttt{STOP}
            \item Turn off the monitors
            \item Seek assistance from the someone in the Mechanical group
            \item File a remedy ticket with a high urgency (4 hours)
        \end{enumerate}
\end{enumerate}

\subsection{Dome slit and telescope are not aligned}
For small zenithal angles there is an apparent misalignment between \gls{slit} and telescope orientation as shown on the \gls{rose diagram} on the \gls{tcs} control panel. It is a normal setting since the telescope is not exactly at the centre of the \gls{dome}.  If you need to avoid the wind you need to orient the \gls{dome} manually but be weary of vignetting.

\section{GROND issues}
\subsection{GROND M3 is stuck}
\begin{figure}[t!]
\begin{minipage}{0.28\linewidth}
\subfigure[ccsei window.]{%
\includegraphics[width=\linewidth]{grond/unstucking-grond-m3-0.png}
\label{fig:ccs}
}
\end{minipage}
\hspace{0.02\linewidth}
\begin{minipage}{0.7\linewidth}
\subfigure[M3 in the database]{
\includegraphics[width=\linewidth]{grond/unstucking-grond-m3.png}
}
\end{minipage}
\caption[Writing the GROND M3 position to the database]{Writing the \gls{M3} position in the database}
\label{fig:ccs-grondM3}
\end{figure}

\begin{figure}
\includegraphics[width=0.6\linewidth]{dome/dome-grond-m3-box.jpg}
\caption[GROND M3 mirror and MC control box]{The GROND \gls{M3} mirror and \gls{mc} control box}
\label{fig:grondM3-box}
\end{figure}

If \gls{grond} \gls{M3} mirror cannot be moved with the \texttt{\gls{grondM3}} command try in order the items of the procedure below.

\procedure{Unlocking the grond M3 mirror} 
\label{proc:grondM3stuck}
\begin{itemize}
  \item Switch back-and-forth using \texttt{\gls{grondM3} WFI} and \texttt{\gls{grondM3} GROND}.
  \item Write the mirror position in the database (\figref{ccs-grondM3})
    \begin{enumerate}
      \item In a terminal type \texttt{ccsei}
      \item Click on \texttt{CCS database monitor} 
      \item Look down \menu{Appl\_data,GROND,\gls{ics},DEVICES,\gls{M3}}.
      \item Select checkbox \texttt{Enable Editing}
      \item set \texttt{newPos} value to 2 for GROND position or 0 for WFI.
      \item Check on GROND control that mirror indeed moves.
      \item Close the GUI.
    \end{enumerate}
  \item Reset the mirror from the dome.
    \begin{enumerate}
       \item In the \gls{dome}, locate the \gls{M3}/MC box below the \gls{main mirror} (\figref{dome}).
       \item On the box (\figref{grondM3-box}), press the \gls{grondM3} WFI button.
    \end{enumerate}
\end{itemize}

\subsection{GROND OB only crashes with TCS on}

It sometimes happen that \gls{grond} works well when \texttt{TCS} is \texttt{OFF} (testOB works) but fails when it is \texttt{ON} (testOB fails with a weird TELESCOP keyword error). It can be a very tricky problem, many times solved by a simple restart, but sometimes very persistent. 

\procedure{Fix GROND OB crash with TCS on}
\label{proc:TELESCOPkeyword}
\begin{enumerate}
\item Restart \gls{grond}\\
      Use \gls{grinsStop}, \gls{grinsStart}, and prophyllaxy (\gls{grondSHUTTER}, etc.)
\item If the last point doesn't fix the issue, do a full reboot of GROND and TCS
    \begin{enumerate}
        \item Stop the instrument (\gls{grinsStop})
        \item Reboot the \gls{wgrond} workstation
        \item Do a full \gls{tcs} restart
        \item Start the instrument (\gls{grinsStart}, etc.)
        \item Start the logging of the telemetry
    \end{enumerate}
\item If the last point doesn't work, replace the reboot by a last resort reboot\item You may need to repeat the steps a few times until it works or you are bussed to a mental institution.
\end{enumerate}

\subsection{GROND IR exposure won't start}

\begin{figure}
\centering
\subfigure[GROND \gls{irace} box]{%
\includegraphics[width=.49\linewidth]{dome/dome-grond-irace.jpg}%
}%
\hspace{0.01\linewidth}%
\subfigure[GROND IRACE switch]{%
\includegraphics[width=.49\linewidth]{dome/dome-grond-irace-switch.jpg}%
}%
\caption[The GROND IRACE box]{The GROND infrared electronics (\gls{irace}) box below the \gls{main mirror} of the telescope. In order to \gls{power cycle}, use the power switch located towards the pier.}
\label{fig:grond-irace}
\end{figure}

An \gls{ob} starts with the optical exposure but nothing happens in the infrared and
the \gls{ob} \gls{stall}s. If \texttt{grondFM} doesn't solve the issue, this may need a full reset of the \gls{irace} (IR electronics).
 
\procedure{Deep reset of GROND IRACE (verify this!)}
\label{proc:iracerestart}
\begin{enumerate}
  \item In a GROND terminal, do \gls{grinsStop} as user \texttt{grondmgr}.
  \item Go to the \gls{computer room} of the telescope building.
  \item Locate the \gls{irace} workstation (\figref{computer-room}) and shut it down.
  \item Go to the \gls{dome} 
  \item Locate the power switch of the \gls{irace} box (\figref{grond-irace}) below the \gls{main mirror}.
  \item Switch it off for 10 seconds then on again.
  \item Go back to the \gls{computer room} and start the IRACE workstation.
  \item Go back to the \gls{control room} and reboot the GROND workstation.
  \item Do \texttt{\home/bin/lastResortBeforeReboot.sh} as user \texttt{grondmgr}
  \item Reboot GROND workstation.
  \item Do \texttt{\home/bin/lastResortAfterReboot.sh} as user \texttt{grondmgr}
  \item Put the instrument \texttt{ONLINE} in the GROND panel
  \item Do \texttt{grondSHUTTER \&\& grondFM}
  \item close and open bob
\end{enumerate} 

\section{Freezing issues}

\subsection{Mouse pointer does not move}
This is common on the \gls{wfi} screens.

\procedure{Recover the mouse pointer}
\begin{enumerate}
    \item Power cycle the black Intel box connected to the failing screen.\\
          Press power button for 5\,s, wait 5--10\,s, switch it on, wait for
          start-up (1--2\,min)
    \item Log in\\ 
          For WFI, user wfi (other logins in Table~\ref{fig:computers}).
    \item Open the panels from a terminal.\\
          For WFI, type \texttt{\home/bin/openPanels.sh}.
\end{enumerate}

\section{Pointing issues}

\subsection{Pointing is incorrect}
\label{sec:trouble:pointing}
\begin{table}[!bt]
\centering
\caption[Pointing model parameters for each instrument]{\Gls{pointing model} parameters for each instrument, as of November 2015.}
\label{tab:pointingmodelcoeff}
\small
\begin{tabular}{lrrr}
\hline\hline
Parameter & FEROS      & GROND     & WFI\\\hline
ID        & $-183.81$  & $-230.04$ & $-157.69$\\
IH        & $  72.92$  & $ -20.23$ & $  94.11$\\
CH        & $ 136.07$  & $  28.89$ & $  31.41$\\\hline
NP        & \multicolumn{3}{r}{$17.13$}\\
ME        & \multicolumn{3}{r}{$-113.61$}\\
MA        & \multicolumn{3}{r}{$2.22$}\\
FO        & \multicolumn{3}{r}{$91.83$}\\
TX        & \multicolumn{3}{r}{$-26.92$}\\
HCEC      & \multicolumn{3}{r}{$-18.57$}\\
HCES      & \multicolumn{3}{r}{$-22.55$}\\\hline
\end{tabular}
\end{table}

After doing the \gls{pointing} with \gls{wfi} the target is not close to the central position (4150,3950).  Also, it can happen during an observation with any instrument during the night that the object is not centred where it should.

\procedure{Fix WFI pointing issues.}
\begin{enumerate}   
    \item If not done, check the right instrument is selected on the \gls{TCS status panel}
        (\figref{tcsstatus}).
    \item Check if the current \gls{pointing model} parameters in Table.~\ref{tab:pointingmodelcoeff} for \gls{wfi} are selected on the \gls{tcs} Setup Panel (blue numbers in the bottom right-hand panel of \figref{tcssetup}). Typically
        the first three values ID, IH, CH are 0 because of a database issue.\\
        In a hurry:
        \begin{itemize}
            \item Reset the database values\\
                  In a terminal type \~{}\texttt{/bin/fixPointing.sh}\\
                  (Note: it can be done manually using \texttt{ccseiDb})
            \item Select the instrument again
        \end{itemize}
        Otherwise, a quick TCS restart will generally solve the issue.
    \item Check that the Sidereal time on the \gls{TCS control panel} is fine.\\
      It should be withing seconds of the actual one.  You can get it from
      the digital clock in the \gls{control room} using a switch on its right.\\
      If not, you need to go to the telescope building and reboot the \gls{vme}.
    \item Otherwise, it might be a problem with the \gls{tcs}.\\ 
       Try a quick \gls{tcs} restart (\secref{tcsrestart}).
\end{enumerate}  

\subsection{Telescope is stuck at low elevation}

\begin{figure}
\centering
\subfigure[Location of the joystick]{%
\includegraphics[width=0.6\linewidth]{dome/dome-tel-joystick-location}%
}%
\hspace{0.03\linewidth}%
\subfigure[Joystick]{%
\includegraphics[width=0.3\linewidth]{dome/dome-tel-joystick}%
}
\caption{The ``joystick'' can be used to manually point the telescope.}
\label{fig:tel-joystick}
\end{figure}

If telescope goes out of safe zone, reaching 20 degrees elevation, a too high hour angle, it will be stuck (by software). It also occurs if a restart or a reboot of the \gls{vme} is done when the telescope points lower than 45 degrees.

In that case, the telescope should be parked to zenith manually.

\procedure{Preset manually to zenith.}
\label{proc:park}
\begin{enumerate}   
    \item Go to the \gls{computer room} in the telescope enclosure.
    \item Locate the \gls{vme} rack (\figref{computer-room}).
    \item On the \gls{vme}, set the switch away from d (\figref{tel-remote}).
    \item Go to the \gls{dome} and find the joystick (\figref{tel-joystick}).
    \item Using the controls put the telescope approximately to zenith.
    \item Go to the \gls{computer room} in the telescope enclosure.
    \item On the \gls{vme} rack, set the switch to d.
    \item Go to the \gls{control room} below the dining room.
    \item Initialise the telescope\\
          Click \texttt{Initialize} below \texttt{Telescope}  in \gls{TCS setup panel}
\end{enumerate}

\section{Web pages}

\subsection{2.2m Environmental Monitor stuck}
If the 2.2m Environmental Monitor is stuck.

\procedure{Restart the 2.2m environmental monitor}
\begin{enumerate}
  \item Go to screen \texttt{Telescope Control Software}.
  \item In a terminal, execute command \texttt{e2p2StartEnvMon}
  \item After a few minutes refresh \url{http://www.ls.eso.org/lasilla/sciops/2p2/EnvMon}.
\end{enumerate}

\subsection{All sky camera}
If the all sky camera \gls{lascam} is stuck
\begin{enumerate}
  \item Use the Danish 1.54m camera at \url{http://allsky-dk154.asu.cas.cz/}
  \item Ask an ESO \gls{tio} to restart \gls{lascam}
\end{enumerate}

\subsection{Dome webcam doesn't show image}
It may happen that the dome \gls{webcam} doesn't show a live image of the dome---it may still carry sound though. In that case
\procedure{Power cycle the dome webcam}
\begin{enumerate}
   \item Go to the observing floor in the telescope enclosure
   \item Locate the webcam, close to the big ADAM rack and monitors.
   \item Unplug the AC cable.
   \item Plug the AC cable again.
\end{enumerate}

\section{ESO database issues}

\procedure{Data do not appear in the database}
\begin{enumerate}
   \item Wait for one or two days after the data is taken because there may be a lag
   \item If all observations including the calibrations do not show up,
         you can restart the data handler\\
         See \procref{DHrestart}
   \item If only a particular set of observations loaded directly from bob
         are impacted, check that the PID is correct
         \begin{enumerate}
           \item Open the \glspl{ob} (usually in OBD directory on bob machine)
           \item Check that the ESO PID has a valid format.
           \begin{itemize}
               \item Science OBs must start with a leading
                 zero for science PIDs, e.g. 0103.A-9001(A)
               \item Calibration OBs should not have a leading zero, e.g 60.A-0040(Z) 
           \end{itemize}
           \item Check that the ESO PID has been assigned 
              \begin{enumerate}
                \item Open the ESO Observing Schedule Query Form\\
                      \url{http://archive.eso.org/wdb/wdb/eso/sched\_rep\_arc/form}
                \item Fill telescope (\texttt{La Silla -{}- 2.2 m}) and period 
                \item Click \texttt{Search}
              \end{enumerate}
           \item If not assigned or invalid format, contact User Support Department at ESO to fix it.
     \end{enumerate}
   \item Data taken as \texttt{TEST} (daily checks) do not appear in the archive.
\end{enumerate}

\section{Miscellaneous}

\subsection{No sound from bob}

If \gls{bob} does not play sounds to indicate pop-ups or observation finishing, the sound server should be restarted.

\procedure{Restart the sound server}
\begin{enumerate}
    \item On any of the workstation, locate or open a terminal
    \item Type \texttt{ssh grondmpe@wgrondoff "pulseaudio {-}{-}kill; pulseaudio {-}{-}start"}
    \item Enter password (see Table~\ref{tab:pwd})
\end{enumerate}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5

\chapter{Main systems}
\label{chap:compo}

\section{Overview of the computing network}
\begin{figure}[p]
\centering
\includegraphics[height=0.992\linewidth,angle=90,origin=c]{computers-2p2-new.pdf}
\caption[Overview of the computing network]{Simplified overview of the computing network and its interaction with telescope operations and data handling.}
\label{fig:network}
\end{figure}

\subsection{Principles}
The operations can be separated in ``atomic'' tasks related to hardware such as driving the electronics of the FEROS CCD or managing the mechanics inside the instrument. Figure~\ref{fig:network} displays the hardware tasks in the first row.

Ideally, each of these tasks is driven by a single \gls{workstation} or \glslink{lcu}{local control unit} (e.g. \gls{lfeics1} for the internals of the FEROS instrument and \gls{wfefcd} for the detector electronics), which is indicated with a black arrow.  These LCUs and workstations are in turn are controlled by more generic workstations (e.g. \texttt{wferos} for the whole FEROS operations) who also can communicate between themselves. These workstations and LCUs are given in the second and fourth rows in Fig.~\ref{fig:network}.  

To facilitate operations, graphical user sessions can be opened from dedicated terminals to access the generic workstations (e.g. graphic user \texttt{feros} will open a session on \texttt{wferos} as user feros).  These sessions are sketched on the third row of Fig.~\ref{fig:network}.  The graphical environment runs on the user workstation \gls{uws2p2} but menu applications and terminals log into the dedicated workstation (e.g. \gls{wferos} for user \gls{feros}). These logins are represented as red arrows going from the third to the second or fourth row of Fig.~\ref{fig:network}.

The main way the different workstations and LCUs communicate to coordinate operations is via \glspl{environment}---a set of processes and database values.  User \texttt{feros@wferos} on the graphical user session \texttt{feros} will see local environment \gls{wferos} but the remote environements \gls{lfeics1} and \gls{wfefcd} corresponding to the dedicated instrument LCU and detector workstation can be accessed.  Remote control including communication with environments is sketched as green arrows between the third and second rows. Environment names, sometimes differing from the workstation or LCU names (in black), are indicated in the same colour.  For the sake of readibility some environments and connections have been displayed for the graphical user session (e.g. \gls{w2p2wfi} for user \texttt{wfi}, 3rd row), but strictly speaking they are defined on the corresponding workstation (e.g. \texttt{wfi} in the workstation \gls{w2p2ins}, 2nd row).

There are quite a few exceptions to this mechanism: some generic workstations can directly control some tasks (e.g. \gls{wgrond} and \gls{w2p2ins} directly control the instruments such as shutter and filtre wheels) and \texttt{wgrond} controls the infrared electronics workstation \gls{wgrdcs} without an environment. Also, several workstations have been virtualised (fourth row).

Last, several workstations deal with software management such as sending the observing blocks for execution, transfering the data to another station or the ESO archive, processing data, or advising about errors via sound alerts.  These software tasks are represented by the blue (data transfer) and violet (observing block transfers) arrows of Fig.~\ref{fig:network}.  

\subsection{Naming}
Workstation and environments follow site-wide naming conventions:
\begin{itemize}
    \item The first letter is \texttt{w} for a \gls{workstation}, \texttt{l} for an \gls{lcu}, and \texttt{o} for other IP devices.
    \item The following two or three letters indicate the system: \texttt{ls} for La Silla, \texttt{2p2} for the telescope, \texttt{wf} for WFI, \texttt{fe} for FEROS, \texttt{gr} for GROND. Sometimes, the name can be in full (\texttt{wferos}, \texttt{wgrond}).
    \item The last letters indicate the subsystem: \texttt{cam} for guide camera system, \texttt{agr} for the Autoguider of GROND, \texttt{dcs} for the IR detector control software, \texttt{ccd} or \texttt{fcd} for a science CCD with FIERA controller, \texttt{wfi} or \texttt{ins} for WFI, \texttt{ics} for an instrument control software, \texttt{tcs} for the telescope control software, \texttt{dhs} for the data handling system, \texttt{pl} or \texttt{pipe} for the data pipelining, \texttt{off} for the offline data reduction, \texttt{asm} for the  astronomical site monitoring (meteo), \texttt{ccc} for a closed-cycle cooler, \texttt{ds} for a detector-related device.
    \item A number may be suffixed.
\end{itemize}

Examples:
\begin{itemize}
\item \gls{lfeics1} is an LCU and LCU-base environment, for instrument FEROS, serving the instrument control software, and is the first (and only) one for that purpose. 
\item \gls{ogrds1} and \gls{ogrds2} are IP devices controlling some parts of a detector, for instrument GROND (respectively the temperature \& motor controller and the turbopump monitor) and \gls{ogrccc} its closed-cycle cooler controller.
\item \gls{w2p2dhs} is a workstation of the 2.2m telescope responsible for the data handling system (i.e. sending and receiving \glspl{ob} and archiving data). 
\end{itemize}

The LCU of the telescope \gls{vxte2p2} and its environment \gls{lte2p2} don not follow these guidelines.

\subsection{Graphical user sessions}
\begin{table}
    \caption[Main workstations and users]{Computers one can use a graphical login for to get access to instruments and controls. Except for wgrondoff, the login can be done from any terminal in the control room or the telescope building.  The password is the ``good seeing'' one shared by most  La Silla computers. The screen they are normally shown on and the relevant unix users are also given.  }
\label{fig:computers}
\centering
\begin{tabular}{llllll}
\hline
Computer        & Login    & User     & Monitor(s)                 & Description\\\hline\hline
\gls{w2p2tcs}   & tcs      & tcs      & Telescope Control Software & \gls{tcs}\\
                & cam      & cam      & Autoguider GROND \& FEROS  & Autoguiders\\
\gls{w2p2ins}   & wfi      & wfi      & Wide Field Imager BOB      & WFI user\\
                &          & wfimgr   & ---                        & manager account\\
\gls{wferos}    & feros    & feros    & FEROS BOB                  & basic user\\
                &          & ferosmgr & ---                        & manager account\\
\gls{w2p2dhs}   & visitor  & visitor  & \gls{p2} \& \gls{vot}      & \gls{visitor} observations\\
\gls{w2p2off}   & astro    & astro    & FEROS pipeline             & data \& pipelines\\
\gls{w2p2pl}    & pipeline & pipeline & w2p2pl pipeline            & WFI/FEROS data handling\\       
\gls{wgrond}    & grond    & grondmgr & GROND BOB / \gls{fiera} / \gls{irace}  & default user\\
\hline
\gls{wgrondoff} & grondmpe & grondmpe & Left to FEROS DRS          & sound server\\
\hline
\end{tabular}
\end{table}

The telescope operations use eight graphical sessions opened in the terminals available at the control room, each with a username corresponding to a specific set of tasks. In most cases tasks are gathered in environments---a set of processes and database values. These sessions, sharing the same good seeing password, summed up in Table~\figref{computers}, are
\begin{itemize}
    \item \texttt{tcs} facilitates access to the account \texttt{tcs@\gls{w2p2tcs}} (environment \texttt{w2p2tcs}) and deals with the telescope and dome movements as well as the WFI autoguider
    \item \texttt{cam} facilitates access to the account \texttt{cam@\gls{w2p2tcs}} (environment \gls{w2p2cam}) and deals the management of the autoguider cameras of FEROS and GROND
    \item \texttt{feros} facilitates access to the account \texttt{feros@\gls{wferos}} (environment \texttt{wferos})
    \item \texttt{wfi} facilitates access to the account \texttt{wfi@\gls{w2p2ins}} (environment \gls{w2p2wfi})
    \item \texttt{grond} facilitates access to the account \texttt{grond@\gls{wgrond}} (environment \texttt{wgrond})
    \item \texttt{visitor} facilitates access to the account \texttt{visitor@\gls{w2p2dhs}} (environment \texttt{w2p2dhs}) and deals with the management of observing blocks
    \item \texttt{astro} facilitates access to the account \texttt{astro@\gls{w2p2off}} and deals with the reduction of FEROS data
    \item \texttt{pipeline} facilitates access to the account \texttt{pipeline@\gls{w2p2pl}} and deals with the transfer of data.
\end{itemize}
It is possible to open these sessions from the observing floor or the old control room in the telescope enclosure.

In addition, it is possible to perform a graphical login into \texttt{wgrondoff} on the dedicated workstation at the control room.  These machines need a reboot from time to time, using \texttt{reboot} in a terminal. For some tidying tasks or reboots, you need to root password.

All these graphical sessions use \glspl{desktop} that can be selected in the dock, each for a subset of tasks or information.  For instance, for \gls{feros} the first desktop is for the general operations (execution of \glspl{ob}), the second one called \texttt{ICS} for the control of the instrument, the third one \texttt{MIDAS} for the MIDAS procedures (focus and linearity checks) etc.

\subsection{Data transfer}
\paragraph{Astronomical data}
Data acquired by the three instruments on \gls{wgrond}, \gls{wferos}, and \gls{w2p2ins} (\gls{wfi}) are transferred the the data handling system workstation \gls{w2p2dhs} from where it is sent to the ESO archive.  Reduction pipelines get their data from there: \gls{w2p2off} for the FEROS \gls{drs}, \gls{w2p2pl} for the data Quality Check, \gls{wgrpipe} for GROND.   

The astronomer can download from the ESO archive using the web site, but there may be a delay before the data appears.  They can also secure copy (\texttt{scp}) the data from one of the machines (\texttt{wgrond}, \texttt{wferos}, \texttt{w2p2ins}, \texttt{w2p2off}, \texttt{w2p2dhs}, etc.) to their computers.

The GROND team also manage data backup with external disks mounted on \gls{wgrpipe2} (labelled as \gls{wgrsaruman}) and regularly shipped back to Germany.

\paragraph{Weather and sky quality data}
Workstation \gls{wlsasm} is responsible to distribute the weather and sky quality data to the telescopes, in particular to \gls{w2p2tcs}.  The different instruments will then obtain these data to include them in the FITS header of the astronomical data.

\paragraph{Observing blocks}
On the data handling system workstation \gls{w2p2dhs}, the application \gls{vot} distributes \glspl{ob} to the instruments on their workstations \gls{wgrond}, \gls{w2p2ins}, \gls{wferos}.  It gets them on realtime from the ESO archive and can modify them in the archive. In addition, the \gls{rrm} of \gls{grond} on \gls{wgrpipe} can send OBs directly to \gls{wgrond} for immediate execution.

The astronomer will be able to prepare OBs from any place with immediate repercussion on the ESO archive and thus \gls{w2p2dhs}.


\subsection{Computer location and reboot methods}
\begin{table}[t]
\caption[Computer location and reboot methods]{Computer location and reboot methods. The computer room refers to the first floor of the telescope building.}
\label{tab:reboots}
\centering
\begin{tabular}{lll}
\hline
Component             & Location      & Reboot methods\\
\hline\hline
TCS WS                & Computer room & \texttt{reboot} in \texttt{tcs@w2p2tcs} terminal\\  
TCS \gls{lcu}         & Computer room & \texttt{\gls{lccBoot} \gls{lte2p2}}\\  
                      &               & \texttt{rsh vxte2p2 reboot}\\ 
                      &               &  Reset button, \gls{vme} rack\\
\hline
WFI WS                & Computer room & \texttt{reboot} in \texttt{wfi@\gls{w2p2ins}} terminal\\
WFI FIERA             & Computer room & \texttt{rsh -l fcdrun \gls{wwffcd} reboot}\\
\hline
FEROS workstation     & virtual       & \texttt{reboot} in \texttt{feros@wferos} terminal\\ 
FEROS pipeline        & virtual       & \texttt{reboot} in \texttt{root@w2p2off} terminal\\
FEROS LCU             & FEROS room    & \texttt{\gls{lccBoot} \gls{lfeics1}}\\
                      &               & FEROS \gls{ICS Control}, \wmenu{LCU}{Reboot}\\
                      &               & \texttt{rsh -l fcdrun lfeics1 reboot}\\
FEROS AG LCU          & FEROS room    & \texttt{\gls{lccBoot} \gls{l2p2cam}}\\
                      &               & \texttt{rsh \gls{l2p2cam} reboot}\\
                      &               & Reset button, rack, FEROS room at telescope\\
                      &               & Unplug rack, FEROS room at telescope\\
FEROS FIERA           & Computer room & \texttt{rsh -l fcdrun \gls{wfefcd} reboot}\\
\hline
GROND WS              & virtual       & \texttt{reboot} as \texttt{root@wgrond}\\
GROND FIERA           & computer room & \texttt{rsh root@\gls{wgrccd} reboot}\\
                      &               & Power switch, FIERA WS\\
GROND IRACE           & computer room & \texttt{rsh root@\gls{wgrdcs} reboot}\\
                      &               & Power switch, IRACE WS\\
GROND AG LCU          & computer room & \texttt{\gls{lccBoot} \gls{l2p2agr}}\\             
                      &               & \texttt{rsh \gls{l2p2agr} reboot}\\
                      &               & manual reset (not tested)\\
\hline
\gls{vot}/\gls{p2} WS & virtual       & \texttt{reboot} in \texttt{service@w2p2dhs} terminal\\
\hline
User WS               & \multicolumn{2}{l}{call at Paranal 5959 to reboot \gls{uws2p2}, first close all terminals}\\
\hline
\end{tabular}
\end{table}
The computers and LCUs may be located on the first floor of the telescope building in three rooms (computer room, FEROS, GROND), in the control room of the New  Operations Building (NOB), or can be virtual.  The observing floor has only low-level electronic devices (e.g. FIERA \& IRACE electronics to control detectors, ADAM module to control hydraulics \&, mirror cover) plus a terminal to login remotely on a workstation.

Prior to a planned power outage or to reboot some detector electronics, it is advisable to shut down some workstations.  \glspl{lcu} are typically rebooted daily as a prophyllactic measure (by the start-up scripts), other stations can be let accumulate an uptime of a few months (manual reboot needed).  Note that virtualised workstations can be rebooted, but if halted, coordination with IT Paranal will be needed to get them up again.

Table~\ref{tab:reboots} indicates the location of all relevant computers and LCUs, as well as the different reboot methods (soft and hard).

\begin{figure}[!ht]
\centering
\includegraphics[width=.85\linewidth]{tcs/TCS.png}
\caption[Main panel of the telescope control software]{The \gls{TCS control panel} allows to perform guiding with \gls{wfi} and to manually preset or offset.}
\label{fig:tcs}
\end{figure}

\begin{figure}[!ht]
\centering
\includegraphics[width=.85\linewidth]{tcs/TCS-setup.png}
\caption[Setup panel of the telescope control software]{The \gls{tcs} setup panel allows to open and close the \gls{dome}, main
mirror cover and setup the \gls{dome} rotation.  Additionally, fixed presets
to zenith and flat screen can be sent.}
\label{fig:tcssetup}
\end{figure}

\section{Telescope control software}

The main panel of the \gls{tcs} (\figref{tcs}), called \gls{TCS control panel}, gives a summary of \gls{focus},
guiding, and \gls{pointing}. The \gls{rose diagram} gives telescope position, \gls{slit}
orientation (symbol just outside the outermost circle), Moon position (yellow
circle), and some other info (green arrow). Telescope status and \gls{dome} status
indicate whether telescope is \gls{preset}ting, slewing, guiding, or offsetting.  The
panel also allows some interaction.  The \gls{tcs} setup panel
(\figref{tcssetup}) allows more interaction, in particular concerning
closing and opening.

\subsection{Manual preset}  
\label{manualpreset}


The \gls{preset}ting area  of the main \gls{tcs} panel (\figref{tcs}) allows manual
preset, which is used for flat fields and \gls{wfi} \gls{focus}.  Catalogues can be loaded
with \texttt{CalSelect}, in particular EmptyFields for flat fielding. The item
of the catalogues is selected with \texttt{Top}, \texttt{Up}, \texttt{Dwn},
\texttt{Bot} before \texttt{Preset} is clicked.

\subsection{Manual offset}
\label{manualoffset}

The virtual handset area of the main \gls{tcs} panel (\figref{tcs})
allows to give an offset which is used when looking for a guide star on
\gls{grond} or centring a target on the \gls{feros} fibre when guiding with the
\gls{wfi} \gls{ag}.  An offset is done by clicking \texttt{Offset} and
selecting \texttt{combined offset} (useful when guiding).  Offset steps are
input with \texttt{Store}, then the racquet in the centre (\texttt{$-$RA},
\texttt{$+$RA}, \texttt{$-$Decl}, \texttt{$+$Decl}) can be used.

\subsection{Autoguider}
\label{autoguider}

\begin{figure}[!ht]
\centering
\includegraphics[width=.85\linewidth]{tcs/TCS-AG.png}
\caption[WFI autoguider]{The \gls{ag} field is displayed on the \gls{tcs} \gls{rtd} (left) where the
 reference star can be picked (using lower right window).} 
\label{fig:tcsag}
\end{figure}
The \gls{ag} in the \gls{tcs} can be used for \gls{wfi} and \gls{feros} observations.

The \gls{ag} Field Acquisition and Autoguider areas of the main \gls{tcs}
control panel (\figref{tcs}) give control over \gls{wfi} \gls{ag}.  The buttons
of interest are \texttt{Retrieve field} (to probe the \gls{ag} field, displayed
in \figref{tcsag}), \texttt{Box to star} (to start the guiding when a guide
star has been picked) and \texttt{Off} (to turn off the \gls{ag}).  Tuning of
the \gls{ag} (e.g. integration time) can be done on  the Autoguider area of the
\gls{tcs} setup panel (\figref{tcssetup}).

Note that guiding must be set \texttt{Off} at the end of a \gls{feros}
observation using the \gls{wfi} \gls{ag}. The buttons \texttt{Stop Monitoring}
and \texttt{Start Monitoring} are useful after a change of filtres on the same
field, for they avoid a \texttt{Retrieve Field}.

Differential guiding can be set, but a particular care should be paid
to units (here arcsec/hour).


\begin{figure}[!ht]
\centering
\includegraphics[width=.6\linewidth]{tcs/TCS-status.png}
\caption[Status window of the telescope control software]{The \gls{TCS status panel} is mostly used to switch the \gls{pointing model}
between instruments.}
\label{fig:tcsstatus}
\end{figure}


\begin{figure}[!ht]
\centering
\includegraphics[width=.18\linewidth]{tcs/TCS-auxfunc-menu-1.png}%
\includegraphics[width=.18\linewidth]{tcs/TCS-auxfunc-menu-2.png}
\hglue 4em
\includegraphics[width=.4\linewidth]{tcs/TCS-auxfunc.png}
\caption[Auxiliary functions of the telescope control software]{The \gls{auxfunc} panel (right) is opened using the menu
on the TCS machine (left). It is mostly used to switch the flat field 
lamp on and off, and to open or close the \gls{wfi} \gls{protective shutter}.}
\label{fig:tcsauxfunc}
\end{figure}

\section{WFI}

\begin{figure}[!ht]
\centering
\includegraphics[width=.8\linewidth]{wfi/wfi-e2p2-os-gui.png}
\caption[WFI ICS Control]{The \gls{wfiics} can be used to change filtres manually or
take/abort CCD exposures.}
\label{fig:wfios}
\end{figure}

\begin{figure}[!ht]
\centering
\includegraphics[width=.8\linewidth]{wfi/wfi-state-manager.png}
\caption[WFI state manager]{The \gls{wfi} \gls{state manager} holds information on telescope \gls{focus}, also used for \gls{feros}. It can be used for quick-and-dirty focusing.}
\label{fig:wfistate}
\end{figure}

\begin{figure}[!ht]
\centering
\includegraphics[width=.8\linewidth]{wfi/wfi-general-state.png}
\caption[WFI \gls{General State} panel]{The \gls{wfi} general state panel gives information
about exposure, filtres, and connection to \gls{tcs}.}
\label{fig:wfigen}
\end{figure}

\section{FEROS}

\begin{figure}[!ht]
\centering
\includegraphics[width=.8\linewidth]{feros/FEROS-Control.png}
\caption[FEROS control panel]{The \gls{feros} control panel gives information
about exposure, settings, lamps, and connection to \gls{tcs}.  Exposure times
can be switched.}
\label{fig:feroscon}
\end{figure}

\begin{figure}[!ht]
\centering
\includegraphics[width=.8\linewidth]{feros/FEROS-ICS.png}
\caption[FEROS instrument control software panel]{The \gls{ferosics} panel is mainly used to change the mirror \texttt{\gls{mirr3}} from and back to \gls{wfi}, but it gives wide access to the \acrlong{ics}.}
\label{fig:ferosics}
\end{figure}


\section{GROND}

\begin{figure}[!ht]
\centering
\subfigure[GROND ``normal bob'' with a test OB.]{%
  \includegraphics[width=.49\linewidth]{grond/grond-bob.png}
  \label{fig:grondbob}
}\hfill
\subfigure[GROND control]{%
  \includegraphics[width=.49\linewidth]{grond/grond-control.png}%
  \label{fig:grondcon}
}
\caption[The main displays of GROND]{The main displays of \gls{grond}.}
\label{fig:grondmain}
\end{figure}

\begin{figure}[!ht]
\centering
\subfigure[GROND FIERA control panel (optical CCDs)]{%
  \includegraphics[width=.43\linewidth]{grond/grond-fiera.png}
  \label{fig:grondfiera}
}\hfill
\subfigure[GROND IRACE control panel (IR detectors)]{%
  \includegraphics[width=.55\linewidth]{grond/grond-irace.png}%
  \label{fig:grondirace}
}
\caption{Control panels for the detectors.}
\label{fig:gronddet}
\end{figure}



\section{P2 and vOT}

\section{FEROS reduction software}

\section{Dome controls}
\begin{figure}[!ht]
\centering
\includegraphics[width=.7\linewidth]{dome/dome-auxfunc.png}
\caption[Dome auxiliary functions]{\gls{domefunc}.}
\label{fig:domefunc}
\end{figure}

\begin{figure}[!ht]
\centering
  \includegraphics[width=.7\linewidth]{dome/dome-webcam.png}%
\caption[Dome webcam]{\gls{webcam}}
\label{fig:webcam}
\end{figure}




\begin{table}
\caption{Common passwords}
\label{tab:pwd}
\centering
\begin{tabular}{lll}
\hline
Component                    &  User name                                            & Password hint\\
\hline\hline
Graphical interface user     & tcs, cam, feros, wfi, grond, dhs, pipeline & .5a$\cdots$\\
Other users                  & \gls{visitor}, \gls{service}               & .5a$\cdots$\\
Instrument manager           & ferosmgr, grondmgr, wfimgr                 & pin2$\cdots$\\
GROND off (grondoff)         & grondmpe                                   & fixed$\cdots$\\
Workstation administrator    & root                                       & 2be1$\cdots$\\
Remedy tickets               & 2p2                                        & .5a$\cdots$\\
Visitor observing tool (vot) & sciops2p2                                  & alwaysB$\cdots$\\
Dome auxiliary functions     &                                            & .5a$\cdots$\\
p2 for La Silla (p2ls)       & MPGUtility, MPGDDT                         & MPG@$\cdots$\\
                             & sciops2p2                                  & alwaysB$\cdots$\\
\hline
\end{tabular}
\end{table}


\setglossarystyle{altlist}
\printglossaries
\addcontentsline{toc}{chapter}{\textcolor{ocre}{Glossary}}
\end{document}

